<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"kuring.me","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":true,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="404频道">
<meta property="og:url" content="http://kuring.me/index.html">
<meta property="og:site_name" content="404频道">
<meta property="og:locale">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://kuring.me/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-Hans","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>404频道</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">404频道</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学习笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">247</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/kuring" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;kuring" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://kuring.me/post/%E8%81%8C%E5%9C%BA/%E6%88%91%E7%90%86%E8%A7%A3%E7%9A%84%E8%81%8C%E5%9C%BA%E8%BF%B0%E8%81%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="404频道">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 404频道">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/post/%E8%81%8C%E5%9C%BA/%E6%88%91%E7%90%86%E8%A7%A3%E7%9A%84%E8%81%8C%E5%9C%BA%E8%BF%B0%E8%81%8C/" class="post-title-link" itemprop="url">我理解的职场述职</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-09-20 00:00:00" itemprop="dateCreated datePublished" datetime="2024-09-20T00:00:00+00:00">2024-09-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-09-19 16:11:31" itemprop="dateModified" datetime="2024-09-19T16:11:31+00:00">2024-09-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>阿里巴巴的财年为每年4月1日至次年3月31日，而4月1日至9月30日为财年的上半年。通常大部分的团队在每半个财年要完成一次述职，而眼下的 9 月 30 日前又到了述职的日子。</p>
<p>在我过往的工作经历中，并没有述职的习惯，绩效的考核也相对随意一些，绩效的好坏跟主管的主管判断关系比较大，但通常绩效的好坏跟个人的成绩也是成正比的，不会出现较大的偏差。</p>
<p>在阿里绩效的绩效考核会非常被重视，希望能够通过公平的方法来分配高低绩效，降低主管的主观判断，当然主观的判断仍然是无法避免的，而且也会仍然占较大的比重。</p>
<p>而述职可以作为一种常见的职场总结方式，也是绩效考虑的一种重要的参考依据。</p>
<p>记得刚来阿里的时候，团队由于业务压力大，述职并不是太被重视，尤其是形式方面。某一年的述职中，我仅准备了可怜的三页 PPT，仅做到了做的事情的简单罗列，缺少一些自己的思考总结，当时就被喷的比较惨，当然述职中没有体现，并不代表平常就没有思考。</p>
<p>一到述职的时候自己也经常非常头疼，经过了这几年的洗礼，自己对职场的述职也有了一点点自己的总结，希望能帮助到大家。</p>
<h1 id="为什么要做述职？"><a href="#为什么要做述职？" class="headerlink" title="为什么要做述职？"></a>为什么要做述职？</h1><p>我认为的述职有这么几个好处：</p>
<ol>
<li>对自己过去做的事情的很好总结，帮助自己重新认识自己。这也是最关键的一点。大家肯定有这样的体会，如果让你回想过去几个月甚至一年做的事情，恐怕很难一下子想全。在现代职场中，大大都是匆匆忙忙的赶路人，任务一个接一个的完成，很难像读书一样有温故而知新的机会。而述职恰恰是一个非常好的机会，可以回顾自己历史上的事情，做一个很好的总结，反思一下如果一件事情再重新做，会不会做的更好更高效。人总是在不断的总结经验中成长，述职是个很不错的职场成长机会。</li>
<li>让自己了解别人做的事情。别人做的最好的事情、吃的亏、踩过的坑都已经帮你总结好了，这是多好的一个学习机会。也许在吸取别人经验的过程中，会迸发出一些新的灵感。</li>
<li>让别人了解自己做的事情。自己做的申请同样需要传播给其他的同学，或许别人才能发现自己的闪光点，也是提升自己影响力的好时机。</li>
<li>作为主管绩效考核的依据。这一点我倒认为并没有那么关键，自己做的事情自己的能力在日常工作中已经足够体现，不需要在述职的时候才做出判断，最多也就是最为判断的依据而已。</li>
<li>提升自己的演讲能力。演讲是一种能力，需要可以练习。述职中要面对不同的人群，在有效的时间内将自己的事情给别人讲明白属实不是一件容易的事情。</li>
</ol>
<h1 id="述职的常见误区有哪些？"><a href="#述职的常见误区有哪些？" class="headerlink" title="述职的常见误区有哪些？"></a>述职的常见误区有哪些？</h1><p>述职也并非百害而无一利，同样是一把双刃剑，如果能利用的好，会对自己有较大的帮助。如果利用不好，就容易反噬自己。</p>
<ol>
<li>不要搞的花里胡哨太抽象。我见到过不少搞得花里胡哨的述职材料，一件很简单的事情非要说的很复杂，让人感觉很高大上，殊不知包装后，能听懂的人群更加少了。简简单单的真实就是最好的述职。</li>
<li>不要为了述职而述职。很多人都比较头疼述职，为了述职不得不做准备。其实这种心态就不太对，为了做而做，那么一定做不好。</li>
<li>不要消耗过多的时间来准备。如果一次要准备上好几天的时间就有点不值了，毕竟一年真正有效的工作时间才能有多少天呢，述职本身并不会产生业务价值，不要本末倒置。</li>
<li>不要陷在自己的主观世界中。要考虑到参加述职的人群，能给别人讲明白。</li>
</ol>
<h1 id="述职的形式是什么样子的？"><a href="#述职的形式是什么样子的？" class="headerlink" title="述职的形式是什么样子的？"></a>述职的形式是什么样子的？</h1><p>职场中的很多事情都有固定的套路，尤其是在一家公司内部。最好的方式就是参考老员工的述职报告，找到固定的套路，或者按照主管要求的套路来。最好不要试图找到一条新的方法，前辈们总结的路基本都不会错。</p>
<p>述职的内容遵循 STAR 法则（即背景 Situation、任务 Task、行为 Action、结果 Result），主要包含几部分内容：</p>
<ol>
<li>事情的背景。</li>
<li>面临的挑战和遇到的困难。</li>
<li>自己的解决方案。</li>
<li>项目干系人，自己在其中承担的角色。</li>
<li>事情的结果。</li>
</ol>
<p>其中也可以讲讲自己的总结思考和个人成长等内容。</p>
<p>另外在讲述的时候要符合金字塔原理，核心的原则：</p>
<ol>
<li>结论先行。</li>
<li>每层结论下面的论据不要超过7个。</li>
<li>每一个论点要言之有物，有明确的思想。</li>
</ol>
<h1 id="述职的材料该如何准备？"><a href="#述职的材料该如何准备？" class="headerlink" title="述职的材料该如何准备？"></a>述职的材料该如何准备？</h1><p>这里有几个建议：</p>
<ol>
<li>如果有写周报的习惯，可以看看周报的内容。</li>
<li>可以看看各种群的聊天记录的内容。</li>
<li>可以看看自己的代码提交记录。</li>
<li>可以看看自己的文档。</li>
</ol>
<p>当然，上面的一些前提都是平常要有一些积累，如果平常积累的多，那么述职的材料准备起来就比较简单。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://kuring.me/linux/lxcfs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="404频道">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 404频道">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/linux/lxcfs/" class="post-title-link" itemprop="url">lxcfs 技术</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-08-31 00:00:00" itemprop="dateCreated datePublished" datetime="2024-08-31T00:00:00+00:00">2024-08-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-09-19 16:11:31" itemprop="dateModified" datetime="2024-09-19T16:11:31+00:00">2024-09-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>容器中的执行<code>top</code>、<code>free</code>等命令展示出来的CPU，内存等信息是从<code>/proc</code>目录中的相关文件里读取出来的。而容器并没有对<code>/proc</code>，<code>/sys</code>等文件系统做隔离，因此容器中读取出来的CPU和内存的信息是宿主机的信息，与容器实际分配和限制的资源量不同。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/proc/cpuinfo</span><br><span class="line">/proc/diskstats</span><br><span class="line">/proc/meminfo</span><br><span class="line">/proc/stat</span><br><span class="line">/proc/swaps</span><br><span class="line">/proc/uptime</span><br></pre></td></tr></table></figure>

<p>lxcfs是一个常驻进程运行在宿主机上，从而来自动维护宿主机cgroup中容器的真实资源信息与容器内<code>/proc</code>下文件的映射关系。</p>
<p>lxcfs实现的基本原理是通过文件挂载的方式，把cgroup中容器相关的信息读取出来，存储到lxcfs相关的目录下，并将相关目录映射到容器内的&#x2F;proc目录下，从而使得容器内执行top,free等命令时拿到的&#x2F;proc下的数据是真实的cgroup分配给容器的CPU和内存数据。</p>
<p><img src="https://kuring.oss-cn-beijing.aliyuncs.com/images/20240830114743.png" alt="image.png"></p>
<table>
<thead>
<tr>
<th>类别</th>
<th>容器内目录</th>
<th>宿主机lxcfs目录</th>
</tr>
</thead>
<tbody><tr>
<td>cpu</td>
<td>&#x2F;proc&#x2F;cpuinfo</td>
<td>&#x2F;var&#x2F;lib&#x2F;lxcfs&#x2F;proc&#x2F;cpuinfo</td>
</tr>
<tr>
<td>内存</td>
<td>&#x2F;proc&#x2F;meminfo</td>
<td>&#x2F;var&#x2F;lib&#x2F;lxcfs&#x2F;proc&#x2F;meminfo</td>
</tr>
<tr>
<td></td>
<td>&#x2F;proc&#x2F;diskstats</td>
<td>&#x2F;var&#x2F;lib&#x2F;lxcfs&#x2F;proc&#x2F;diskstats</td>
</tr>
<tr>
<td></td>
<td>&#x2F;proc&#x2F;stat</td>
<td>&#x2F;var&#x2F;lib&#x2F;lxcfs&#x2F;proc&#x2F;stat</td>
</tr>
<tr>
<td></td>
<td>&#x2F;proc&#x2F;swaps</td>
<td>&#x2F;var&#x2F;lib&#x2F;lxcfs&#x2F;proc&#x2F;swaps</td>
</tr>
<tr>
<td></td>
<td>&#x2F;proc&#x2F;uptime</td>
<td>&#x2F;var&#x2F;lib&#x2F;lxcfs&#x2F;proc&#x2F;uptime</td>
</tr>
<tr>
<td></td>
<td>&#x2F;proc&#x2F;loadavg</td>
<td>&#x2F;var&#x2F;lib&#x2F;lxcfs&#x2F;proc&#x2F;loadavg</td>
</tr>
<tr>
<td></td>
<td>&#x2F;sys&#x2F;devices&#x2F;system&#x2F;cpu&#x2F;online</td>
<td>&#x2F;var&#x2F;lib&#x2F;lxcfs&#x2F;sys&#x2F;devices&#x2F;system&#x2F;cpu&#x2F;online</td>
</tr>
</tbody></table>
<p>在每个容器内仅需要挂载 lxcfs 在宿主机上的目录到容器中的目录即可。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://kuring.me/daily/carnegie/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="404频道">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 404频道">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/daily/carnegie/" class="post-title-link" itemprop="url">卡内基与卡耐基</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-08-21 00:00:00" itemprop="dateCreated datePublished" datetime="2024-08-21T00:00:00+00:00">2024-08-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-09-19 16:11:31" itemprop="dateModified" datetime="2024-09-19T16:11:31+00:00">2024-09-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>多年前，我曾经阅读过两本当时非常流行的书籍《<a target="_blank" rel="noopener" href="https://book.douban.com/subject/26954744/">人性的弱点</a>》和《<a target="_blank" rel="noopener" href="https://book.douban.com/subject/26975497/">人性的优点</a>》，作者均为卡耐基。<br><img src="https://kuring.oss-cn-beijing.aliyuncs.com/images/20240820235758.png" alt="image.png"></p>
<p>而前段时间参加过一场[卡内基的培训](<a target="_blank" rel="noopener" href="https://www.carnegiechina.com/aboutus">卡内基训练 (carnegiechina.com)</a>)，自己就有点傻傻的分不清楚此“卡”是否为彼“卡”。<br><img src="https://kuring.oss-cn-beijing.aliyuncs.com/images/20240821000021.png" alt="image.png"><br>于是搜索了一下资料，发现两“卡”均为 <strong>戴尔·卡耐基</strong>(Dale Carnegie，1888年11月24日—1955年11月1日)，美国的作家和演讲者。只是因为翻译的偏差，导致出现了卡内基和卡耐基两种称呼。<br><img src="https://kuring.oss-cn-beijing.aliyuncs.com/images/20240820235142.png" alt="image.png"></p>
<p>1912 年创办了卡内基训练（Dale Carnegie Training）教导人们人际沟通及如何处理压力。<br>1936 年完成书籍《人性的弱点》又名《<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%8D%A1%E5%85%A7%E5%9F%BA%E6%BA%9D%E9%80%9A%E8%88%87%E4%BA%BA%E9%9A%9B%E9%97%9C%E4%BF%82">如何赢取友谊与影响他人</a>》（_How to Win Friends and Influence People_）一书。</p>
<p>之所以会出现混淆，还有另外的名字也是跟卡耐基相关的：</p>
<ol>
<li><strong>安德鲁·卡内基</strong>（Andrew Carnegie，1835年11月25日—1919年8月11日）：美国著名的钢铁大王，其名称要远大于<strong>戴尔·卡耐基</strong>。</li>
<li><strong>卡内基·梅隆大学</strong>（Carnegie Mellon University）：由钢铁大王<strong>安德鲁·卡内基</strong>创办，全球大学排名上在前60名以内。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://kuring.me/ai/n-gram/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="404频道">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 404频道">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/ai/n-gram/" class="post-title-link" itemprop="url">语言模型雏形 N-Gram</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-08-19 00:00:00" itemprop="dateCreated datePublished" datetime="2024-08-19T00:00:00+00:00">2024-08-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-09-19 16:11:31" itemprop="dateModified" datetime="2024-09-19T16:11:31+00:00">2024-09-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>本文为对《GPT 图解 - 大模型是怎样构建的》一书的学习笔记，所有的例子和代码均来源于本书。</p>
</blockquote>
<h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><p> N-Gram 模型为语言模型的雏形。</p>
<p>基本思想为：一个词出现的概率仅依赖其前面的 N-1 个词。即通过有限的 N-1 个词来预测第 N 个词。</p>
<p>以 “我爱吃肉” 举例，分词为 [”我“, “爱”, “吃”, “肉”]。</p>
<ul>
<li>当 N&#x3D;1 时，对应的序列为[”我“, “爱”, “吃”, “肉”]，又成为 Unigram。</li>
<li>当 N&#x3D;2 时，对应的序列为[”我爱“, “爱吃”, “吃肉”]，又成为 Bigram。</li>
<li>当 N&#x3D;3 时，对应的序列为[”我爱吃“, “爱吃肉”]，又成为 Trigram。</li>
</ul>
<h2 id="2-Gram-的构建过程"><a href="#2-Gram-的构建过程" class="headerlink" title="2-Gram 的构建过程"></a>2-Gram 的构建过程</h2><h3 id="将语料拆分为分词"><a href="#将语料拆分为分词" class="headerlink" title="将语料拆分为分词"></a>将语料拆分为分词</h3><p>将给定的语料库，拆分为以一个的分词。在真实的场景中需要使用分词函数，这里简单起见，使用了一个汉字一个分词的方式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">corpus = [ <span class="string">&quot;我喜欢吃苹果&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;我喜欢吃香蕉&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;她喜欢吃葡萄&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;他不喜欢吃香蕉&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;他喜欢吃苹果&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;她喜欢吃草莓&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个分词函数，将文本转换为单个字符的列表  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tokenize</span>(<span class="params">text</span>):  </span><br><span class="line"> <span class="keyword">return</span> [char <span class="keyword">for</span> char <span class="keyword">in</span> text] <span class="comment"># 将文本拆分为字符列表  </span></span><br><span class="line"><span class="comment"># 对每个文本进行分词，并打印出对应的单字列表  </span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;单字列表:&quot;</span>)   </span><br><span class="line"><span class="keyword">for</span> text <span class="keyword">in</span> corpus:  </span><br><span class="line">    tokens = tokenize(text)  </span><br><span class="line">    <span class="built_in">print</span>(tokens)</span><br></pre></td></tr></table></figure>

<p>得到如下的结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">单字列表:</span><br><span class="line">[&#x27;我&#x27;, &#x27;喜&#x27;, &#x27;欢&#x27;, &#x27;吃&#x27;, &#x27;苹&#x27;, &#x27;果&#x27;]</span><br><span class="line">[&#x27;我&#x27;, &#x27;喜&#x27;, &#x27;欢&#x27;, &#x27;吃&#x27;, &#x27;香&#x27;, &#x27;蕉&#x27;]</span><br><span class="line">[&#x27;她&#x27;, &#x27;喜&#x27;, &#x27;欢&#x27;, &#x27;吃&#x27;, &#x27;葡&#x27;, &#x27;萄&#x27;]</span><br><span class="line">[&#x27;他&#x27;, &#x27;不&#x27;, &#x27;喜&#x27;, &#x27;欢&#x27;, &#x27;吃&#x27;, &#x27;香&#x27;, &#x27;蕉&#x27;]</span><br><span class="line">[&#x27;他&#x27;, &#x27;喜&#x27;, &#x27;欢&#x27;, &#x27;吃&#x27;, &#x27;苹&#x27;, &#x27;果&#x27;]</span><br><span class="line">[&#x27;她&#x27;, &#x27;喜&#x27;, &#x27;欢&#x27;, &#x27;吃&#x27;, &#x27;草&#x27;, &#x27;莓&#x27;]</span><br></pre></td></tr></table></figure>

<h3 id="计算每个-2-Gram（BiGram）-在语料库中的词频"><a href="#计算每个-2-Gram（BiGram）-在语料库中的词频" class="headerlink" title="计算每个 2-Gram（BiGram） 在语料库中的词频"></a>计算每个 2-Gram（BiGram） 在语料库中的词频</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义计算 N-Gram 词频的函数  </span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict, Counter <span class="comment"># 导入所需库  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">count_ngrams</span>(<span class="params">corpus, n</span>):  </span><br><span class="line">    ngrams_count = defaultdict(Counter)  <span class="comment"># 创建一个字典，存储 N-Gram 计数  </span></span><br><span class="line">    <span class="keyword">for</span> text <span class="keyword">in</span> corpus:  <span class="comment"># 遍历语料库中的每个文本  </span></span><br><span class="line">        tokens = tokenize(text)  <span class="comment"># 对文本进行分词  </span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tokens) - n + <span class="number">1</span>):  <span class="comment"># 遍历分词结果，生成 N-Gram            ngram = tuple(tokens[i:i+n])  # 创建一个 N-Gram 元组  </span></span><br><span class="line">            prefix = ngram[:-<span class="number">1</span>]  <span class="comment"># 获取 N-Gram 的前缀  </span></span><br><span class="line">            token = ngram[-<span class="number">1</span>]  <span class="comment"># 获取 N-Gram 的目标单字  </span></span><br><span class="line">            ngrams_count[prefix][token] += <span class="number">1</span>  <span class="comment"># 更新 N-Gram 计数  </span></span><br><span class="line">    <span class="keyword">return</span> ngrams_count  </span><br><span class="line">bigram_counts = count_ngrams(corpus, <span class="number">2</span>) <span class="comment"># 计算 bigram 词频  </span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;bigram 词频：&quot;</span>) <span class="comment"># 打印 bigram 词频  </span></span><br><span class="line"><span class="keyword">for</span> prefix, counts <span class="keyword">in</span> bigram_counts.items():  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="string">&quot;&quot;</span>.join(prefix), <span class="built_in">dict</span>(counts)))</span><br></pre></td></tr></table></figure>

<p>计算获取到如下的结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bigram 词频：</span><br><span class="line">我: &#123;&#x27;喜&#x27;: 2&#125;</span><br><span class="line">喜: &#123;&#x27;欢&#x27;: 6&#125;</span><br><span class="line">欢: &#123;&#x27;吃&#x27;: 6&#125;</span><br><span class="line">吃: &#123;&#x27;苹&#x27;: 2, &#x27;香&#x27;: 2, &#x27;葡&#x27;: 1, &#x27;草&#x27;: 1&#125;</span><br><span class="line">苹: &#123;&#x27;果&#x27;: 2&#125;</span><br><span class="line">香: &#123;&#x27;蕉&#x27;: 2&#125;</span><br><span class="line">她: &#123;&#x27;喜&#x27;: 2&#125;</span><br><span class="line">葡: &#123;&#x27;萄&#x27;: 1&#125;</span><br><span class="line">他: &#123;&#x27;不&#x27;: 1, &#x27;喜&#x27;: 1&#125;</span><br><span class="line">不: &#123;&#x27;喜&#x27;: 1&#125;</span><br><span class="line">草: &#123;&#x27;莓&#x27;: 1&#125;</span><br></pre></td></tr></table></figure>
<p>即当第一个词为 ”我“，第二个词为”喜“在整个语料库中出现了 2 次。</p>
<p>如果为 3-Gram（TriGram），此时输出结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bigram 词频：</span><br><span class="line">我喜: &#123;&#x27;欢&#x27;: 2&#125;</span><br><span class="line">喜欢: &#123;&#x27;吃&#x27;: 6&#125;</span><br><span class="line">欢吃: &#123;&#x27;苹&#x27;: 2, &#x27;香&#x27;: 2, &#x27;葡&#x27;: 1, &#x27;草&#x27;: 1&#125;</span><br><span class="line">吃苹: &#123;&#x27;果&#x27;: 2&#125;</span><br><span class="line">吃香: &#123;&#x27;蕉&#x27;: 2&#125;</span><br><span class="line">她喜: &#123;&#x27;欢&#x27;: 2&#125;</span><br><span class="line">吃葡: &#123;&#x27;萄&#x27;: 1&#125;</span><br><span class="line">他不: &#123;&#x27;喜&#x27;: 1&#125;</span><br><span class="line">不喜: &#123;&#x27;欢&#x27;: 1&#125;</span><br><span class="line">他喜: &#123;&#x27;欢&#x27;: 1&#125;</span><br><span class="line">吃草: &#123;&#x27;莓&#x27;: 1&#125;</span><br></pre></td></tr></table></figure>

<p>如果为 1-Gram（UniGram），此时输出结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bigram 词频：</span><br><span class="line">: &#123;&#x27;我&#x27;: 2, &#x27;喜&#x27;: 6, &#x27;欢&#x27;: 6, &#x27;吃&#x27;: 6, &#x27;苹&#x27;: 2, &#x27;果&#x27;: 2, &#x27;香&#x27;: 2, &#x27;蕉&#x27;: 2, &#x27;她&#x27;: 2, &#x27;葡&#x27;: 1, &#x27;萄&#x27;: 1, &#x27;他&#x27;: 2, &#x27;不&#x27;: 1, &#x27;草&#x27;: 1, &#x27;莓&#x27;: 1&#125;</span><br></pre></td></tr></table></figure>
<p> 可以看到已经退化为了每个单词在整个语料库中出现的次数。</p>
<h4 id="计算每个-2-Gram-出现的概率"><a href="#计算每个-2-Gram-出现的概率" class="headerlink" title="计算每个 2-Gram 出现的概率"></a>计算每个 2-Gram 出现的概率</h4><p>即给定前一个词，计算下一个词出现的概率。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义计算 N-Gram 出现概率的函数  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ngram_probabilities</span>(<span class="params">ngram_counts</span>):  </span><br><span class="line"> ngram_probs = defaultdict(Counter) <span class="comment"># 创建一个字典，存储 N-Gram 出现的概率  </span></span><br><span class="line"> <span class="keyword">for</span> prefix, tokens_count <span class="keyword">in</span> ngram_counts.items(): <span class="comment"># 遍历 N-Gram 前缀  </span></span><br><span class="line">     total_count = <span class="built_in">sum</span>(tokens_count.values()) <span class="comment"># 计算当前前缀的 N-Gram 计数  </span></span><br><span class="line">     <span class="keyword">for</span> token, count <span class="keyword">in</span> tokens_count.items(): <span class="comment"># 遍历每个前缀的 N-Gram         ngram_probs[prefix][token] = count / total_count # 计算每个 N-Gram 出现的概率  </span></span><br><span class="line"> <span class="keyword">return</span> ngram_probs  </span><br><span class="line">bigram_probs = ngram_probabilities(bigram_counts) <span class="comment"># 计算 bigram 出现的概率  </span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nbigram 出现的概率 :&quot;</span>) <span class="comment"># 打印 bigram 概率  </span></span><br><span class="line"><span class="keyword">for</span> prefix, probs <span class="keyword">in</span> bigram_probs.items():  </span><br><span class="line"> <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="string">&quot;&quot;</span>.join(prefix), <span class="built_in">dict</span>(probs)))</span><br></pre></td></tr></table></figure>

<p>输出结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bigram 出现的概率 :</span><br><span class="line">我: &#123;&#x27;喜&#x27;: 1.0&#125;</span><br><span class="line">喜: &#123;&#x27;欢&#x27;: 1.0&#125;</span><br><span class="line">欢: &#123;&#x27;吃&#x27;: 1.0&#125;</span><br><span class="line">吃: &#123;&#x27;苹&#x27;: 0.3333333333333333, &#x27;香&#x27;: 0.3333333333333333, &#x27;葡&#x27;: 0.16666666666666666, &#x27;草&#x27;: 0.16666666666666666&#125;</span><br><span class="line">苹: &#123;&#x27;果&#x27;: 1.0&#125;</span><br><span class="line">香: &#123;&#x27;蕉&#x27;: 1.0&#125;</span><br><span class="line">她: &#123;&#x27;喜&#x27;: 1.0&#125;</span><br><span class="line">葡: &#123;&#x27;萄&#x27;: 1.0&#125;</span><br><span class="line">他: &#123;&#x27;不&#x27;: 0.5, &#x27;喜&#x27;: 0.5&#125;</span><br><span class="line">不: &#123;&#x27;喜&#x27;: 1.0&#125;</span><br><span class="line">草: &#123;&#x27;莓&#x27;: 1.0&#125;</span><br></pre></td></tr></table></figure>

<h3 id="给定一个前缀，输出连续的文本"><a href="#给定一个前缀，输出连续的文本" class="headerlink" title="给定一个前缀，输出连续的文本"></a>给定一个前缀，输出连续的文本</h3><p>根据前面学习的语料信息，给定一个前缀，即可生成对应的文本内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义生成下一个词的函数  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_next_token</span>(<span class="params">prefix, ngram_probs</span>):  </span><br><span class="line"> <span class="keyword">if</span> <span class="keyword">not</span> prefix <span class="keyword">in</span> ngram_probs: <span class="comment"># 如果前缀不在 N-Gram 中，返回 None    return None  </span></span><br><span class="line"> next_token_probs = ngram_probs[prefix] <span class="comment"># 获取当前前缀的下一个词的概率  </span></span><br><span class="line"> next_token = <span class="built_in">max</span>(next_token_probs,   </span><br><span class="line">                    key=next_token_probs.get) <span class="comment"># 选择概率最大的词作为下一个词  </span></span><br><span class="line"> <span class="keyword">return</span> next_token</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义生成连续文本的函数  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_text</span>(<span class="params">prefix, ngram_probs, n, length=<span class="number">6</span></span>):  </span><br><span class="line"> tokens = <span class="built_in">list</span>(prefix) <span class="comment"># 将前缀转换为字符列表  </span></span><br><span class="line"> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length - <span class="built_in">len</span>(prefix)): <span class="comment"># 根据指定长度生成文本   </span></span><br><span class="line"><span class="comment"># 获取当前前缀的下一个词  </span></span><br><span class="line">     next_token = generate_next_token(<span class="built_in">tuple</span>(tokens[-(n-<span class="number">1</span>):]), ngram_probs)   </span><br><span class="line">     <span class="keyword">if</span> <span class="keyword">not</span> next_token: <span class="comment"># 如果下一个词为 None，跳出循环  </span></span><br><span class="line">         <span class="keyword">break</span>  </span><br><span class="line">     tokens.append(next_token) <span class="comment"># 将下一个词添加到生成的文本中  </span></span><br><span class="line"> <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(tokens) <span class="comment"># 将字符列表连接成字符串</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入一个前缀，生成文本  </span></span><br><span class="line">generated_text = generate_text(<span class="string">&quot;我&quot;</span>, bigram_probs, <span class="number">2</span>)  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n 生成的文本：&quot;</span>, generated_text) <span class="comment"># 打印生成的文本</span></span><br></pre></td></tr></table></figure>

<p>给定了文本”我“，可以生成出如下结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">生成的文本： 我喜欢吃苹果</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>N-Gram 为非常简单的语言模型，可以根据给定的词来生成句子。</p>
<p>缺点：无法捕捉到距离较远的词之间的关系。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://kuring.me/post/gzh-coze/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="404频道">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 404频道">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/post/gzh-coze/" class="post-title-link" itemprop="url">微信公众号通过扣子接入大模型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-06-19 00:00:00" itemprop="dateCreated datePublished" datetime="2024-06-19T00:00:00+00:00">2024-06-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-09-19 16:11:31" itemprop="dateModified" datetime="2024-09-19T16:11:31+00:00">2024-09-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在字节的 AI 发布平台<a target="_blank" rel="noopener" href="https://www.coze.cn/">扣子</a>中提供了创建机器人的功能，并且可以直接对接微信公众号，使用在微信公众号中回复消息，由大模型直接回复的效果。</p>
<h1 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h1><p>整体操作步骤非常简单，需要申请一个 Coze 的账号和开通微信公众号的开发者功能。</p>
<p>微信公众号的开发者功能在这里配置：<br><img src="https://kuring.oss-cn-beijing.aliyuncs.com/images/20240619211112.png" alt="image.png"></p>
<p>点击<code>创建 Bot</code> 按钮，输入 Bot 名称后点击<code>确认</code>。<br><img src="https://kuring.oss-cn-beijing.aliyuncs.com/images/20240619210355.png" alt="image.png|570"></p>
<p>在机器人设置页面，可以配置模型、选择自己训练的知识库等操作。<br><img src="https://kuring.oss-cn-beijing.aliyuncs.com/images/20240619210909.png" alt="image.png"></p>
<p>设置完成后，点击<code>发布</code>，选择<code>微信公众号（订阅号）</code>配置功能，设置对应的微信公众号的 AppID。<br><img src="https://kuring.oss-cn-beijing.aliyuncs.com/images/20240619211019.png" alt="image.png"></p>
<h1 id="体验"><a href="#体验" class="headerlink" title="体验"></a>体验</h1><p>访问公众号直接输入内容，可以看到自动回复内容。<br><img src="https://kuring.oss-cn-beijing.aliyuncs.com/images/IMG_3856.PNG.JPG" alt="IMG_3856.PNG.JPG"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://kuring.me/post/mi-gpt/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="404频道">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 404频道">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/post/mi-gpt/" class="post-title-link" itemprop="url">使用 mi-gpt 将小爱音箱接入大模型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-06-13 00:00:00" itemprop="dateCreated datePublished" datetime="2024-06-13T00:00:00+00:00">2024-06-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-09-19 16:11:31" itemprop="dateModified" datetime="2024-09-19T16:11:31+00:00">2024-09-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>无意间发现了开源项目 <a target="_blank" rel="noopener" href="https://github.com/idootop/mi-gpt">mi-gpt</a>，该项目可以将家里的小爱音箱接入到 GPT 中，增强小爱音箱的功能。在跟小爱音箱对话的过程中，可以根据特定的提示词走 GPT 来回答，而不是用小爱音箱原生的回复。</p>
<p>必备条件：</p>
<ol>
<li>必须有一个小米音箱。</li>
<li>必须要有可以长期运行的服务器，可以是树莓派等设备。</li>
<li>要有一个 OpenAI 的账号，也可以用兼容 ChatGPT API 的国内大模型。</li>
</ol>
<h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><p>部署比较简单，下面为我的部署过程，供大家参考。更详细的信息大家可以直接参考 github 项目中的<a target="_blank" rel="noopener" href="https://github.com/idootop/mi-gpt/tree/main/docs">相关文档</a>。</p>
<h2 id="创建配置文件-migpt-js："><a href="#创建配置文件-migpt-js：" class="headerlink" title="创建配置文件 .migpt.js："></a>创建配置文件 <code>.migpt.js</code>：</h2><p>参考项目中的文件 <a target="_blank" rel="noopener" href="https://github.com/idootop/mi-gpt/blob/main/.migpt.example.js">.migpt.example.js</a>内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">// 小爱音箱扮演角色的简介</span><br><span class="line">const botProfile = `</span><br><span class="line">性别：女</span><br><span class="line">性格：乖巧可爱</span><br><span class="line">爱好：喜欢搞怪，爱吃醋。</span><br><span class="line">`;</span><br><span class="line"></span><br><span class="line">// 小爱音箱主人（你）的简介</span><br><span class="line">const masterProfile = `</span><br><span class="line">性别：男</span><br><span class="line">性格：善良正直</span><br><span class="line">其他：总是舍己为人，是傻妞的主人。</span><br><span class="line">`;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  bot: &#123;</span><br><span class="line">    name: &quot;傻妞&quot;,</span><br><span class="line">    profile: botProfile,</span><br><span class="line">  &#125;,</span><br><span class="line">  master: &#123;</span><br><span class="line">    name: &quot;陆小千&quot;,</span><br><span class="line">    profile: masterProfile,</span><br><span class="line">  &#125;,</span><br><span class="line">  speaker: &#123;</span><br><span class="line">    // 小米 ID</span><br><span class="line">    userId: &quot;12345&quot;, // 注意：不是手机号或邮箱，请在「个人信息」-「小米 ID」查看</span><br><span class="line">    // 账号密码</span><br><span class="line">    password: &quot;xxx&quot;,</span><br><span class="line">    // 小爱音箱 ID 或在米家中设置的名称</span><br><span class="line">    did: &quot;Redmi小爱触屏音箱8&quot;,</span><br><span class="line">    // 当消息以下面的关键词开头时，会调用 AI 来回复消息</span><br><span class="line">    callAIKeywords: [&quot;请&quot;, &quot;你&quot;, &quot;傻妞&quot;],</span><br><span class="line">    // 当消息以下面的关键词开头时，会进入 AI 唤醒状态</span><br><span class="line">    wakeUpKeywords: [&quot;打开&quot;, &quot;进入&quot;, &quot;召唤&quot;],</span><br><span class="line">    // 当消息以下面的关键词开头时，会退出 AI 唤醒状态</span><br><span class="line">    exitKeywords: [&quot;关闭&quot;, &quot;退出&quot;, &quot;再见&quot;],</span><br><span class="line">    </span><br><span class="line">    // 进入 AI 模式的欢迎语</span><br><span class="line">    onEnterAI: [&quot;你好，我是傻妞，很高兴认识你&quot;],</span><br><span class="line">    </span><br><span class="line">    // 退出 AI 模式的提示语</span><br><span class="line">    onExitAI: [&quot;傻妞已退出&quot;],</span><br><span class="line">    </span><br><span class="line">    // AI 开始回答时的提示语</span><br><span class="line">    onAIAsking: [&quot;让我先想想&quot;, &quot;请稍等&quot;],</span><br><span class="line">    </span><br><span class="line">    // AI 结束回答时的提示语</span><br><span class="line">    onAIReplied: [&quot;我说完了&quot;, &quot;还有其他问题吗&quot;],</span><br><span class="line">    </span><br><span class="line">    // AI 回答异常时的提示语</span><br><span class="line">    onAIError: [&quot;啊哦，出错了，请稍后再试吧！&quot;],</span><br><span class="line">    </span><br><span class="line">    // 无响应一段时间后，多久自动退出唤醒模式（默认 30 秒）</span><br><span class="line">    exitKeepAliveAfter: 30,</span><br><span class="line">    </span><br><span class="line">    // TTS 指令，请到 https://home.miot-spec.com 查询具体指令</span><br><span class="line">    ttsCommand: [3, 1],</span><br><span class="line">    </span><br><span class="line">    // 设备唤醒指令，请到 https://home.miot-spec.com 查询具体指令</span><br><span class="line">    wakeUpCommand: [3, 2],</span><br><span class="line">    </span><br><span class="line">    // 是否启用流式响应，部分小爱音箱型号不支持查询播放状态，此时需要关闭流式响应</span><br><span class="line">    streamResponse: false,</span><br><span class="line">    </span><br><span class="line">    // 查询是否在播放中指令，请到 https://home.miot-spec.com 查询具体指令</span><br><span class="line">    playingCommand: [2, 1, 1], // 默认无需配置此参数，播放出现问题时再尝试开启</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>必须要修改的内容涉及到如下字段，其他字段可以根据含义来定义：</p>
<ol>
<li>speaker.userId：小米的用户 ID。</li>
<li>speaker.password：小米的账号密码。</li>
<li>speaker.did：小爱音箱的 ID 或者小爱音箱在米家的设备名字。</li>
<li>ttsCommand：需要设置。如果设置不正常，会导致小爱音箱无法播放 GPT 回复内容的情况。</li>
<li>wakeUpCommand：需要设置。</li>
<li>streamResponse：在某些音箱设备上需要关闭。我的设备因为无法读完完整的句子，选择了关闭该功能，相关参考：<a target="_blank" rel="noopener" href="https://github.com/idootop/mi-gpt/blob/main/docs/faq.md#q%E5%B0%8F%E7%88%B1%E9%9F%B3%E7%AE%B1%E6%B2%A1%E6%9C%89%E8%AF%BB%E5%AE%8C%E6%95%B4%E4%B8%AA%E5%8F%A5%E5%AD%90%E6%80%BB%E6%98%AF%E6%88%9B%E7%84%B6%E8%80%8C%E6%AD%A2">小爱音箱没有读完整个句子，总是戛然而止</a>。</li>
</ol>
<p>ttsCommand 和 wakeUpCommand 需要在 <a target="_blank" rel="noopener" href="https://home.miot-spec.com/">https://home.miot-spec.com</a> 页面搜索对应的音箱型号<br><img src="https://kuring.oss-cn-beijing.aliyuncs.com/images/20240612234942.png" alt="image.png"></p>
<p>点击规格后任选一个，选择 <code>Intelligent Speaker</code>，其中的 <code>[3, 1]</code> 对应的为 ttsCommand，<code>[3, 2]</code> 对应的为 wakeUpCommand。<br><img src="https://kuring.oss-cn-beijing.aliyuncs.com/images/20240612235825.png" alt="image.png"></p>
<h2 id="创建配置文件-env"><a href="#创建配置文件-env" class="headerlink" title="创建配置文件 .env"></a>创建配置文件 <code>.env</code></h2><p>该文件中需要配置 OPENAI 的账号信息，我这里直接采用了阿里云的通义千问大模型服务，<a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/dashscope/developer-reference/compatibility-of-openai-with-dashscope/">API 是完全兼容的</a>。</p>
<p>参考文档《<a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/dashscope/developer-reference/activate-dashscope-and-create-an-api-key">开通DashScope并创建API-KEY</a>》 阿里云上开通大模型服务，获取到 API-KEY<br><img src="https://kuring.oss-cn-beijing.aliyuncs.com/images/20240611230914.png" alt="image.png"></p>
<p>参考项目中的文件<a target="_blank" rel="noopener" href="https://github.com/idootop/mi-gpt/blob/main/.env.example">.env.example</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># OpenAI（也支持通义千问、MoonShot、DeepSeek 等模型）</span><br><span class="line">OPENAI_MODEL=qwen-turbo</span><br><span class="line">OPENAI_API_KEY=获取到的API_KEY</span><br><span class="line">OPENAI_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1</span><br><span class="line"></span><br><span class="line"># Azure OpenAI Service（可选）</span><br><span class="line"># OPENAI_API_VERSION=2024-04-01-preview</span><br><span class="line"># AZURE_OPENAI_API_KEY=你的密钥</span><br><span class="line"># AZURE_OPENAI_ENDPOINT=https://你的资源名.openai.azure.com</span><br><span class="line"># AZURE_OPENAI_DEPLOYMENT=你的模型部署名，比如：gpt-35-turbo-instruct</span><br><span class="line"></span><br><span class="line"># 提示音效（可选，一般不用填，你也可以换上自己的提示音链接试试看效果）</span><br><span class="line"># AUDIO_SILENT=静音音频链接，示例：https://example.com/slient.wav</span><br><span class="line"># AUDIO_BEEP=默认提示音链接，同上</span><br><span class="line"># AUDIO_ACTIVE=唤醒提示音链接，同上</span><br><span class="line"># AUDIO_ERROR=出错了提示音链接，同上</span><br><span class="line"></span><br><span class="line"># Doubao TTS（可选，用于调用第三方 TTS 服务，比如：豆包）</span><br><span class="line"># TTS_DOUBAO=豆包 TTS 接口</span><br><span class="line"># SPEAKERS_DOUBAO=豆包 TTS 音色列表接口</span><br></pre></td></tr></table></figure>
<p>主要修改如下两个值：</p>
<ol>
<li>OPENAI_API_KEY：即为上文获取到阿里云<a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/dashscope/">模型服务灵积</a>的 API-KEY。</li>
<li>OPENAI_MODEL：支持的模型，可以在《<a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/dashscope/developer-reference/compatibility-of-openai-with-dashscope/#7f9c78ae99pwz">支持的模型列表</a>》中查询模型列表。</li>
</ol>
<h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p>提供了两种方式：docker 和 宿主机 Node.js 方式运行，我自然会选择更加简洁的 docker 方式。</p>
<p>执行 <code>docker run -d --name mi-gpt --env-file $(pwd)/.env -v $(pwd)/.migpt.js:/app/.migpt.js idootop/mi-gpt:3.1.0</code> 即可本地运行。</p>
<h1 id="功能演示"><a href="#功能演示" class="headerlink" title="功能演示"></a>功能演示</h1><p>提问小爱同学：“请问一下太阳的重量是多少”，小爱同学可以顺利的回答出答案。</p>
<p>通过 <code>docker logs mi-gpt -f</code> 可以看到如下的输出日志：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">2024/06/12 16:15:38 Speaker 🔥 请问一下太阳的重量是多少</span><br><span class="line"></span><br><span class="line">2024/06/12 16:15:38 Speaker 🔊 让我先想想</span><br><span class="line"></span><br><span class="line">2024/06/12 16:15:41 Open AI ✅ Answer: 傻妞: 哦，太阳的重量可大了，它是个恒星，比我们的地球重得多。科学家们用的是质量而不是重量来衡量，太阳的质量大约是地球的333,000倍，真是个超级大块头，想想如果它能变成棉花糖，那得多软多亮啊！不过，太阳对我们来说太遥远了，它的重量咱们还是别去抱了，哈哈。</span><br><span class="line"></span><br><span class="line">2024/06/12 16:15:41 Speaker 🔊 傻妞: 哦，太阳的重量可大了，它是个恒星，比我们的地球重得多。科学家们用的是质量而不是重量来衡量，太阳的质量大约是地球的333,000倍，真是个超级大块头，想想如果它能变成棉花糖，那得多软多亮啊！不过，太阳对我们来说太遥远了，它的重量咱们还是别去抱了，哈哈</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://kuring.me/post/k8s/k8s-authenticate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="404频道">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 404频道">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/post/k8s/k8s-authenticate/" class="post-title-link" itemprop="url">k8s 中的用户认证方式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-04-22 00:00:00" itemprop="dateCreated datePublished" datetime="2024-04-22T00:00:00+00:00">2024-04-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-09-19 16:11:31" itemprop="dateModified" datetime="2024-09-19T16:11:31+00:00">2024-09-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在 k8s 中包含两类用户：</p>
<ol>
<li>ServiceAccount。又称服务账号，在运行 pod 时必须绑定 ServiceAccount，如果没有指定，则使用当前 namespace 下的 ServiceAccount default。是针对程序而言，用于 pod 中的程序访问 kube-apiserver。</li>
<li>普通用户。在 k8s 中并没有使用单独的对象来存储，而是通过了分发证书、外部用户认证系统等方式实现，是针对用户而言。</li>
</ol>
<h1 id="1-X509-证书认证"><a href="#1-X509-证书认证" class="headerlink" title="1. X509 证书认证"></a>1. X509 证书认证</h1><p>使用场景：使用 kubectl 访问 k8s 集群即通过 X509 证书认证方式，kubeconfig 本质上是个证书文件。</p>
<p>客户端使用证书中的 Common Name 作为请求的用户名，organization 作为用户组的成员信息。</p>
<p>证书的签发可以使用 openssl、cfssl 等工具来签发，也可以使用 k8s 自带的 CertificateSigningRequest 对象来实现签发。</p>
<h2 id="1-1-CertificateSigningRequest-签发证书"><a href="#1-1-CertificateSigningRequest-签发证书" class="headerlink" title="1.1. CertificateSigningRequest 签发证书"></a>1.1. CertificateSigningRequest 签发证书</h2><p>创建私钥信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out myuser.key 2048</span><br><span class="line">openssl req -new -key myuser.key -out myuser.csr -subj &quot;/CN=myuser&quot;</span><br></pre></td></tr></table></figure>

<p>创建如下的 CertificateSigningRequest 对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: certificates.k8s.io/v1</span><br><span class="line">kind: CertificateSigningRequest</span><br><span class="line">metadata:</span><br><span class="line">  name: myuser</span><br><span class="line">spec:</span><br><span class="line">  # value 使用命令 cat myuser.csr | base64 | tr -d &quot;\n&quot; 获取</span><br><span class="line">  request: xxx</span><br><span class="line">  # 固定值</span><br><span class="line">  signerName: kubernetes.io/kube-apiserver-client</span><br><span class="line">  # 过期时间</span><br><span class="line">  expirationSeconds: 86400  # one day</span><br><span class="line">  usages:</span><br><span class="line">  - client auth</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>查看 csr 处于 Pending 状态：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get csr</span><br><span class="line">NAME     AGE   SIGNERNAME                            REQUESTOR          REQUESTEDDURATION   CONDITION</span><br><span class="line">myuser   12s   kubernetes.io/kube-apiserver-client   kubernetes-admin   24h                 Pending</span><br></pre></td></tr></table></figure>

<p>批准给证书签发请求：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl certificate approve myuser</span><br></pre></td></tr></table></figure>

<p>签发完成后的证书会存放到 status.certificate 字段中，至此证书签发完成。</p>
<h1 id="2-ServiceAccount"><a href="#2-ServiceAccount" class="headerlink" title="2. ServiceAccount"></a>2. ServiceAccount</h1><p>使用场景：该方式使用较为常见，用于 pod 中访问 k8s apiserver。</p>
<p>原理：pod 可以通过 spec.serviceAccountName 字段来指定要使用的 ServiceAccount，如果没有指定则使用 namespace 下默认的 default ServiceAccount。kube-controller-manager 中的 ServiceAccount 控制器会在拉起的 pod 中自动注入如下的信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  volumeMounts: </span><br><span class="line">  - mountPath: /var/run/secrets/kubernetes.io/serviceaccount</span><br><span class="line">    name: kube-api-access-j6vpz</span><br><span class="line">    readOnly: true</span><br><span class="line">  volumes:</span><br><span class="line">  - name: kube-api-access-j6vpz</span><br><span class="line">    projected:</span><br><span class="line">      defaultMode: 420</span><br><span class="line">      sources:</span><br><span class="line">      - serviceAccountToken:</span><br><span class="line">          expirationSeconds: 3607</span><br><span class="line">          path: token</span><br><span class="line">      - configMap:</span><br><span class="line">          items:</span><br><span class="line">          - key: ca.crt</span><br><span class="line">            path: ca.crt</span><br><span class="line">          name: kube-root-ca.crt</span><br><span class="line">      - downwardAPI:</span><br><span class="line">          items:</span><br><span class="line">          - fieldRef:</span><br><span class="line">              apiVersion: v1</span><br><span class="line">              fieldPath: metadata.namespace</span><br><span class="line">            path: namespace</span><br></pre></td></tr></table></figure>

<p>即将信息注入到 pod 的 &#x2F;var&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount 目录下，目录结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/var/run/secrets/kubernetes.io/serviceaccount</span><br><span class="line">|-- ca.crt -&gt; ..data/ca.crt</span><br><span class="line">|-- namespace -&gt; ..data/namespace</span><br><span class="line">`-- token -&gt; ..data/token</span><br></pre></td></tr></table></figure>

<p>token 为 JWT 认证，对其格式解密后如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;alg&quot;: &quot;RS256&quot;,</span><br><span class="line">  &quot;kid&quot;: &quot;u7rF5JCtJRNiMzSUOFAYvDpCwPqUII-N-OtxR59cnQ0&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;iss&quot;: &quot;kubernetes/serviceaccount&quot;,</span><br><span class="line">  &quot;kubernetes.io/serviceaccount/namespace&quot;: &quot;default&quot;,</span><br><span class="line">  &quot;kubernetes.io/serviceaccount/secret.name&quot;: &quot;ingress-token-s9gtm&quot;,</span><br><span class="line">  &quot;kubernetes.io/serviceaccount/service-account.name&quot;: &quot;ingress&quot;,</span><br><span class="line">  &quot;kubernetes.io/serviceaccount/service-account.uid&quot;: &quot;19ce4f11-7105-43ce-b189-f3d71a2ffc74&quot;,</span><br><span class="line">  &quot;sub&quot;: &quot;system:serviceaccount:default:ingress&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-1-Secret-存放-token"><a href="#2-1-Secret-存放-token" class="headerlink" title="2.1. Secret 存放 token"></a>2.1. Secret 存放 token</h2><p>在 1.22 版本及之前版本中，token 以 Secret 的形式存在于 pod 所在的 namespace 下，且 token 不会过期。Secret 的名字存在于 ServiceAccount 的 spec 中，格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">secrets:</span><br><span class="line">- name: nginx-token-scjvn</span><br></pre></td></tr></table></figure>

<p>而 Secret 通过 Annotation <code>kubernetes.io/service-account.name</code> 指定了关联的 ServiceAccount。</p>
<p>在后续版本中，为了兼容当前方案，如果 ServiceAccount 关联了 Secret，则认为仍然使用 Secret 中存放 token 的方式。如果 Secret 已经很长时间没有使用，则自动回收 Secret。</p>
<p>如果要手工创建一个 token Secret，可以创建如下的 Secret，k8s 自动会为 Secret 产生 token：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: build-robot-secret</span><br><span class="line">  annotations:</span><br><span class="line">    # 带有 annotation</span><br><span class="line">    kubernetes.io/service-account.name: build-robot</span><br><span class="line">type: kubernetes.io/service-account-token</span><br></pre></td></tr></table></figure>

<h2 id="2-2-TokenRequest-API-产生-token"><a href="#2-2-TokenRequest-API-产生-token" class="headerlink" title="2.2. TokenRequest API 产生 token"></a>2.2. TokenRequest API 产生 token</h2><p>在 1.22 之后的版本中，kubelet 使用 TokenRequest API 获取有时间限制的临时 token，该 token</p>
<p>会在 pod 删除或者 token 生命周期（默认为 1h）结束后失效。</p>
<p>可以使用 <code>kubectl create token default</code> 来为 ServiceAccount default 创建 token，该命令实际上向 kube-apiserver 发送了请求 <code>/api/v1/namespaces/default/serviceaccounts/default/token</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;kind&quot;: &quot;TokenRequest&quot;,</span><br><span class="line">    &quot;apiVersion&quot;: &quot;authentication.k8s.io/v1&quot;,</span><br><span class="line">    &quot;metadata&quot;:</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;creationTimestamp&quot;: null</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;spec&quot;:</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;audiences&quot;: null,</span><br><span class="line">        &quot;expirationSeconds&quot;: null,</span><br><span class="line">        &quot;boundObjectRef&quot;: null</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;status&quot;:</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;token&quot;: &quot;&quot;,</span><br><span class="line">        &quot;expirationTimestamp&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>kube-apiserver 支持如下参数：</p>
<ol>
<li>–service-account-key-file：用来验证服务账号的 token。</li>
<li>–service-account-issuer：ServiceAccount token 的签发机构。</li>
<li>–service-account-signing-key-file：ServiceAccount token 的签发私钥。</li>
</ol>
<h1 id="3-用户伪装"><a href="#3-用户伪装" class="headerlink" title="3. 用户伪装"></a>3. 用户伪装</h1><p>一个用户通过 Http Header Impersonation- 的方式来扮演另外一个用户的身份。</p>
<p>场景：跨 k8s 集群访问的网关服务</p>
<p>支持的 Http Header 如下：</p>
<ol>
<li>Impersonate-User：要伪装的用户名。</li>
<li>Impersonate-Group：要伪装的组名。该 Header 可以为多个，即支持多个组。</li>
</ol>
<h1 id="4-bootstrap-token"><a href="#4-bootstrap-token" class="headerlink" title="4. bootstrap token"></a>4. bootstrap token</h1><p>使用 kube-apiserver 参数 <code>--enable-bootstrap-token-auth=true</code> 启用功能，引导 token 以 Secret 的形式存放在 kube-system 下。</p>
<p>该功能仅用于节点初始化时加入到 k8s 集群中。</p>
<h1 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h1><ul>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/authentication/">用户认证</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://kuring.me/post/k8s-apiserver-request-limit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="404频道">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 404频道">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/post/k8s-apiserver-request-limit/" class="post-title-link" itemprop="url">k8s apiserver 的限流</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-04-07 15:34:37" itemprop="dateCreated datePublished" datetime="2024-04-07T15:34:37+00:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-09-19 16:11:31" itemprop="dateModified" datetime="2024-09-19T16:11:31+00:00">2024-09-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="client-端限流"><a href="#client-端限流" class="headerlink" title="client 端限流"></a>client 端限流</h1><p>在 client-go 中会默认对客户端进行限流，并发度为 5。可以通过修改 rest.Conifg 来修改并发度。</p>
<h1 id="MaxInFlightLimit-限流"><a href="#MaxInFlightLimit-限流" class="headerlink" title="MaxInFlightLimit 限流"></a>MaxInFlightLimit 限流</h1><p>通过如下参数来控制：</p>
<ul>
<li>–max-requests-inflight：代表只读请求的最大并发量</li>
<li>–max-mutating-requests-inflight：代表写请求的最大并发量</li>
</ul>
<p>该实现为单个 kube-apiserver 层面的，可以针对所有的请求。</p>
<h1 id="EventRateLimit"><a href="#EventRateLimit" class="headerlink" title="EventRateLimit"></a>EventRateLimit</h1><p>用来对 Event 类型的对象进行限制，可以通过 kube-apiserver 的参数 –admission-control-config-file 来指定配置文件，文件格式如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiserver.config.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">AdmissionConfiguration</span></span><br><span class="line"><span class="attr">plugins:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">EventRateLimit</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">eventconfig.yaml</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>
<p>其中 EventRateLimit 为对 Event 的限制，eventconfig.yaml 文件为详细的对 Event 的限流策略，可以精确到 Namespace 和 User 信息。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">eventratelimit.admission.k8s.io/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Configuration</span></span><br><span class="line"><span class="attr">limits:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Namespace</span></span><br><span class="line">    <span class="attr">qps:</span> <span class="number">50</span></span><br><span class="line">    <span class="attr">burst:</span> <span class="number">100</span></span><br><span class="line">    <span class="attr">cacheSize:</span> <span class="number">2000</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">User</span></span><br><span class="line">    <span class="attr">qps:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">burst:</span> <span class="number">50</span></span><br></pre></td></tr></table></figure>
<h1 id="API-优先级和公平性"><a href="#API-优先级和公平性" class="headerlink" title="API 优先级和公平性"></a>API 优先级和公平性</h1><p>版本状态：</p>
<ol>
<li>alpha：1.18</li>
</ol>
<p>通过 kube-apiserver 的参数 <code>--enable-priority-fairness</code> 来控制是否开启 APF 特性。</p>
<h1 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h1><ul>
<li><a target="_blank" rel="noopener" href="https://qingwave.github.io/k8s-rate-limit/">kubernetes apiserver限流方案</a></li>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/concepts/cluster-administration/flow-control/">API 优先级和公平性</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://kuring.me/post/k8s-numa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="404频道">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 404频道">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/post/k8s-numa/" class="post-title-link" itemprop="url">k8s 中的 numa 亲和性</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-22 20:08:26" itemprop="dateCreated datePublished" datetime="2024-03-22T20:08:26+00:00">2024-03-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-09-19 16:11:31" itemprop="dateModified" datetime="2024-09-19T16:11:31+00:00">2024-09-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>默认的情况下，k8s 对于 pod 在单个节点的资源分配并不会考虑到 NUMA 架构。比如 cpu 默认会采用 cgroup CFS 来做资源的分配，并未考虑到 NUMA 架构。为了提升 pod 的性能，需要 pod 在分配资源时感知 NUMA 架构。<br />为此，k8s 在 kubelet 中通过 CPU Manager、Memory Manager、Device Manager、Topology Manager 等特性对 NUMA 做了支持，支持的 pod QoS 类型要求为 Granteed pod。<br />各特性的支持版本情况如下：</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>alpha</th>
<th>beta</th>
<th>stable</th>
</tr>
</thead>
<tbody><tr>
<td>CPU Manager</td>
<td></td>
<td>1.12</td>
<td>1.26</td>
</tr>
<tr>
<td>Memory Manager</td>
<td>1.21</td>
<td>1.22</td>
<td>-</td>
</tr>
<tr>
<td>Topology Manager</td>
<td>1.16</td>
<td>1.18</td>
<td>-</td>
</tr>
</tbody></table>
<h1 id="CPU-Manager"><a href="#CPU-Manager" class="headerlink" title="CPU Manager"></a>CPU Manager</h1><p>在 k8s 中使用 cgroup 的 CFS 配额来执行 pod 的 CPU 约束，在 CFS 的模式下，pod 可能会运行在不同的核上，会导致 pod 的缓存失效的问题。对于性能要求非常高的 pod，为了提升性能，可以通过 cgroup 中的 cpuset 绑核的特性来提升 pod 的性能。</p>
<p>在 k8s 中仅针对如下的 pod 类型做了绑核操作：</p>
<ol>
<li>必须为 guaranteed pod 类型。即 pod 需要满足如下两个条件：<ol>
<li>pod 中的每个容器都必须指定cpu 和 内存的 request 和 limit。</li>
<li>pod 中的每个容器的 cpu 和内存的 request 和 limit 必须相等。</li>
</ol>
</li>
<li>pod 的 cpu request 和 limit 必须为整数。</li>
</ol>
<h2 id="kubelet-的参数配置"><a href="#kubelet-的参数配置" class="headerlink" title="kubelet 的参数配置"></a>kubelet 的参数配置</h2><p>在 k8s 中仅通过 kubelet 来支持 pod 的绑核操作，跟其他组件无关。<br />kubelet 通过参数 <code>--cpu-manager-policy</code> 或者在 kubelet 的配置文件中参数<code>cpuManagerPolicy</code> 来配置，支持如下值：</p>
<ol>
<li>none：默认策略。即不执行绑核操作。</li>
<li>static：允许为节点上的某些特征的 pod 赋予增强的 cpu 亲和性和独占性。</li>
</ol>
<p>kubelet 通过参数 <code>--cpu-manager-reconcile-period</code> 来指定内存中的 cpu 分配跟 cgroupfs 一致。<br />kubelet 通过参数 <code>--cpu-manager-policy-options</code>来微调。该特性通过特性门控 CPUManagerPolicyOptions 来控制。</p>
<h2 id="模式之间切换"><a href="#模式之间切换" class="headerlink" title="模式之间切换"></a>模式之间切换</h2><p>默认的 kubelet <code>cpuManagerPolicy</code> 配置为 none，策略配置位于文件 <code>/var/lib/kubelet/cpu_manager_state</code>，文件内容如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;policyName&quot;</span><span class="punctuation">:</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span><span class="attr">&quot;defaultCpuSet&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;checksum&quot;</span><span class="punctuation">:</span><span class="number">1353318690</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>修改 kubelet 的<code>cpuManagerPolicy</code> 为 static，将模式从 none 切换为 static，重启 kubelet。发现 kubelet 会启动失败，kubelet 并不能支持仅修改参数就切换模式，报如下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Mar 06 15:00:02 iZt4nd5yyw9vfuxn3q2g3tZ kubelet[102800]: E0306 15:00:02.463939  102800 cpu_manager.go:223] &quot;Could not initialize checkpoint manager, please drain node and remove policy state file&quot; err=&quot;could not restore state from checkpoint: configured policy \&quot;static\&quot; differs from state checkpoint policy \&quot;none\&quot;, please drain this node and delete the CPU manager checkpoint file \&quot;/var/lib/kubelet/cpu_manager_state\&quot; before restarting Kubelet&quot;</span><br><span class="line">Mar 06 15:00:02 iZt4nd5yyw9vfuxn3q2g3tZ kubelet[102800]: E0306 15:00:02.463972  102800 kubelet.go:1392] &quot;Failed to start ContainerManager&quot; err=&quot;start cpu manager error: could not restore state from checkpoint: configured policy \&quot;static\&quot; differs from state checkpoint policy \&quot;none\&quot;, please drain this node and delete the CPU manager checkpoint file \&quot;/var/lib/kubelet/cpu_manager_state\&quot; before restarting Kubelet&quot;</span><br></pre></td></tr></table></figure>
<p>将文件 <code>/var/lib/kubelet/cpu_manager_state</code> 删除后，kubelet 即可启动成功，新创建的 <code>/var/lib/kubelet/cpu_manager_state</code> 文件内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;policyName&quot;:&quot;static&quot;,&quot;defaultCpuSet&quot;:&quot;0-3&quot;,&quot;checksum&quot;:611748604&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到已经存在了绑核的 pod。</p>
<p>如果节点上已经存在符合绑核条件的 pod，在修改配置并重启 kubelet 后即可绑核生效。</p>
<h2 id="绑核实践"><a href="#绑核实践" class="headerlink" title="绑核实践"></a>绑核实践</h2><p>配置 kubelet 的<code>cpuManagerPolicy</code>值为 static，创建 guaranteed pod：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deployment</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;200Mi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;200Mi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;2&quot;</span></span><br></pre></td></tr></table></figure>
<p>在 pod 调度的节点上，进入到 &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;cpuset&#x2F;kubepods.slice 目录下，跟绑核相关的设置均在该目录下，该目录的结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ ll /sys/fs/cgroup/cpuset/kubepods.slice</span><br><span class="line">-rw-r--r--  1 root root 0 Mar  6 10:31 cgroup.clone_children</span><br><span class="line">-rw-r--r--  1 root root 0 Mar  6 10:31 cgroup.procs</span><br><span class="line">-rw-r--r--  1 root root 0 Mar  6 10:31 cpuset.cpu_exclusive</span><br><span class="line">-rw-r--r--  1 root root 0 Mar  6 10:31 cpuset.cpus</span><br><span class="line">-r--r--r--  1 root root 0 Mar  6 10:31 cpuset.effective_cpus</span><br><span class="line">-r--r--r--  1 root root 0 Mar  6 10:31 cpuset.effective_mems</span><br><span class="line">-rw-r--r--  1 root root 0 Mar  6 10:31 cpuset.mem_exclusive</span><br><span class="line">-rw-r--r--  1 root root 0 Mar  6 10:31 cpuset.mem_hardwall</span><br><span class="line">-rw-r--r--  1 root root 0 Mar  6 10:31 cpuset.memory_migrate</span><br><span class="line">-r--r--r--  1 root root 0 Mar  6 10:31 cpuset.memory_pressure</span><br><span class="line">-rw-r--r--  1 root root 0 Mar  6 10:31 cpuset.memory_spread_page</span><br><span class="line">-rw-r--r--  1 root root 0 Mar  6 10:31 cpuset.memory_spread_slab</span><br><span class="line">-rw-r--r--  1 root root 0 Mar  6 10:31 cpuset.mems</span><br><span class="line">-rw-r--r--  1 root root 0 Mar  6 10:31 cpuset.sched_load_balance</span><br><span class="line">-rw-r--r--  1 root root 0 Mar  6 10:31 cpuset.sched_relax_domain_level</span><br><span class="line">drwxr-xr-x  2 root root 0 Mar  6 10:31 kubepods-besteffort.slice</span><br><span class="line">drwxr-xr-x 10 root root 0 Mar  6 10:31 kubepods-burstable.slice</span><br><span class="line">drwxr-xr-x  4 root root 0 Mar  6 15:09 kubepods-pod4dc3ad18_5bad_4728_9f79_59f2378de46e.slice</span><br><span class="line">-rw-r--r--  1 root root 0 Mar  6 10:31 notify_on_release</span><br><span class="line">-rw-r--r--  1 root root 0 Mar  6 10:31 pool_size</span><br><span class="line">-rw-r--r--  1 root root 0 Mar  6 10:31 tasks</span><br></pre></td></tr></table></figure>
<p>其中 kubepods-besteffort.slice 和 kubepods-burstable.slice 分别对应的 besteffort 和 burstable 类型的 pod 配置，因为这两种类型的 pod 并不执行绑核操作，所有的子目录下的 cpuset.cpus 文件均绑定的 cpu 核。<br />kubepods-pod4dc3ad18_5bad_4728_9f79_59f2378de46e.slice 目录为要绑核的 pod 目录，其中 4dc3ad18_5bad_4728_9f79_59f2378de46e 根据 pod 的 uid 转换而来，pod 的 <code>metadata.uid</code> 字段的值为 4dc3ad18-5bad-4728-9f79-59f2378de46e，即目录结构中将<code>-</code>转换为<code>_</code>。<br />目录结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ ll /sys/fs/cgroup/cpuset/kubepods.slice/kubepods-pod4dc3ad18_5bad_4728_9f79_59f2378de46e.slice</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  6 15:09 cgroup.clone_children</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  6 15:09 cgroup.procs</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  6 15:09 cpuset.cpu_exclusive</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  6 15:09 cpuset.cpus</span><br><span class="line">-r--r--r-- 1 root root 0 Mar  6 15:09 cpuset.effective_cpus</span><br><span class="line">-r--r--r-- 1 root root 0 Mar  6 15:09 cpuset.effective_mems</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  6 15:09 cpuset.mem_exclusive</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  6 15:09 cpuset.mem_hardwall</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  6 15:09 cpuset.memory_migrate</span><br><span class="line">-r--r--r-- 1 root root 0 Mar  6 15:09 cpuset.memory_pressure</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  6 15:09 cpuset.memory_spread_page</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  6 15:09 cpuset.memory_spread_slab</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  6 15:09 cpuset.mems</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  6 15:09 cpuset.sched_load_balance</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  6 15:09 cpuset.sched_relax_domain_level</span><br><span class="line">drwxr-xr-x 2 root root 0 Mar  6 15:09 cri-containerd-75f8e4b4185f673869604d300629ec2de934cf253244bf91c577f9fc0ba0f14a.scope</span><br><span class="line">drwxr-xr-x 2 root root 0 Mar  6 15:09 cri-containerd-cce0a338829921419407fcdc726d1a4bd5d4489da712b49a4834a020131ce718.scope</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  6 15:09 notify_on_release</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  6 15:09 pool_size</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  6 15:09 tasks</span><br></pre></td></tr></table></figure>
<p>其中 cri-containerd-75f8e4b4185f673869604d300629ec2de934cf253244bf91c577f9fc0ba0f14a.scope 和 cri-containerd-cce0a338829921419407fcdc726d1a4bd5d4489da712b49a4834a020131ce718.scope 为 pod 的两个容器，其中一个为 pause 容器，另外一个为 nginx 容器。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ crictl pods | grep nginx-deploy</span><br><span class="line">cce0a33882992       6 hours ago         Ready               nginx-deployment-67778646bb-mgcpg                          default             0                   (default)</span><br></pre></td></tr></table></figure>
<p>其中第一列的 cce0a33882992 为 pod id，cri-containerd-cce0a338829921419407fcdc726d1a4bd5d4489da712b49a4834a020131ce718.scope 对应的为 pause 容器，查看该目录下的 cpuset.cpus 文件，绑定了所有的核，并未做绑核操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ crictl ps | grep nginx-deploy</span><br><span class="line">75f8e4b4185f6       e4720093a3c13       6 hours ago         Running             nginx                      0                   cce0a33882992       nginx-deployment-67778646bb-mgcpg</span><br></pre></td></tr></table></figure>
<p>其中第一列的 75f8e4b4185f6 为 container id，cri-containerd-75f8e4b4185f673869604d300629ec2de934cf253244bf91c577f9fc0ba0f14a.scope 对应的为 nginx 容器。查看 &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;cpuset&#x2F;kubepods.slice&#x2F;kubepods-pod4dc3ad18_5bad_4728_9f79_59f2378de46e.slice&#x2F;cri-containerd-75f8e4b4185f673869604d300629ec2de934cf253244bf91c577f9fc0ba0f14a.scope&#x2F;cpuset.cpus 对应的值为<code>2-3</code>，说明绑核成功。</p>
<p><code>/var/lib/kubelet/cpu_manager_state</code> 文件内容如下，跟 cgroup cpuset 实际配置可以完全对应：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;policyName&quot;:&quot;static&quot;,&quot;defaultCpuSet&quot;:&quot;0-1&quot;,&quot;entries&quot;:&#123;&quot;4dc3ad18-5bad-4728-9f79-59f2378de46e&quot;:&#123;&quot;nginx&quot;:&quot;2-3&quot;&#125;&#125;,&quot;checksum&quot;:3689800814&#125;</span><br></pre></td></tr></table></figure>

<h2 id="kubelet-内部实现"><a href="#kubelet-内部实现" class="headerlink" title="kubelet 内部实现"></a>kubelet 内部实现</h2><p>在 kubelet 内部，采用 <a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/master/pkg/kubelet/cm/cpumanager/cpu_manager.go">cpu manager</a> 模式实现绑核功能。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>只能 by 节点配置，不能按照 pod 来灵活的配置。</li>
<li>无法适用于所有类型的 pod，pod 必须为 Guaranteed 时才允许开启。</li>
<li>修复配置较为麻烦，一旦配置变更后，需要删除文件 <code>/var/lib/kubelet/cpu_manager_state</code> 后才可生效，而且对现有的 pod 均有影响。</li>
</ol>
<h1 id="Memory-Manager"><a href="#Memory-Manager" class="headerlink" title="Memory Manager"></a>Memory Manager</h1><h2 id="kubelet-中参数配置"><a href="#kubelet-中参数配置" class="headerlink" title="kubelet 中参数配置"></a>kubelet 中参数配置</h2><p>k8s 1.21 版本引入，需要使用 featuregate 开启，参数 <code>--feature-gates=MemoryManager=true</code>。在k8s 1.22 版本为 beta 版本，默认开启。</p>
<p>kubelet 通过参数 <code>--memory-manager-policy</code> 来配置内存管理策略，支持如下值：</p>
<ol>
<li>none：默认策略，不执行任何内存分配的策略。</li>
<li>static：仅针对 Guaranteed pod 生效，对于 Guaranteed pod，会返回跟 NUMA 相关的 topology hint 信息。在该模式下，会修改 cgroup cpuset.mems 的配置为对应的 cpu core。</li>
</ol>
<p>kubelet 将已经分配的 pod 的内存绑定信息位于文件 <code>/var/lib/kubelet/memory_manager_state</code> 中，文件格式为 json。</p>
<h1 id="Topology-Manager"><a href="#Topology-Manager" class="headerlink" title="Topology Manager"></a>Topology Manager</h1><p>Topology Manager 特性理解起来比较抽象。举个例子说明：上述的 CPU Manager 和 Memory Manager 的特性，在 kubelet 的实现中是完全独立的，可能会导致 cpu 和内存被分配到了不同的 numa 节点上，CPU Manager 通过 cgroup 的 cpuset.cpus 来控制容器要绑定的 cpu，而 Memory Manager 则通过 cgroup 的 cpuset.mems 来控制容器要使用的 NUMA node 内存。如果两者的信息不匹配，则会导致跨 NUMA Node 的内存访问，从而会对于性能要求高的应用产生影响。<br />Topology Manager 是 kubelet 中的一部分功能，通过 Hint Providers 来发送和接收各个模块的 NUMA 拓扑信息，比如接收 CPU Manager 和 Memory Manager 的 NUMA Node以及 NUMA Node 分配的优先级。</p>
<h2 id="kubelet-的参数配置-1"><a href="#kubelet-的参数配置-1" class="headerlink" title="kubelet 的参数配置"></a>kubelet 的参数配置</h2><p>kubelet 通过参数<code>--topology-manager-scope</code>来指定作用域：</p>
<ol>
<li>container：默认值，按照容器级别分配到共同的 NUMA node 集合上。</li>
<li>pod：将 pod 内的所有 container 分配到共同的 NUMA node 集合上。</li>
</ol>
<p>kubelet 通过参数 <code>--topology-manager-policy</code> 来设置 NUMA 的分配策略：</p>
<ol>
<li>none：默认值，不执行任何的拓扑对齐。</li>
</ol>
<ul>
<li>best-effort：优先选择首选亲和性的 NUMA node，如果亲和性不满足，pod 仍然可以调度成功。</li>
<li>restricted：选择首选亲和性的 NUMA node，如果亲和性不满足，pod 调度失败。</li>
<li>single-numa-node：通过 Hint Provider 返回的结果，判断单 NUMA 节点的亲和性是否，如果不满足，则 pod 调度失败。</li>
</ul>
<h2 id="kubelet-中的实现"><a href="#kubelet-中的实现" class="headerlink" title="kubelet 中的实现"></a>kubelet 中的实现</h2><p>在 kubelet 中定义了接口：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TopologyHint is a struct containing the NUMANodeAffinity for a Container</span></span><br><span class="line"><span class="keyword">type</span> TopologyHint <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// 记录了 NUMA Node 满足资源请求的位掩码</span></span><br><span class="line">	NUMANodeAffinity bitmask.BitMask</span><br><span class="line">	<span class="comment">// Preferred is set to true when the NUMANodeAffinity encodes a preferred</span></span><br><span class="line">	<span class="comment">// allocation for the Container. It is set to false otherwise.</span></span><br><span class="line">    <span class="comment">// 亲和性的结果是否为首选的</span></span><br><span class="line">	Preferred <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HintProvider is an interface for components that want to collaborate to</span></span><br><span class="line"><span class="comment">// achieve globally optimal concrete resource alignment with respect to</span></span><br><span class="line"><span class="comment">// NUMA locality.</span></span><br><span class="line"><span class="keyword">type</span> HintProvider <span class="keyword">interface</span> &#123;</span><br><span class="line">    <span class="comment">// GetTopologyHints returns a map of resource names to a list of possible</span></span><br><span class="line">    <span class="comment">// concrete resource allocations in terms of NUMA locality hints. Each hint</span></span><br><span class="line">    <span class="comment">// is optionally marked &quot;preferred&quot; and indicates the set of NUMA nodes</span></span><br><span class="line">    <span class="comment">// involved in the hypothetical allocation. The topology manager calls</span></span><br><span class="line">    <span class="comment">// this function for each hint provider, and merges the hints to produce</span></span><br><span class="line">    <span class="comment">// a consensus &quot;best&quot; hint. The hint providers may subsequently query the</span></span><br><span class="line">    <span class="comment">// topology manager to influence actual resource assignment.</span></span><br><span class="line">    GetTopologyHints(pod *v1.Pod, container *v1.Container) <span class="keyword">map</span>[<span class="type">string</span>][]TopologyHint</span><br><span class="line">    <span class="comment">// GetPodTopologyHints returns a map of resource names to a list of possible</span></span><br><span class="line">    <span class="comment">// concrete resource allocations per Pod in terms of NUMA locality hints.</span></span><br><span class="line">    GetPodTopologyHints(pod *v1.Pod) <span class="keyword">map</span>[<span class="type">string</span>][]TopologyHint</span><br><span class="line">    <span class="comment">// Allocate triggers resource allocation to occur on the HintProvider after</span></span><br><span class="line">    <span class="comment">// all hints have been gathered and the aggregated Hint is available via a</span></span><br><span class="line">    <span class="comment">// call to Store.GetAffinity().</span></span><br><span class="line">    Allocate(pod *v1.Pod, container *v1.Container) <span class="type">error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CPU Manager、Memory Manager 和 Device Manager 均实现了该接口。在 Topology Manager 中根据各个 Manager 返回的 TopologyHint 数据，从而决定最终的 NUMA Node 分配，并调用各个 Manager 的 Allocate 来做最终的 NUMA Node 分配。</p>
<h1 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.alibabacloud.com/help/zh/ack/ack-managed-and-ack-dedicated/user-guide/topology-aware-cpu-scheduling">ACK CPU拓扑感知调度</a></li>
<li><a target="_blank" rel="noopener" href="https://v1-25.docs.kubernetes.io/zh-cn/docs/tasks/administer-cluster/cpu-management-policies/">控制节点上的 CPU 管理策略</a></li>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/quality-service-pod/">配置 Pod 的服务质量</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/784148">Kubelet之Topology Manager分析</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://kuring.me/post/kubeconfig/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="404频道">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 404频道">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/post/kubeconfig/" class="post-title-link" itemprop="url">kubeconfig</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-22 19:58:22" itemprop="dateCreated datePublished" datetime="2024-03-22T19:58:22+00:00">2024-03-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-09-19 16:11:31" itemprop="dateModified" datetime="2024-09-19T16:11:31+00:00">2024-09-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="kubeconfig-文件结构"><a href="#kubeconfig-文件结构" class="headerlink" title="kubeconfig 文件结构"></a>kubeconfig 文件结构</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Config</span></span><br><span class="line"><span class="attr">clusters:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">cluster:</span></span><br><span class="line">    <span class="attr">certificate-authority-data:</span> <span class="string">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJME1ETXlNVEE0TXpZMU1Wb1hEVE0wTURNeE9UQTRNelkxTVZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTFBaCjZUcUFNMVhiRkxIbnVvd1ZNT1FHeWQ2SzVBcGdwcmhYSlBvclVKdStoazBKd3BQQlNRZGNSdnJjYy9wNTNDbnQKTTBXWVN4dThTd1Z6a0dHajh0cHNSNjRkMWMxdFk1djYzYnlkVXN5M3JwME1OWUt1ckJPNEY2aVFLK01oL3R6UAp4eUdZei9BUnhheDdXNysvWEV6Y2FsdFp5T1JZZk9ISUR5ZjN5R3V2T1htYmw5ZEJmRHFBMFlSMGxOTFFlUEcrCm5lZkVGb1dUQncxUytiZEl0MDBRZnl3MVlvRXpkOFd6UDRBTzFlV3AxK0tJdFhLaUxyaWFBbjkzNTJhbnVIT2YKQ3h0U0NCbEwwRThCL3dGKzhTd0RQbDlUYkNhZU1nTUJpY2hsQzlYSjNrV2k2cElOVnVEeEpRUy82cnlwQWhLbgpHK21RWlJIdmhsUk1wTjhEbDBzQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZLay8zWDh0Q1dhZEpKN011SjNRNE5DL2xHd3pNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBSDR1K05zbE9ORWJVZXB1M0JaRQozL1hnQitFNDZVZ3N2d2R6UzhEWXF3YzBWQ28vUFc0RUNreW9IUkJINHJkdTVpaTBhVUhjZUxpNjhZQjlvQ3hpCmlkbHp3bUNGV1g1dEtGMUJTRFJ1YSt5MjVrOGZuSGtodm5IVG9CQ2c5ZlMzdFBOekNUdEtMSUhyVFpQVDhWU3IKdVYyZkdOcXMyT2djWjc4TmY4M2pnVVBXbFVPZkVsTDBrYjNYVHo5M29DdnF0RS9tRi9VOWhmOUdiRU5Lai9BSAovUHA4QWNmellkVGxGNTBva09temVFdnJnalZmaXFKMitGd2I5Lys1SUljSWFMR3IwZjVUMUVINzdxVEdEWElWCncwWGlKYmVTL1JTYTYrZFM0b1dRMS82Ryt1SUdRQWx0eTRSTXdqbG4rMTMvdStPelowTHErNzBlQTdUSm5mU0MKRVhBPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">https://127.0.0.1:55282</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kind-kind</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">cluster:</span></span><br><span class="line">    <span class="attr">certificate-authority-data:</span> <span class="string">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURsRENDQW55Z0F3SUJBZ0lVQVFVeTNtWi80eWZmbEhjTi9WblNIcUYwL0NRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lqRUxNQWtHQTFVRUJoTUNWVk14Q3pBSkJnTlZCQWdUQWtOQk1SSXdFQVlEVlFRSEV3bFRkVzV1ZVhaaApiR1V4RURBT0JnTlZCQW9UQjB0MVltVmFiMjh4Q3pBSkJnTlZCQXNUQWtOQk1STXdFUVlEVlFRREV3cExkV0psCmNtNWxkR1Z6TUI0WERUSTBNRE15TVRBNE16a3dNRm9YRFRJNU1ETXlNREE0TXprd01Gb3dZakVMTUFrR0ExVUUKQmhNQ1ZWTXhDekFKQmdOVkJBZ1RBa05CTVJJd0VBWURWUVFIRXdsVGRXNXVlWFpoYkdVeEVEQU9CZ05WQkFvVApCMHQxWW1WYWIyOHhDekFKQmdOVkJBc1RBa05CTVJNd0VRWURWUVFERXdwTGRXSmxjbTVsZEdWek1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXlNNGo2d1NSdTUrcFpwckk1WkhxdmYycXpJdTUKSlZkYzRFUEp3cGY5eU9LN1FPZFM1SHJRUzVNK3ZEMFMzOUNJVFVYY2YxZUNJZy83SEt4TmVFbVk0TVdCMVlBWQpZOVRjMkZlR3JMMVBFR0lwNER6TnRRMkhvcWFxU2pJd0d0bnh3RjV5OGRRUGJkQ3JOdllDRVl5QlR2S0VtUXVoClFmdDhJR1NmaWJ0M3gwa2ZaaUFqZTJ5SDJabFNyMnBRSzRWWFdWUU5UV0hOQnlMS29Lb05Yazl2UTQ4dHhYbVUKcFRDWUxjcGdZSC9tU0lpY1FOcDQwRjRaOUUraGFjdTVkYVFVakIzZzQxWEVvYXBzL2xSa3d0bVFlV1gwVjR2VQp3cUlCS0doZmJ3dmluUjAvTmJGOVVLVldaVlpVL2R0NHR6TXQxVHg4L2tmcExmL0xnNXdoOThUSkJ3SURBUUFCCm8wSXdRREFPQmdOVkhROEJBZjhFQkFNQ0FRWXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVUKWXp4aGFlN2V3TXNIeEJ5YnQ4U0Ntb01zVGg0d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFFWk5uUjI5SDVjRwpJSFBKdDlNMk5YZGt1NzFuU2VZb2s3SFBVdnJ6V0JOdFJjMUJPZkJRc25zb0RRcDQ1SmQxUnZsOEdLRHJjOCtICm5yaXZGQXpPZFRPQlhib3RMcFdGc0U1WU5VcGlUbWU2aW9pUVRVTnQ2WCtLd29CV00xNUwyWlJBYXdQQ0FBZ0sKeWRRU2lZaHVZMS93ekltWW1LenczRjVYb1BJcHVjTjhNam1MM3ZPNlFPaW51OFQrcW9wbWlmRFMraUVzRjcwSApwaW9mVXFJR3Zmbm5uVFFTWnFrRFAybXZ2VHFqT1lCbjU1dHRsL2JYQzh2ZHlwakNGVWRGOXNjUFM5R28ycTRuClkySUUvdHIvUFhaODUvUVVsdVQ2UEd5VUMycDNhZmNhdXRBbC9hQUZvM1ltK3BNbW03WUhad2JjcUp6U3BmRXIKbnJaekRNZFNGS2c9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">https://127.0.0.1:6443</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">zoo</span></span><br><span class="line"><span class="attr">contexts:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">context:</span></span><br><span class="line">    <span class="attr">cluster:</span> <span class="string">kind-kind</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">kind-kind</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kind-kind</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">context:</span></span><br><span class="line">    <span class="attr">cluster:</span> <span class="string">zoo</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">zoo-admin</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">zoo</span></span><br><span class="line"><span class="attr">current-context:</span> <span class="string">kind-kind</span></span><br><span class="line"><span class="attr">preferences:</span> &#123;&#125;</span><br><span class="line"><span class="attr">users:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kind-kind</span></span><br><span class="line">  <span class="attr">user:</span></span><br><span class="line">    <span class="attr">client-certificate-data:</span> <span class="string">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURJVENDQWdtZ0F3SUJBZ0lJSkNhSHFyUUl0b0l3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRBek1qRXdPRE0yTlRGYUZ3MHlOVEF6TWpFd09ETTJOVEphTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXFNS1VOcStyTGNPTkxDWmMKTjA4SjBpYzhBdnhjdmlZNG40SVN1UFFleVViYUhLTVpRNnJpNjA4SlZoNUZxc3B3N3BoWTkrYVBMTHJQaG9uWApCQWhQdmVSSVVxeDdaTkJhODNuVUIrTXIrOXIrazAwTk1yNDBTdkg5aGpnTXVZUjFvN051OWRzN1k3U0pOcXVsCnlwOVN6YzUwUTNBbzh1cHBTRFlFRW5Hd3I0VVBidlp0ZTVlQXo2T2hDYy9hazZuZGlFcU9hMkdJRzhlUmEyWTkKM2hBQjl6V3YvVldGTkxFNXh2Mm5oS3JDQVl6TzBrVmJwTkNlSmkxRGFvNTIzQURWajhGQjRFbDFVNCtvTmM2Vwo5VHdRbDFIUklxZXJ6MUFMTFl1THhadGFFY2IwYW04N2dTcEtyaXcrYWVBL3h6L29tQ1BLY1IrQTBSTkpBcVdWCnduTzhDUUlEQVFBQm8xWXdWREFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0RBWURWUjBUQVFIL0JBSXdBREFmQmdOVkhTTUVHREFXZ0JTcFA5MS9MUWxtblNTZXpMaWQwT0RRdjVScwpNekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBbjVCalc3VEZvYlBxWk5obS82cEJPVUdGUmVncHFKYVcrUFN1CktUVU5qNXdDU1ZjTWg3V2RmQWtBSGxrYzQ5YWZlaHpWZmVwUXJEUEpOam96eCsxOGc2ZmtNalJRdEhRaW9yYSsKck82UklBYnVJR0pqTXBKVGNGL25OMkY4amFzdFlrdkZ1cjNtdlVldzhsWmtEZEdYMFFaU0J2Y0xqVGdvZURmSQpLTmhjMGVaQ2QrMStGeVJYajZwaUs4Y3pBWlkvTTVsVHJSZTVQUmJSaHpMeVo0Wm1nMHZjOUZjZFcxbThVZ2hDCkVOWkZCVDA0WTl2bHRGTHJaSG9IRlFERlNKRUxTSnl5VG95dTVnYVh6OElZUm41Y0k0b1RPZXlKN2JvQ3hvdzEKa3VXbWdxbVZHdjZwUWJqRm0zaTBTZXFRMkQ5bU1SaDhsYW0vMlhiaVlyWlBjQUlaRnc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==</span></span><br><span class="line">    <span class="attr">client-key-data:</span> <span class="string">LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBcU1LVU5xK3JMY09OTENaY04wOEowaWM4QXZ4Y3ZpWTRuNElTdVBRZXlVYmFIS01aClE2cmk2MDhKVmg1RnFzcHc3cGhZOSthUExMclBob25YQkFoUHZlUklVcXg3Wk5CYTgzblVCK01yKzlyK2swME4KTXI0MFN2SDloamdNdVlSMW83TnU5ZHM3WTdTSk5xdWx5cDlTemM1MFEzQW84dXBwU0RZRUVuR3dyNFVQYnZadAplNWVBejZPaENjL2FrNm5kaUVxT2EyR0lHOGVSYTJZOTNoQUI5eld2L1ZXRk5MRTV4djJuaEtyQ0FZek8wa1ZiCnBOQ2VKaTFEYW81MjNBRFZqOEZCNEVsMVU0K29OYzZXOVR3UWwxSFJJcWVyejFBTExZdUx4WnRhRWNiMGFtODcKZ1NwS3JpdythZUEveHovb21DUEtjUitBMFJOSkFxV1Z3bk84Q1FJREFRQUJBb0lCQUJzQWR5S0EzUXpIZXpFVApPaklIVFhUNG5odUVNWHFqTnZBZXFjdzZFeXIxVVRTL3krME56SjBGMm1LVEdXYUlXYVZ6YnRqTFpTRXRDc05tCkRxY3doVUhHNHVPSGdYN1I3NXVCWkxHV1laVThwdnIrbXh3Qlh2Q1c0NCswTENVSzBwL010L1pTaTZBYVpOSUEKaU5od3daajRiWlhVdmxpUHRTUytyOHdic0wrRWNqTGFtZVhlQWNpTDByNTVzZzA5akxhSENkNnhQZ29FYlFPawpKR25kZ1JsSTFSZis5RGdON0toRkdQMkEvOGJEMytONERZT3pRcm8zWE1ZcG9kNyt3ODlkclFnOG9ob2pRQkd5CjZrR0tNeXdsaktNRmxuV3c4bmYwbDU4VzVibWo2enp3RzZPcDQra21wVStyc3pqR0JEdDQ1QnlQNUhTbEFEelMKYzNudFArRUNnWUVBeUhGc1l0aHZ4Vk1sVWdzZTViRzVWYXdwUGNjU3JuY0p3SXU4U1AvaExYUi9POUsvZVhwTAo2OUhtemNMSW1Dd1J1cWwzdUEvQlhYR1hpNlh5SWMvK3k0bzZyUEhoZk4wS2x5cFVOTXd4Ri9FY0t2VklmeE1ECjM2Uks5eVdvem5zVUFVVkw5L0dPK2ViK0dLOGtQRHYyVFdwTEVIVDFjVFc4aHNNV3JvTENLclVDZ1lFQTE0a1IKT2FWejBEbHFLUXlNSU0zVkk4Kzc4TUNOTzdUTFVOait4SWRyV2lGLzlCOG8wSVp3dG5GREo1OHE3dWZNcHhpTAptZEtwRENHcGhIWmhRQzYxWEhBNXEyVFIzamxhK1ArdnpTRVNxeWIvWWhrelk3dDdZY0xMSFBValRiWXpmV2I0Cjl6TjdTNkF6NWM2aGs1Nzd3RmxTODE2KzlWK2pBVW5MaWdkZzNJVUNnWUVBb1BlbFNRUHpUbzNsREt2dGxoeFIKYitHZ0JRS1htQS8wZnZJNHRJNzRzRjQ3eHprSmwyNkZCYzQ5QWNTSS90dDFLV2Zxd3ArMGMyeERmVnc0eExxYQpMYTdHVEJpN01tRDRua2paOHNTQU1HL3FaUDB4eVFybU0zVm0xbThoengrOEF3RTVidFpJTVp3MU5uR0FNZmNkClp6SVRNaFlhL1YxZ0Z3RVlkL0IrS1hrQ2dZRUFxdzA1b1dGQVAxRkJnaUJXR1RhaFg1RmVXeHZGT2t3cVN4aGIKWUVjRW1Id2JtdmNib2huLzI1cVpyQmt5cm5WQndwN0ZNNmV1eDFUenZvOWdjTnBnem1LMk1lS0tkKzFXMkdPNgo5blczNWlMRjdPbUpFaTVaSmVXODRsZGQxQyswUDJKNFZWOERDNnF4WlVFT2xDUkpNWWJ5UVBqQlhlU3ZiYmRPCkZGWDB0aTBDZ1lBZDNXTjl2SlN5UUxDUDlHdHA0dVRJQXpYRlFGbkJiY2ZKVzdaL2hnUXlZUWlWa0p6K3pQSCsKclU5RWE3ZTVyTlg0MmtuK2E1cXpudXZEeE5aMDhjRjYwdFBBajR2T1UrTkZyb2FyU29xL3lreTJMTnR2LzJ0OApocXJQblk0dE04dFpON2w5NktHSklJdzlVUXcyR2NpS3JXSXkvT0NQR2lERGthakhGS2lndlE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">zoo-admin</span></span><br><span class="line">  <span class="attr">user:</span></span><br><span class="line">    <span class="attr">client-certificate-data:</span> <span class="string">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQyRENDQXNDZ0F3SUJBZ0lVYlBFdGx4LzRTYm9TckRvZTd1djllS1YrckZNd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lqRUxNQWtHQTFVRUJoTUNWVk14Q3pBSkJnTlZCQWdUQWtOQk1SSXdFQVlEVlFRSEV3bFRkVzV1ZVhaaApiR1V4RURBT0JnTlZCQW9UQjB0MVltVmFiMjh4Q3pBSkJnTlZCQXNUQWtOQk1STXdFUVlEVlFRREV3cExkV0psCmNtNWxkR1Z6TUI0WERUSTBNRE15TVRBNE16a3dNRm9YRFRJMU1ETXlNVEE0TXprd01Gb3dhVEVMTUFrR0ExVUUKQmhNQ1ZWTXhDekFKQmdOVkJBZ1RBa05CTVJJd0VBWURWUVFIRXdsVGRXNXVlWFpoYkdVeEZ6QVZCZ05WQkFvVApEbk41YzNSbGJUcHRZWE4wWlhKek1SQXdEZ1lEVlFRTEV3ZExkV0psV205dk1RNHdEQVlEVlFRREV3VmhaRzFwCmJqQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU1PYnpoeDBOTW5ubTdHbmFjb2sKWHJ1RmxrRVBXc01la2xLNnBtbWFDRUVVUTNocHdsUWw2Z09UekpwaUVYVGZMZU1Uc29ZZ1NtNGFySWdjdVlTcwo3cDdzdWhhUi9RN1g3SUZjMXJEMzFtODB5amZEVUhYZi9jSWhDVmp0NDhLY1JLL2QrK2NzZkU5eHpEdlVBdDVxCmxmNFNvMy9YSnJyYzdtdURiUXdYdDgvaGQ4RnVZYUFWN2YraXVMMW5DRTB3b01IaFNPSkpEWC9TQ1pMakxTS2wKYU9aM2lOL0dDRXo4cldPUmVBbGUwQzRwazRwc0xmN1h6UlJpcnFTT21lQ3JTZzJoNlU1OS8xTHN5dXVqeTVFWQpxT3RsZ0R0Z3l5RDhBRWZhanM5R0NNRnFFOStHZWR6NkpuRmFlUlpOZThlVWNhVU1GWFVSWjYxb0pqT2UraUZ4CjU3TUNBd0VBQWFOL01IMHdEZ1lEVlIwUEFRSC9CQVFEQWdXZ01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUIKQmdnckJnRUZCUWNEQWpBTUJnTlZIUk1CQWY4RUFqQUFNQjBHQTFVZERnUVdCQlRPL0JxUE9HcVU1V0JYSW9wQgoxajdxYVBvTkh6QWZCZ05WSFNNRUdEQVdnQlJqUEdGcDd0N0F5d2ZFSEp1M3hJS2FneXhPSGpBTkJna3Foa2lHCjl3MEJBUXNGQUFPQ0FRRUF0SVRaN0FUVVhManB6UWtQVGM0RVFKYi9IZlJTcklOV3pSMlpRcVI1Q2J1dXEzR08KUktDZFphenVrakJjMCtXVkhGcVo4SEtNNUR2YThKbzZCUXgycXoxZ0ptVE1oYUdRMFlyNWFFcmxFZWJCWUcwVgpLMGh4LzJuMmNmMkt3N3VBOWdkeUJKSVFJbnY2RFJPUmt6VVNuQXJEd21TNitUNXdKK0lTUGlPdHVGRnQzazRyClZsZ1N3bjE5WHRSRnJ4OEI4dWRkSlZ4VEloN3FPa09hbURQaFJrTGJKNFdOUk5hYlpVMFVxdmxUQzVnQkhnS2QKSm1FaVQybHNoUENjS2lRZWsrTVNzNU9mNG9ZQml0TXM0eW1iendXb1hVaGcvVnRTbTdtT2MzUmo2ZGhrQXl2NwozQTJoZW1xUENKQ1JwbndzUDlpd0VrWUE0SlFZMG53aEUrd1h2Zz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</span></span><br><span class="line">    <span class="attr">client-key-data:</span> <span class="string">LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBdzV2T0hIUTB5ZWVic2FkcHlpUmV1NFdXUVE5YXd4NlNVcnFtYVpvSVFSUkRlR25DClZDWHFBNVBNbW1JUmROOHQ0eE95aGlCS2JocXNpQnk1aEt6dW51eTZGcEg5RHRmc2dWeldzUGZXYnpUS044TlEKZGQvOXdpRUpXTzNqd3B4RXI5Mzc1eXg4VDNITU85UUMzbXFWL2hLamY5Y211dHp1YTROdERCZTN6K0Yzd1c1aApvQlh0LzZLNHZXY0lUVENnd2VGSTRra05mOUlKa3VNdElxVm81bmVJMzhZSVRQeXRZNUY0Q1Y3UUxpbVRpbXd0Ci90Zk5GR0t1cEk2WjRLdEtEYUhwVG4zL1V1eks2NlBMa1JpbzYyV0FPMkRMSVB3QVI5cU96MFlJd1dvVDM0WjUKM1BvbWNWcDVGazE3eDVSeHBRd1ZkUkZucldnbU01NzZJWEhuc3dJREFRQUJBb0lCQUhMZ0ZYTndhM0FIck0vdwpXWmgxTTQwOUxyaVdvOTdqSFZ1b2NnS2lpeVp0R0JLblNaRFJrMVQyZjdwS3phV3RTKzJIcTloSkxtenJEVmdDClJwRThYZ2JIVDZIaHFwUUZDc2dPRmFkb1pXNTV1aWgxYzlORjhHa0pyY3VrS1pZbzM4M0l1QjlUYU0zZkx1b1QKNEh0dWJSZ0JLalB4enJUKytxWDVVUmxBOUpvSDc2c1hUb1JkYXF5YzR6VXMwcm9LNmVTb3dZeE8ydVN5TmtQcQpkai9reFJ4WTV2djYveHpPOHhVU1dUWndwVit2VUgvbVJiU1hjSjJrKzRvTDB5VmJSLzFpVStPYmpkSWU4UXNOCkhHMjBNSk9zRS9LTVVuVUlSeGxqRGlaM1o4WjVabXIrTUVTV3daOWRkUWlJbm80dSt6UkVaRTcvbnlwQ2lTY0UKOHlBNG9FRUNnWUVBOVpHbHRLdG8yaHRzZXBuWnNwdFVFdEorbXo2a001bEI2SHdpVVd3Q05ZSXpUQzRra2J2MwpXSzVMYXFpaXEwUk5zOHZSbmNXSHlwMHFidTlyOHNUellRUVVvc0luVStReGlLMUd0Uk81cVV4TE9SZzZlSjViClNCM0JoNnVQdVMyUU9qSlNKbU9uWldkUHFrRXJqSW9LWWZhT00wUGIxaUVlUzBWVUVyVWZaVGNDZ1lFQXkrcmgKeDlzM0FnMVk0bkVpVThsbGpDNlZQYk8yQ3pRM3ViWXJlcjhobVFTYkRsQjBHMEhOVE01YWNaSFdNVUdnWWVlagpUbFJCcVQvbFZtOXV3NFBxc1Ezejl4QnB0YmZDVUpqeEVucnJWQkdpeElNeHlGMU85WTh2WVRkZENLa3VVVVE5CnEybnpuNzNMNGdDRDlMcW4yYlFpaEFucHdTamcySytFQ2V4RlQyVUNnWUVBdWJIM2tsV0VKbHBTZjZ0VG1lSW4KZzB3MWZRT3plMmxMRTVpN0FzTWdNSUpTZENyNGNGT3BTU0FUMjRYRjdLanI4U2dSVExNUWFrREswN1NzOXBuRQpTUHFpK0NqRlFJVHdpQ0F2dGNKQ3hTanlRU3gzR3JyMDMrWFFjTjFsQTJ6WEFZc0g0QXUvaThqQnowY1V2V090ClVrTDFhUUxKZkhUeXlZeVZkTWdPQTZVQ2dZQndDcUY5dDFRVkc1SlA4UXVFYis4TXcvZWFUR2prNVE4TlNpdS8KcU03a0RhVElpNm9QNCtyU25ic1NGYWhUcmhSYVZ2VGlyK2JZQU5TWTFtZE1vK25LMkxqSWNrc3kza0cxR1NPMApITGU2bkdvTGdXNVVBZmpGY2FQOXpYYWZzSjFUWjZSZXo3dGRkT0pXVGlReXpuQTFiUVZkK1RobnVuYzRkOCtiCnlDY1pCUUtCZ0ZWcFZacDdjWUxHYlE1dERkL0orZ1BhcFo0TWFYSzluWDFTaktlalhjcVFFSUc3NEYrdkxzdEwKZCs4R3N0VkRzdy8vQ0VNcW9pYXZ1MkVlQ0VQZzF3ZHpDU3pWa2IrZ1FRZXA0cE1LZEhaai9YaysvNVVXTUJzOApkNnNwMWxrTTRqSGhjYkFLU056VTUrTG1NRnk0MzBPZlI2dmxVTFZjNVlaR2hSU0ZCdzdDCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==</span></span><br></pre></td></tr></table></figure>

<h2 id="cluster-字段"><a href="#cluster-字段" class="headerlink" title="cluster 字段"></a>cluster 字段</h2><p>certificate-authority-data 字段：服务端的 ca 证书，用来验证 kube-apiserver 证书的正确性。<br />当使用 kubectl 发送请求到 kube-apiserver 时，kube-apiserver 会返回通过参数 <code>--tls-cert-file</code> 配置的证书文件，kubectl 通过 kubeconfig 中的 certificate-authority-data 字段来校验 kube-apiserver 返回证书的有效性。<br />当 kubectl 指定了参数 <code>--insecure-skip-tls-verify=true</code>，即可跳过对 kube-apiserver 证书的校验。</p>
<h2 id="users"><a href="#users" class="headerlink" title="users"></a>users</h2><ul>
<li>name：用户名称</li>
<li>client-certificate-data：kubectl 连接 kube-apiserver 时使用的客户端证书，会发送给 kube-apiserver。内容经过 base64 编码。</li>
<li>client-key-data：客户端私钥信息。内容经过 base64 编码。</li>
</ul>
<p>client-certificate-data 对应的为用户的公钥信息，使用命令 <code>echo &#39;xx&#39; | base64 -d &gt; /tmp/client.crt; openssl x509 -in /tmp/client.crt -noout -text</code>可对证书的内容进行解密。解密完成后的证书内容如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Certificate:</span></span><br><span class="line">    <span class="attr">Data:</span></span><br><span class="line">        <span class="attr">Version:</span> <span class="number">3</span> <span class="string">(0x2)</span></span><br><span class="line">        <span class="attr">Serial Number:</span> <span class="number">2604918601715070594</span> <span class="string">(0x242687aab408b682)</span></span><br><span class="line">        <span class="attr">Signature Algorithm:</span> <span class="string">sha256WithRSAEncryption</span></span><br><span class="line">        <span class="attr">Issuer:</span> <span class="string">CN</span> <span class="string">=</span> <span class="string">kubernetes</span></span><br><span class="line">        <span class="string">Validity</span></span><br><span class="line">            <span class="attr">Not Before:</span> <span class="string">Mar</span> <span class="number">21</span> <span class="number">08</span><span class="string">:36:51</span> <span class="number">2024 </span><span class="string">GMT</span></span><br><span class="line">            <span class="attr">Not After :</span> <span class="string">Mar</span> <span class="number">21</span> <span class="number">08</span><span class="string">:36:52</span> <span class="number">2025 </span><span class="string">GMT</span></span><br><span class="line">        <span class="attr">Subject:</span> <span class="string">O</span> <span class="string">=</span> <span class="string">system:masters,</span> <span class="string">CN</span> <span class="string">=</span> <span class="string">kubernetes-admin</span></span><br><span class="line">        <span class="attr">Subject Public Key Info:</span></span><br><span class="line">            <span class="attr">Public Key Algorithm:</span> <span class="string">rsaEncryption</span></span><br><span class="line">                <span class="attr">Public-Key:</span> <span class="string">(2048</span> <span class="string">bit)</span></span><br><span class="line">                <span class="attr">Modulus:</span></span><br><span class="line">                    <span class="attr">00:a8:c2:94:36:af:ab:2d:c3:8d:2c:26:5c:37:4f:</span></span><br><span class="line">                    <span class="attr">09:d2:27:3c:02:fc:5c:be:26:38:9f:82:12:b8:f4:</span></span><br><span class="line">                    <span class="attr">1e:c9:46:da:1c:a3:19:43:aa:e2:eb:4f:09:56:1e:</span></span><br><span class="line">                    <span class="attr">45:aa:ca:70:ee:98:58:f7:e6:8f:2c:ba:cf:86:89:</span></span><br><span class="line">                    <span class="attr">d7:04:08:4f:bd:e4:48:52:ac:7b:64:d0:5a:f3:79:</span></span><br><span class="line">                    <span class="attr">d4:07:e3:2b:fb:da:fe:93:4d:0d:32:be:34:4a:f1:</span></span><br><span class="line">                    <span class="attr">fd:86:38:0c:b9:84:75:a3:b3:6e:f5:db:3b:63:b4:</span></span><br><span class="line">                    <span class="attr">89:36:ab:a5:ca:9f:52:cd:ce:74:43:70:28:f2:ea:</span></span><br><span class="line">                    <span class="attr">69:48:36:04:12:71:b0:af:85:0f:6e:f6:6d:7b:97:</span></span><br><span class="line">                    <span class="attr">80:cf:a3:a1:09:cf:da:93:a9:dd:88:4a:8e:6b:61:</span></span><br><span class="line">                    <span class="attr">88:1b:c7:91:6b:66:3d:de:10:01:f7:35:af:fd:55:</span></span><br><span class="line">                    <span class="attr">85:34:b1:39:c6:fd:a7:84:aa:c2:01:8c:ce:d2:45:</span></span><br><span class="line">                    <span class="attr">5b:a4:d0:9e:26:2d:43:6a:8e:76:dc:00:d5:8f:c1:</span></span><br><span class="line">                    <span class="attr">41:e0:49:75:53:8f:a8:35:ce:96:f5:3c:10:97:51:</span></span><br><span class="line">                    <span class="attr">d1:22:a7:ab:cf:50:0b:2d:8b:8b:c5:9b:5a:11:c6:</span></span><br><span class="line">                    <span class="attr">f4:6a:6f:3b:81:2a:4a:ae:2c:3e:69:e0:3f:c7:3f:</span></span><br><span class="line">                    <span class="attr">e8:98:23:ca:71:1f:80:d1:13:49:02:a5:95:c2:73:</span></span><br><span class="line">                    <span class="string">bc:09</span></span><br><span class="line">                <span class="attr">Exponent:</span> <span class="number">65537</span> <span class="string">(0x10001)</span></span><br><span class="line">        <span class="attr">X509v3 extensions:</span></span><br><span class="line">            <span class="attr">X509v3 Key Usage:</span> <span class="string">critical</span></span><br><span class="line">                <span class="string">Digital</span> <span class="string">Signature,</span> <span class="string">Key</span> <span class="string">Encipherment</span></span><br><span class="line">            <span class="attr">X509v3 Extended Key Usage:</span></span><br><span class="line">                <span class="string">TLS</span> <span class="string">Web</span> <span class="string">Client</span> <span class="string">Authentication</span></span><br><span class="line">            <span class="attr">X509v3 Basic Constraints:</span> <span class="string">critical</span></span><br><span class="line">                <span class="string">CA:FALSE</span></span><br><span class="line">            <span class="attr">X509v3 Authority Key Identifier:</span></span><br><span class="line">                <span class="string">A9:3F:DD:7F:2D:09:66:9D:24:9E:CC:B8:9D:D0:E0:D0:BF:94:6C:33</span></span><br><span class="line">    <span class="attr">Signature Algorithm:</span> <span class="string">sha256WithRSAEncryption</span></span><br><span class="line">    <span class="attr">Signature Value:</span></span><br><span class="line">        <span class="attr">9f:90:63:5b:b4:c5:a1:b3:ea:64:d8:66:ff:aa:41:39:41:85:</span></span><br><span class="line">        <span class="attr">45:e8:29:a8:96:96:f8:f4:ae:29:35:0d:8f:9c:02:49:57:0c:</span></span><br><span class="line">        <span class="attr">87:b5:9d:7c:09:00:1e:59:1c:e3:d6:9f:7a:1c:d5:7d:ea:50:</span></span><br><span class="line">        <span class="attr">ac:33:c9:36:3a:33:c7:ed:7c:83:a7:e4:32:34:50:b4:74:22:</span></span><br><span class="line">        <span class="attr">a2:b6:be:ac:ee:91:20:06:ee:20:62:63:32:92:53:70:5f:e7:</span></span><br><span class="line">        <span class="attr">37:61:7c:8d:ab:2d:62:4b:c5:ba:bd:e6:bd:47:b0:f2:56:64:</span></span><br><span class="line">        <span class="attr">0d:d1:97:d1:06:52:06:f7:0b:8d:38:28:78:37:c8:28:d8:5c:</span></span><br><span class="line">        <span class="attr">d1:e6:42:77:ed:7e:17:24:57:8f:aa:62:2b:c7:33:01:96:3f:</span></span><br><span class="line">        <span class="attr">33:99:53:ad:17:b9:3d:16:d1:87:32:f2:67:86:66:83:4b:dc:</span></span><br><span class="line">        <span class="attr">f4:57:1d:5b:59:bc:52:08:42:10:d6:45:05:3d:38:63:db:e5:</span></span><br><span class="line">        <span class="attr">b4:52:eb:64:7a:07:15:00:c5:48:91:0b:48:9c:b2:4e:8c:ae:</span></span><br><span class="line">        <span class="attr">e6:06:97:cf:c2:18:46:7e:5c:23:8a:13:39:ec:89:ed:ba:02:</span></span><br><span class="line">        <span class="attr">c6:8c:35:92:e5:a6:82:a9:95:1a:fe:a9:41:b8:c5:9b:78:b4:</span></span><br><span class="line">        <span class="attr">49:ea:90:d8:3f:66:31:18:7c:95:a9:bf:d9:76:e2:62:b6:4f:</span></span><br><span class="line">        <span class="number">70</span><span class="string">:02:19:17</span></span><br></pre></td></tr></table></figure>
<p>其中的 Subject 中的 O 对应的 k8s 中的 Group，CN 对应的 k8s 中的 User。kube-apiserver 会通过证书的 O 和 CN 获取到 User 和 Group 信息。在 k8s 系统中，实际上并没有存储 Group 和 User 信息，而是完全依赖该证书中的信息。</p>
<h1 id="kubeconfig-文件生成"><a href="#kubeconfig-文件生成" class="headerlink" title="kubeconfig 文件生成"></a>kubeconfig 文件生成</h1><p>kubeconfig 文件本质上是个证书，包含了 ca、证书公钥和证书私钥，在有了证书后可以通过 kubectl 命令生成新的 kubeconfig 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl --kubeconfig ~/.kube/111111.kubeconfig config set-cluster hello --certificate-authority=/tmp/ca.pem --embed-certs=true --server=https://127.0.0.1:6443</span><br><span class="line">kubectl --kubeconfig ~/.kube/111111.kubeconfig config set-credentials hello-admin --client-certificate=/tmp/tls.crt --client-key=/tmp/tls.key --embed-certs=true</span><br><span class="line">kubectl --kubeconfig ~/.kube/111111.kubeconfig config set-context hello --cluster=hello --user=hello-admin</span><br><span class="line">kubectl --kubeconfig ~/.kube/111111.kubeconfig config use-context hello</span><br></pre></td></tr></table></figure>

<h1 id="使用-curl-命令直接访问-kube-apiserver"><a href="#使用-curl-命令直接访问-kube-apiserver" class="headerlink" title="使用 curl 命令直接访问 kube-apiserver"></a>使用 curl 命令直接访问 kube-apiserver</h1><p>由于 kube-apiserver 开启了双向认证，使用 curl 命令访问 kube-apiserver 时，curl 需要指定证书信息，证书信息可以使用 kubeconfig 中的证书信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">WORK_DIR=/tmp</span><br><span class="line">KUBECONFIG=~/.kube/config</span><br><span class="line">CONTEXT=kind-kind</span><br><span class="line">server=`yq eval &#x27;.clusters.[]|select(.name==&quot;&#x27;$CONTEXT&#x27;&quot;)|.cluster.server&#x27; $KUBECONFIG`</span><br><span class="line">yq eval &#x27;.users.[]|select(.name==&quot;&#x27;$CONTEXT&#x27;&quot;)|.user.client-certificate-data&#x27; $KUBECONFIG | base64 --decode &gt; $&#123;WORK_DIR&#125;/client.crt</span><br><span class="line">yq eval &#x27;.users.[]|select(.name==&quot;&#x27;$CONTEXT&#x27;&quot;)|.user.client-key-data&#x27; ~/.kube/config | base64 --decode &gt; $&#123;WORK_DIR&#125;/client.key</span><br><span class="line">yq eval &#x27;.clusters.[]|select(.name==&quot;&#x27;$CONTEXT&#x27;&quot;)|.cluster.certificate-authority-data&#x27; $KUBECONFIG | base64 --decode &gt; $&#123;WORK_DIR&#125;/ca.crt</span><br><span class="line">curl --cert $&#123;WORK_DIR&#125;/client.crt --key $&#123;WORK_DIR&#125;/client.key --cacert $&#123;WORK_DIR&#125;/ca.crt &quot;$server/apis/apiextensions.k8s.io/v1/customresourcedefinitions?limit=500&amp;resourceVersion=0&quot;</span><br></pre></td></tr></table></figure>

<h1 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/orchidzjl/p/17306985.html">kubeconfig文件全解析</a></li>
<li><a target="_blank" rel="noopener" href="https://zhangguanzhang.github.io/2018/10/27/create-kubeconfig/#/role-%E5%8F%82%E8%80%83">生成kubeconfig常规的两种方法</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder"></span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




<script class="next-config" data-name="giscus" type="application/json">{"enable":true,"repo":"kuring/kuring.github.io","repo_id":"MDEwOlJlcG9zaXRvcnkyODM4MzQ0NTk=","category":"Announcements","category_id":"DIC_kwDOEOr4W84CdeTU","mapping":"pathname","reactions_enabled":1,"emit_metadata":1,"theme":"light","lang":"zh-CN","crossorigin":"anonymous","input_position":"bottom","loading":"lazy"}</script>

<script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.page.comments) return;

  NexT.utils.loadComments('.giscus-container')
    .then(() => NexT.utils.getScript('https://giscus.app/client.js', {
      attributes: {
        async                   : true,
        crossOrigin             : 'anonymous',
        'data-repo'             : CONFIG.giscus.repo,
        'data-repo-id'          : CONFIG.giscus.repo_id,
        'data-category'         : CONFIG.giscus.category,
        'data-category-id'      : CONFIG.giscus.category_id,
        'data-mapping'          : CONFIG.giscus.mapping,
        'data-reactions-enabled': CONFIG.giscus.reactions_enabled,
        'data-emit-metadata'    : CONFIG.giscus.emit_metadata,
        'data-theme'            : CONFIG.giscus.theme,
        'data-lang'             : CONFIG.giscus.lang,
        'data-input-position'   : CONFIG.giscus.input_position,
        'data-loading'          : CONFIG.giscus.loading
      },
      parentNode: document.querySelector('.giscus-container')
    }));
});
</script>

</body>
</html>
