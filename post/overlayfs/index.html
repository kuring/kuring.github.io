<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="docker imageç»“æ„ dockerå¯ä»¥é€šè¿‡å‘½ä»¤docker image inspect ${image}æ¥æŸ¥çœ‹imageçš„è¯¦ç»†ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«äº†æ‰€ä½¿ç”¨çš„åº•å±‚æ–‡ä»¶ç³»ç»ŸåŠå„å±‚çš„ä¿¡æ¯ã€‚\n"><title>ç†è§£OverlayFS</title><link rel=canonical href=/post/overlayfs/><link rel=stylesheet href=/scss/style.min.833d6eed45de56f48306bf57268d5b8cdfc8a60e8e7bdc99810464fcd033f7c6.css><meta property='og:title' content="ç†è§£OverlayFS"><meta property='og:description' content="docker imageç»“æ„ dockerå¯ä»¥é€šè¿‡å‘½ä»¤docker image inspect ${image}æ¥æŸ¥çœ‹imageçš„è¯¦ç»†ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«äº†æ‰€ä½¿ç”¨çš„åº•å±‚æ–‡ä»¶ç³»ç»ŸåŠå„å±‚çš„ä¿¡æ¯ã€‚\n"><meta property='og:url' content='/post/overlayfs/'><meta property='og:site_name' content='404é¢‘é“'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='overlay overlay2'><meta property='article:published_time' content='2018-07-28T21:30:25+00:00'><meta property='article:modified_time' content='2018-07-28T21:30:25+00:00'><meta name=twitter:title content="ç†è§£OverlayFS"><meta name=twitter:description content="docker imageç»“æ„ dockerå¯ä»¥é€šè¿‡å‘½ä»¤docker image inspect ${image}æ¥æŸ¥çœ‹imageçš„è¯¦ç»†ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«äº†æ‰€ä½¿ç”¨çš„åº•å±‚æ–‡ä»¶ç³»ç»ŸåŠå„å±‚çš„ä¿¡æ¯ã€‚\n"><link rel="shortcut icon" href=/images/avatar.jpeg></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_16fb6c03614f4da2.jpeg width=300 height=280 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ“¡</span></figure><div class=site-meta><h1 class=site-name><a href=/>404é¢‘é“</a></h1><h2 class=site-description>å­¦ä¹ ç¬”è®°</h2></div></header><ol class=menu-social><li><a href=https://github.com/kuring target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>å…³äºæˆ‘</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>å½’æ¡£</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>æœç´¢</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#docker-imageç»“æ„>docker imageç»“æ„</a></li><li><a href=#overlay>overlay</a></li><li><a href=#overlay2>overlay2</a></li><li><a href=#ref>ref</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/post/overlayfs/>ç†è§£OverlayFS</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2018-07-28T21:30:25Z>2018-07-28</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 4 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h2 id=docker-imageç»“æ„>docker imageç»“æ„</h2><p>dockerå¯ä»¥é€šè¿‡å‘½ä»¤<code>docker image inspect ${image}</code>æ¥æŸ¥çœ‹imageçš„è¯¦ç»†ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«äº†æ‰€ä½¿ç”¨çš„åº•å±‚æ–‡ä»¶ç³»ç»ŸåŠå„å±‚çš„ä¿¡æ¯ã€‚</p><p>docker containerçš„å­˜å‚¨ç»“æ„åˆ†ä¸ºäº†åªè¯»å±‚ã€initå±‚å’Œå¯è¯»å†™å±‚ã€‚</p><p>åªè¯»å±‚è·Ÿdocker imageçš„å±‚æ¬¡ç»“æ„æ°å¥½å¯¹åº”ï¼Œä¸»è¦åŒ…å«æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ã€é…ç½®ã€ç›®å½•ç­‰ä¿¡æ¯ï¼Œä¸åŒ…å«æ“ä½œç³»ç»Ÿé•œåƒã€‚</p><p>initå±‚åœ¨åªè¯»å±‚å’Œè¯»å†™å±‚ä¸­é—´ï¼Œç”¨æ¥ä¸“é—¨å­˜æ”¾/etc/hosts /etc/resolv.confç­‰ä¿¡æ¯ï¼Œè¿™äº›æ–‡ä»¶å¾€å¾€éœ€è¦åœ¨å¯åŠ¨çš„æ—¶å€™å†™å…¥ä¸€äº›æŒ‡å®šå€¼ï¼Œä½†ä¸æœŸæœ›<code>docker commit</code>å‘½ä»¤å¯¹å…¶è¿›è¡Œæäº¤ã€‚</p><p>å¯è¯»å†™å±‚ä¸ºå®¹å™¨åœ¨è¿è¡Œä¸­å¯ä»¥è¿›è¡Œå†™å…¥çš„å±‚ã€‚</p><h2 id=overlay>overlay</h2><p><img src=https://arkingc.github.io/img/in-post/post-docker-filesystem/overlay_constructs.jpg loading=lazy alt=image></p><p>é‡‡ç”¨äº†ä¸¤å±‚ç»“æ„ï¼Œlowerdirä¸ºé•œåƒå±‚ï¼Œåªè¯»ã€‚upperdirä¸ºå®¹å™¨å±‚ã€‚</p><p>æ¯å±‚éƒ½ä¼šåœ¨/var/run/docker/overlayåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸­ä¸ºå®é™…å±‚çš„å†…å®¹ï¼Œæ–‡ä»¶é‡‡ç”¨ç¡¬é“¾æ¥çš„æ–¹å¼é“¾æ¥åˆ°çœŸå®å±‚ä¸­çš„æ–‡ä»¶ï¼Œæ¯ä¸€å±‚éƒ½åŒ…å«è¯¥å±‚è¯¥æ‹¥æœ‰çš„æ‰€æœ‰æ–‡ä»¶ï¼Œè€Œè¯¥æ–‡ä»¶çš„çœŸå®å­˜å‚¨å¯èƒ½æ˜¯é‡‡ç”¨ç¡¬é“¾æ¥çš„æ–¹å¼é“¾æ¥åˆ°ä¸Šå±‚ä¸­çš„çœŸå®æ–‡ä»¶ï¼Œå› æ­¤æ¯”è¾ƒè€—è´¹inodeã€‚</p><p>åˆ›å»ºä¸€ä¸ªå®¹å™¨æ—¶ï¼Œä¼šæ–°å¢ä¸¤ä¸ªç›®å½•ï¼Œä¸€ä¸ªä¸ºè¯»å†™å±‚ï¼Œä¸€ä¸ªä¸ºåˆå§‹å±‚ã€‚åˆå§‹å±‚ä¸­ä¿å­˜äº†å®¹å™¨åˆå§‹åŒ–æ—¶çš„ç¯å¢ƒä¿¡æ¯ï¼Œå¦‚hostnameã€hostsæ–‡ä»¶ç­‰ã€‚è¯»å†™å±‚ç”¨äºè®°å½•å®¹å™¨çš„æ‰€æœ‰æ”¹åŠ¨ã€‚</p><h2 id=overlay2>overlay2</h2><p>ä¸ºäº†è§„é¿overlayæ¶ˆè€—inodeèŠ‚ç‚¹è¿‡å¤šçš„é—®é¢˜ï¼Œoverlay2é‡‡ç”¨åœ¨æ¯å±‚ä¸­å¢åŠ loweræ–‡ä»¶çš„æ–¹å¼æ¥è®°å½•æ‰€æœ‰åº•å±‚çš„ä¿¡æ¯ï¼Œç±»ä¼¼äºé“¾è¡¨çš„å½¢å¼ã€‚</p><p><code>docker pull ubuntu</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=err>@</span><span class=n>localhost</span> <span class=n>runc</span><span class=p>]</span><span class=c1># docker pull ubuntu</span>
</span></span><span class=line><span class=cl><span class=n>Using</span> <span class=n>default</span> <span class=n>tag</span><span class=p>:</span> <span class=n>latest</span>
</span></span><span class=line><span class=cl><span class=n>latest</span><span class=p>:</span> <span class=n>Pulling</span> <span class=n>from</span> <span class=n>library</span><span class=o>/</span><span class=n>ubuntu</span>
</span></span><span class=line><span class=cl><span class=n>c64513b74145</span><span class=p>:</span> <span class=n>Pull</span> <span class=n>complete</span>
</span></span><span class=line><span class=cl><span class=mi>01</span><span class=n>b8b12bad90</span><span class=p>:</span> <span class=n>Pull</span> <span class=n>complete</span>
</span></span><span class=line><span class=cl><span class=n>c5d85cf7a05f</span><span class=p>:</span> <span class=n>Pull</span> <span class=n>complete</span>
</span></span><span class=line><span class=cl><span class=n>b6b268720157</span><span class=p>:</span> <span class=n>Pull</span> <span class=n>complete</span>
</span></span><span class=line><span class=cl><span class=n>e12192999ff1</span><span class=p>:</span> <span class=n>Pull</span> <span class=n>complete</span>
</span></span><span class=line><span class=cl><span class=n>Digest</span><span class=p>:</span> <span class=n>sha256</span><span class=p>:</span><span class=mi>3</span><span class=n>f119dc0737f57f704ebecac8a6d8477b0f6ca1ca0332c7ee1395ed2c6a82be7</span>
</span></span><span class=line><span class=cl><span class=n>Status</span><span class=p>:</span> <span class=n>Downloaded</span> <span class=n>newer</span> <span class=n>image</span> <span class=k>for</span> <span class=n>ubuntu</span><span class=p>:</span><span class=n>latest</span>
</span></span></code></pre></td></tr></table></div></div><p>ä¼šåœ¨/var/run/docker/overlay2ç›®å½•ä¸‹åˆ›å»ºå¦‚ä¸‹æ–‡ä»¶ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@localhost overlay2]# tree -L 2
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>|-- 664ae13f1c21402385076025d68476eb8d1cc4be6c6a218b24bd55217ac62672    // ç¬¬0å±‚
</span></span><span class=line><span class=cl>|   |-- diff
</span></span><span class=line><span class=cl>|   `-- link    // MZUEUOFHBNVTRCJYJEG7QY4VWT
</span></span><span class=line><span class=cl>|-- 783ad02709b67ac47b55198e9659c4592f0972334987ab97f42fd10f1784cbba    // ç¬¬2å±‚
</span></span><span class=line><span class=cl>|   |-- diff
</span></span><span class=line><span class=cl>|   |-- link    // HXATFASQ4E2JBG434DUEN54EZZ
</span></span><span class=line><span class=cl>|   |-- lower   // l/WUZC5WSTQTPJUJ4KFAYCUT5IPD:l/MZUEUOFHBNVTRCJYJEG7QY4VWT
</span></span><span class=line><span class=cl>|   |-- merged
</span></span><span class=line><span class=cl>|   `-- work
</span></span><span class=line><span class=cl>|-- 89f7a20dda3d868840e20d9e8f1bfe20c5cca51c27b07825f100da0f474672f6    // ç¬¬3å±‚
</span></span><span class=line><span class=cl>|   |-- diff
</span></span><span class=line><span class=cl>|   |-- link    // 5PHT7S3MCZTTQOXVPA4CKJRRFD
</span></span><span class=line><span class=cl>|   |-- lower   // l/HXATFASQ4E2JBG434DUEN54EZZ:l/WUZC5WSTQTPJUJ4KFAYCUT5IPD:l/MZUEUOFHBNVTRCJYJEG7QY4VWT
</span></span><span class=line><span class=cl>|   |-- merged
</span></span><span class=line><span class=cl>|   `-- work
</span></span><span class=line><span class=cl>|-- backingFsBlockDev
</span></span><span class=line><span class=cl>|-- bad073a2d1f79a03af6caa0b3f51a22e6762cebbc0c30e45458fe6c1ff266f68    // ç¬¬4å±‚
</span></span><span class=line><span class=cl>|   |-- diff
</span></span><span class=line><span class=cl>|   |-- link    // QMKHIPSDT4JTPE4FLT7QGJ33ND
</span></span><span class=line><span class=cl>|   |-- lower   // l/5PHT7S3MCZTTQOXVPA4CKJRRFD:l/HXATFASQ4E2JBG434DUEN54EZZ:l/WUZC5WSTQTPJUJ4KFAYCUT5IPD:l/MZUEUOFHBNVTRCJYJEG7QY4VWT
</span></span><span class=line><span class=cl>|   |-- merged
</span></span><span class=line><span class=cl>|   `-- work
</span></span><span class=line><span class=cl>|-- cb40b5b47c699050305676b35b1cea1ce08b38604dd68243c4be48934125b1a3    // ç¬¬1å±‚
</span></span><span class=line><span class=cl>|   |-- diff
</span></span><span class=line><span class=cl>|   |-- link    // WUZC5WSTQTPJUJ4KFAYCUT5IPD
</span></span><span class=line><span class=cl>|   |-- lower   // l/MZUEUOFHBNVTRCJYJEG7QY4VWT
</span></span><span class=line><span class=cl>|   |-- merged
</span></span><span class=line><span class=cl>|   `-- work
</span></span><span class=line><span class=cl>`-- l
</span></span><span class=line><span class=cl>    |-- 5PHT7S3MCZTTQOXVPA4CKJRRFD -&gt; ../89f7a20dda3d868840e20d9e8f1bfe20c5cca51c27b07825f100da0f474672f6/diff
</span></span><span class=line><span class=cl>    |-- HXATFASQ4E2JBG434DUEN54EZZ -&gt; ../783ad02709b67ac47b55198e9659c4592f0972334987ab97f42fd10f1784cbba/diff
</span></span><span class=line><span class=cl>    |-- MZUEUOFHBNVTRCJYJEG7QY4VWT -&gt; ../664ae13f1c21402385076025d68476eb8d1cc4be6c6a218b24bd55217ac62672/diff
</span></span><span class=line><span class=cl>    |-- QMKHIPSDT4JTPE4FLT7QGJ33ND -&gt; ../bad073a2d1f79a03af6caa0b3f51a22e6762cebbc0c30e45458fe6c1ff266f68/diff
</span></span><span class=line><span class=cl>    `-- WUZC5WSTQTPJUJ4KFAYCUT5IPD -&gt; ../cb40b5b47c699050305676b35b1cea1ce08b38604dd68243c4be48934125b1a3/diff
</span></span></code></pre></td></tr></table></div></div><p>lç›®å½•ä¸‹ä¸ºè¶…é“¾æ¥ï¼Œç¼©çŸ­åçš„ç›®å½•ï¼Œä¸ºäº†é¿å…mountæ—¶è¶…å‡ºé¡µå¤§å°é™åˆ¶ã€‚</p><p>æ¯ä¸€å±‚ä¸­çš„diffæ–‡ä»¶å¤¹åŒ…å«å®é™…å†…å®¹ã€‚</p><p>æ¯ä¸€å±‚ä¸­éƒ½æœ‰ä¸€ä¸ªlinkæ–‡ä»¶ï¼Œå†…å®¹ä¸ºlç›®å½•ä¸­çš„è¶…é“¾æ¥ï¼Œè¶…é“¾æ¥å®é™…æŒ‡å‘å½“å‰å±‚ç›®å½•ä¸­çš„diffæ–‡ä»¶å¤¹ã€‚</p><p>é™¤å»æœ€åº•å±‚çš„ç›®å½•å¤–ï¼Œå…¶ä½™æ¯ä¸€å±‚ä¸­åŒ…å«ä¸€ä¸ªloweræ–‡ä»¶ï¼ŒåŒ…å«äº†è¯¥å±‚çš„æ‰€æœ‰æ›´åº•å±‚åç§°å’Œé¡ºåºï¼Œå¯ä»¥æ ¹æ®è¯¥æ–‡ä»¶æ„å»ºå‡ºæ•´ä¸ªé•œåƒçš„å±‚æ¬¡ç»“æ„ã€‚</p><p>workç›®å½•ç”¨äºOverlayFSå†…éƒ¨ä½¿ç”¨ã€‚</p><p>æœ€åº•å±‚åªæœ‰linkæ–‡ä»¶ï¼Œæ— loweræ–‡ä»¶ï¼Œå› æ­¤664ae13f1c21402385076025d68476eb8d1cc4be6c6a218b24bd55217ac62672ä¸ºæœ€åº•å±‚ã€‚</p><p>ä»¥ä¸Šäº”å±‚ä¸ºlowerï¼Œåªè¯»ã€‚</p><p>å½“ä½¿ç”¨<code>docker run -it ubuntu:latest /bin/bash</code>å¯åŠ¨ä¸€ä¸ªå®¹å™¨åï¼Œåœ¨overlay2ç›®å½•ä¸‹ä¼šå¤šå‡ºä¸¤ä¸ªæ–‡ä»¶å¤¹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@localhost overlay2]# tree -L 1 0326c1da0af912a6ea5efda77b65b04e796993e0f111ed8f262c55b2716f1c08-init 0326c1da0af912a6ea5efda77b65b04e796993e0f111ed8f262c55b2716f1c08 l
</span></span><span class=line><span class=cl>0326c1da0af912a6ea5efda77b65b04e796993e0f111ed8f262c55b2716f1c08-init
</span></span><span class=line><span class=cl>|-- diff
</span></span><span class=line><span class=cl>|-- link    // ZJVMGTB2IOJ6QF57TYM5O7EWXW
</span></span><span class=line><span class=cl>|-- lower   // l/QMKHIPSDT4JTPE4FLT7QGJ33ND:l/5PHT7S3MCZTTQOXVPA4CKJRRFD:l/HXATFASQ4E2JBG434DUEN54EZZ:l/WUZC5WSTQTPJUJ4KFAYCUT5IPD:l/MZUEUOFHBNVTRCJYJEG7QY4VWT
</span></span><span class=line><span class=cl>|-- merged
</span></span><span class=line><span class=cl>`-- work
</span></span><span class=line><span class=cl>0326c1da0af912a6ea5efda77b65b04e796993e0f111ed8f262c55b2716f1c08
</span></span><span class=line><span class=cl>|-- diff
</span></span><span class=line><span class=cl>|-- link
</span></span><span class=line><span class=cl>|-- lower   // l/ZJVMGTB2IOJ6QF57TYM5O7EWXW:l/QMKHIPSDT4JTPE4FLT7QGJ33ND:l/5PHT7S3MCZTTQOXVPA4CKJRRFD:l/HXATFASQ4E2JBG434DUEN54EZZ:l/WUZC5WSTQTPJUJ4KFAYCUT5IPD:l/MZUEUOFHBNVTRCJYJEG7QY4VWT
</span></span><span class=line><span class=cl>|-- merged
</span></span><span class=line><span class=cl>`-- work
</span></span><span class=line><span class=cl>l
</span></span><span class=line><span class=cl>|-- 5PHT7S3MCZTTQOXVPA4CKJRRFD -&gt; ../89f7a20dda3d868840e20d9e8f1bfe20c5cca51c27b07825f100da0f474672f6/diff
</span></span><span class=line><span class=cl>|-- AOLYGFOHIAHWU5CBAJFULNAXI7 -&gt; ../0326c1da0af912a6ea5efda77b65b04e796993e0f111ed8f262c55b2716f1c08/diff
</span></span><span class=line><span class=cl>|-- HXATFASQ4E2JBG434DUEN54EZZ -&gt; ../783ad02709b67ac47b55198e9659c4592f0972334987ab97f42fd10f1784cbba/diff
</span></span><span class=line><span class=cl>|-- MZUEUOFHBNVTRCJYJEG7QY4VWT -&gt; ../664ae13f1c21402385076025d68476eb8d1cc4be6c6a218b24bd55217ac62672/diff
</span></span><span class=line><span class=cl>|-- QMKHIPSDT4JTPE4FLT7QGJ33ND -&gt; ../bad073a2d1f79a03af6caa0b3f51a22e6762cebbc0c30e45458fe6c1ff266f68/diff
</span></span><span class=line><span class=cl>|-- WUZC5WSTQTPJUJ4KFAYCUT5IPD -&gt; ../cb40b5b47c699050305676b35b1cea1ce08b38604dd68243c4be48934125b1a3/diff
</span></span><span class=line><span class=cl>`-- ZJVMGTB2IOJ6QF57TYM5O7EWXW -&gt; ../0326c1da0af912a6ea5efda77b65b04e796993e0f111ed8f262c55b2716f1c08-init/diff
</span></span></code></pre></td></tr></table></div></div><p><code>0326c1da0af912a6ea5efda77b65b04e796993e0f111ed8f262c55b2716f1c08-init</code>ç”¨äºå­˜æ”¾å®¹å™¨åˆå§‹åŒ–æ—¶çš„ä¿¡æ¯ï¼Œé€šè¿‡ä¸‹é¢æŸ¥çœ‹æ›´ç›´è§‚ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@localhost overlay2]# tree 0326c1da0af912a6ea5efda77b65b04e796993e0f111ed8f262c55b2716f1c08-init
</span></span><span class=line><span class=cl>0326c1da0af912a6ea5efda77b65b04e796993e0f111ed8f262c55b2716f1c08-init
</span></span><span class=line><span class=cl>|-- diff
</span></span><span class=line><span class=cl>|   |-- dev
</span></span><span class=line><span class=cl>|   |   `-- console
</span></span><span class=line><span class=cl>|   `-- etc
</span></span><span class=line><span class=cl>|       |-- hostname
</span></span><span class=line><span class=cl>|       |-- hosts
</span></span><span class=line><span class=cl>|       |-- mtab -&gt; /proc/mounts
</span></span><span class=line><span class=cl>|       `-- resolv.conf
</span></span><span class=line><span class=cl>|-- link
</span></span><span class=line><span class=cl>|-- lower
</span></span><span class=line><span class=cl>|-- merged
</span></span><span class=line><span class=cl>`-- work
</span></span><span class=line><span class=cl>    `-- work
</span></span></code></pre></td></tr></table></div></div><p><code>0326c1da0af912a6ea5efda77b65b04e796993e0f111ed8f262c55b2716f1c08</code>çš„ç›´æ¥åº•å±‚ä¸ºinitå±‚ï¼Œæ›´è¯¦ç»†çš„ç›®å½•ç»“æ„å¦‚ä¸‹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=err>@</span><span class=n>localhost</span> <span class=n>overlay2</span><span class=p>]</span><span class=c1># tree -L 2  0326c1da0af912a6ea5efda77b65b04e796993e0f111ed8f262c55b2716f1c08</span>
</span></span><span class=line><span class=cl><span class=mi>0326</span><span class=n>c1da0af912a6ea5efda77b65b04e796993e0f111ed8f262c55b2716f1c08</span>
</span></span><span class=line><span class=cl><span class=o>|--</span> <span class=n>diff</span>
</span></span><span class=line><span class=cl><span class=o>|--</span> <span class=n>link</span>
</span></span><span class=line><span class=cl><span class=o>|--</span> <span class=n>lower</span>
</span></span><span class=line><span class=cl><span class=o>|--</span> <span class=n>merged</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>bin</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>boot</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>dev</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>etc</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>home</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>lib</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>lib64</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>media</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>mnt</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>opt</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>proc</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>root</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>run</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>sbin</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>srv</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>sys</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>tmp</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=o>|--</span> <span class=n>usr</span>
</span></span><span class=line><span class=cl><span class=o>|</span>   <span class=err>`</span><span class=o>--</span> <span class=k>var</span>
</span></span><span class=line><span class=cl><span class=err>`</span><span class=o>--</span> <span class=n>work</span>
</span></span><span class=line><span class=cl>    <span class=err>`</span><span class=o>--</span> <span class=n>work</span>
</span></span></code></pre></td></tr></table></div></div><p>mergedæ–‡ä»¶å¤¹ä¸­å†…å®¹è¾ƒå¤šï¼Œä¸ºoverlay2çš„ç›´æ¥æŒ‚è½½ç‚¹ï¼Œå¯¹å®¹å™¨çš„ä¿®æ”¹ä¼šååº”åˆ°è¯¥ç›®å½•ä¸­ã€‚ä¾‹å¦‚åœ¨å®¹å™¨ä¸­å¢åŠ /root/hello.txtæ–‡ä»¶ï¼Œåœ¨mergedç›®å½•ä¸‹ä¼šå¢åŠ root/hello.txtæ–‡ä»¶ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=err>@</span><span class=n>localhost</span> <span class=n>overlay2</span><span class=p>]</span><span class=c1># mount  | grep overlay2</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>dev</span><span class=o>/</span><span class=n>mapper</span><span class=o>/</span><span class=n>centos</span><span class=o>-</span><span class=n>root</span> <span class=n>on</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>overlay2</span> <span class=n>type</span> <span class=n>xfs</span> <span class=p>(</span><span class=n>rw</span><span class=p>,</span><span class=n>relatime</span><span class=p>,</span><span class=n>attr2</span><span class=p>,</span><span class=n>inode64</span><span class=p>,</span><span class=n>noquota</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>overlay</span> <span class=n>on</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>overlay2</span><span class=o>/</span><span class=mi>0326</span><span class=n>c1da0af912a6ea5efda77b65b04e796993e0f111ed8f262c55b2716f1c08</span><span class=o>/</span><span class=n>merged</span> <span class=n>type</span> <span class=n>overlay</span> <span class=p>(</span><span class=n>rw</span><span class=p>,</span><span class=n>relatime</span><span class=p>,</span><span class=n>lowerdir</span><span class=o>=/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>overlay2</span><span class=o>/</span><span class=n>l</span><span class=o>/</span><span class=n>ZJVMGTB2IOJ6QF57TYM5O7EWXW</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>overlay2</span><span class=o>/</span><span class=n>l</span><span class=o>/</span><span class=n>QMKHIPSDT4JTPE4FLT7QGJ33ND</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>overlay2</span><span class=o>/</span><span class=n>l</span><span class=o>/</span><span class=mi>5</span><span class=n>PHT7S3MCZTTQOXVPA4CKJRRFD</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>overlay2</span><span class=o>/</span><span class=n>l</span><span class=o>/</span><span class=n>HXATFASQ4E2JBG434DUEN54EZZ</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>overlay2</span><span class=o>/</span><span class=n>l</span><span class=o>/</span><span class=n>WUZC5WSTQTPJUJ4KFAYCUT5IPD</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>overlay2</span><span class=o>/</span><span class=n>l</span><span class=o>/</span><span class=n>MZUEUOFHBNVTRCJYJEG7QY4VWT</span><span class=p>,</span><span class=n>upperdir</span><span class=o>=/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>overlay2</span><span class=o>/</span><span class=mi>0326</span><span class=n>c1da0af912a6ea5efda77b65b04e796993e0f111ed8f262c55b2716f1c08</span><span class=o>/</span><span class=n>diff</span><span class=p>,</span><span class=n>workdir</span><span class=o>=/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>overlay2</span><span class=o>/</span><span class=mi>0326</span><span class=n>c1da0af912a6ea5efda77b65b04e796993e0f111ed8f262c55b2716f1c08</span><span class=o>/</span><span class=n>work</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=ref>ref</h2><ul><li><a class=link href=https://docs.docker.com/storage/storagedriver/overlayfs-driver/ target=_blank rel=noopener>Use the OverlayFS storage driver</a></li><li><a class=link href=https://arkingc.github.io/2017/05/05/docker-filesystem-overlay/ target=_blank rel=noopener>Dockerå­˜å‚¨é©±åŠ¨â€”Overlay/Overlay2ã€Œè¯‘ã€</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/overlay-overlay2/>Overlay Overlay2</a></section></footer></article><script src=https://giscus.app/client.js data-repo=kuring/kuring.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkyODM4MzQ0NTk=" data-category=Announcements data-category-id=DIC_kwDOEOr4W84CdeTU data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=light data-lang=zh-CN data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark")}})()</script><footer class=site-footer><section class=copyright>&copy;
2013 -
2025 kuring</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.33.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>