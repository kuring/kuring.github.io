<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œk8s å¯¹äº pod åœ¨å•ä¸ªèŠ‚ç‚¹çš„èµ„æºåˆ†é…å¹¶ä¸ä¼šè€ƒè™‘åˆ° NUMA æ¶æ„ã€‚æ¯”å¦‚ cpu é»˜è®¤ä¼šé‡‡ç”¨ cgroup CFS æ¥åšèµ„æºçš„åˆ†é…ï¼Œå¹¶æœªè€ƒè™‘åˆ° NUMA æ¶æ„ã€‚ä¸ºäº†æå‡ pod çš„æ€§èƒ½ï¼Œéœ€è¦ pod åœ¨åˆ†é…èµ„æºæ—¶æ„ŸçŸ¥ NUMA æ¶æ„ã€‚\nä¸ºæ­¤ï¼Œk8s åœ¨ kubelet ä¸­é€šè¿‡ CPU Managerã€Memory Managerã€Device Managerã€Topology Manager ç­‰ç‰¹æ€§å¯¹ NUMA åšäº†æ”¯æŒï¼Œæ”¯æŒçš„ pod QoS ç±»å‹è¦æ±‚ä¸º Granteed podã€‚\nå„ç‰¹æ€§çš„æ”¯æŒç‰ˆæœ¬æƒ…å†µå¦‚ä¸‹ï¼š\n"><title>k8s ä¸­çš„ numa äº²å’Œæ€§</title><link rel=canonical href=/post/k8s-%E4%B8%AD%E7%9A%84-numa-%E4%BA%B2%E5%92%8C%E6%80%A7/><link rel=stylesheet href=/scss/style.min.833d6eed45de56f48306bf57268d5b8cdfc8a60e8e7bdc99810464fcd033f7c6.css><meta property='og:title' content="k8s ä¸­çš„ numa äº²å’Œæ€§"><meta property='og:description' content="é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œk8s å¯¹äº pod åœ¨å•ä¸ªèŠ‚ç‚¹çš„èµ„æºåˆ†é…å¹¶ä¸ä¼šè€ƒè™‘åˆ° NUMA æ¶æ„ã€‚æ¯”å¦‚ cpu é»˜è®¤ä¼šé‡‡ç”¨ cgroup CFS æ¥åšèµ„æºçš„åˆ†é…ï¼Œå¹¶æœªè€ƒè™‘åˆ° NUMA æ¶æ„ã€‚ä¸ºäº†æå‡ pod çš„æ€§èƒ½ï¼Œéœ€è¦ pod åœ¨åˆ†é…èµ„æºæ—¶æ„ŸçŸ¥ NUMA æ¶æ„ã€‚\nä¸ºæ­¤ï¼Œk8s åœ¨ kubelet ä¸­é€šè¿‡ CPU Managerã€Memory Managerã€Device Managerã€Topology Manager ç­‰ç‰¹æ€§å¯¹ NUMA åšäº†æ”¯æŒï¼Œæ”¯æŒçš„ pod QoS ç±»å‹è¦æ±‚ä¸º Granteed podã€‚\nå„ç‰¹æ€§çš„æ”¯æŒç‰ˆæœ¬æƒ…å†µå¦‚ä¸‹ï¼š\n"><meta property='og:url' content='/post/k8s-%E4%B8%AD%E7%9A%84-numa-%E4%BA%B2%E5%92%8C%E6%80%A7/'><meta property='og:site_name' content='404é¢‘é“'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2024-03-22T20:08:26+00:00'><meta property='article:modified_time' content='2024-03-22T20:08:26+00:00'><meta name=twitter:title content="k8s ä¸­çš„ numa äº²å’Œæ€§"><meta name=twitter:description content="é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œk8s å¯¹äº pod åœ¨å•ä¸ªèŠ‚ç‚¹çš„èµ„æºåˆ†é…å¹¶ä¸ä¼šè€ƒè™‘åˆ° NUMA æ¶æ„ã€‚æ¯”å¦‚ cpu é»˜è®¤ä¼šé‡‡ç”¨ cgroup CFS æ¥åšèµ„æºçš„åˆ†é…ï¼Œå¹¶æœªè€ƒè™‘åˆ° NUMA æ¶æ„ã€‚ä¸ºäº†æå‡ pod çš„æ€§èƒ½ï¼Œéœ€è¦ pod åœ¨åˆ†é…èµ„æºæ—¶æ„ŸçŸ¥ NUMA æ¶æ„ã€‚\nä¸ºæ­¤ï¼Œk8s åœ¨ kubelet ä¸­é€šè¿‡ CPU Managerã€Memory Managerã€Device Managerã€Topology Manager ç­‰ç‰¹æ€§å¯¹ NUMA åšäº†æ”¯æŒï¼Œæ”¯æŒçš„ pod QoS ç±»å‹è¦æ±‚ä¸º Granteed podã€‚\nå„ç‰¹æ€§çš„æ”¯æŒç‰ˆæœ¬æƒ…å†µå¦‚ä¸‹ï¼š\n"><link rel="shortcut icon" href=/images/avatar.jpeg></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_16fb6c03614f4da2.jpeg width=300 height=280 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ“¡</span></figure><div class=site-meta><h1 class=site-name><a href=/>404é¢‘é“</a></h1><h2 class=site-description>å­¦ä¹ ç¬”è®°</h2></div></header><ol class=menu-social><li><a href=https://github.com/kuring target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>å…³äºæˆ‘</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>å½’æ¡£</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>æœç´¢</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#kubelet-çš„å‚æ•°é…ç½®>kubelet çš„å‚æ•°é…ç½®</a></li><li><a href=#æ¨¡å¼ä¹‹é—´åˆ‡æ¢>æ¨¡å¼ä¹‹é—´åˆ‡æ¢</a></li><li><a href=#ç»‘æ ¸å®è·µ>ç»‘æ ¸å®è·µ</a></li><li><a href=#kubelet-å†…éƒ¨å®ç°>kubelet å†…éƒ¨å®ç°</a></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li></ol><ol><li><a href=#kubelet-ä¸­å‚æ•°é…ç½®>kubelet ä¸­å‚æ•°é…ç½®</a></li></ol><ol><li><a href=#kubelet-çš„å‚æ•°é…ç½®-1>kubelet çš„å‚æ•°é…ç½®</a></li><li><a href=#kubelet-ä¸­çš„å®ç°>kubelet ä¸­çš„å®ç°</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/post/k8s-%E4%B8%AD%E7%9A%84-numa-%E4%BA%B2%E5%92%8C%E6%80%A7/>k8s ä¸­çš„ numa äº²å’Œæ€§</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2024-03-22T20:08:26Z>2024-03-22</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 7 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><p>é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œk8s å¯¹äº pod åœ¨å•ä¸ªèŠ‚ç‚¹çš„èµ„æºåˆ†é…å¹¶ä¸ä¼šè€ƒè™‘åˆ° NUMA æ¶æ„ã€‚æ¯”å¦‚ cpu é»˜è®¤ä¼šé‡‡ç”¨ cgroup CFS æ¥åšèµ„æºçš„åˆ†é…ï¼Œå¹¶æœªè€ƒè™‘åˆ° NUMA æ¶æ„ã€‚ä¸ºäº†æå‡ pod çš„æ€§èƒ½ï¼Œéœ€è¦ pod åœ¨åˆ†é…èµ„æºæ—¶æ„ŸçŸ¥ NUMA æ¶æ„ã€‚<br>ä¸ºæ­¤ï¼Œk8s åœ¨ kubelet ä¸­é€šè¿‡ CPU Managerã€Memory Managerã€Device Managerã€Topology Manager ç­‰ç‰¹æ€§å¯¹ NUMA åšäº†æ”¯æŒï¼Œæ”¯æŒçš„ pod QoS ç±»å‹è¦æ±‚ä¸º Granteed podã€‚<br>å„ç‰¹æ€§çš„æ”¯æŒç‰ˆæœ¬æƒ…å†µå¦‚ä¸‹ï¼š</p><div class=table-wrapper><table><thead><tr><th>ç‰¹æ€§</th><th>alpha</th><th>beta</th><th>stable</th></tr></thead><tbody><tr><td>CPU Manager</td><td></td><td>1.12</td><td>1.26</td></tr><tr><td>Memory Manager</td><td>1.21</td><td>1.22</td><td>-</td></tr><tr><td>Topology Manager</td><td>1.16</td><td>1.18</td><td>-</td></tr></tbody></table></div><h1 id=cpu-manager>CPU Manager</h1><p>åœ¨ k8s ä¸­ä½¿ç”¨ cgroup çš„ CFS é…é¢æ¥æ‰§è¡Œ pod çš„ CPU çº¦æŸï¼Œåœ¨ CFS çš„æ¨¡å¼ä¸‹ï¼Œpod å¯èƒ½ä¼šè¿è¡Œåœ¨ä¸åŒçš„æ ¸ä¸Šï¼Œä¼šå¯¼è‡´ pod çš„ç¼“å­˜å¤±æ•ˆçš„é—®é¢˜ã€‚å¯¹äºæ€§èƒ½è¦æ±‚éå¸¸é«˜çš„ podï¼Œä¸ºäº†æå‡æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡ cgroup ä¸­çš„ cpuset ç»‘æ ¸çš„ç‰¹æ€§æ¥æå‡ pod çš„æ€§èƒ½ã€‚</p><p>åœ¨ k8s ä¸­ä»…é’ˆå¯¹å¦‚ä¸‹çš„ pod ç±»å‹åšäº†ç»‘æ ¸æ“ä½œï¼š</p><ol><li>å¿…é¡»ä¸º guaranteed pod ç±»å‹ã€‚å³ pod éœ€è¦æ»¡è¶³å¦‚ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š<ol><li>pod ä¸­çš„æ¯ä¸ªå®¹å™¨éƒ½å¿…é¡»æŒ‡å®šcpu å’Œ å†…å­˜çš„ request å’Œ limitã€‚</li><li>pod ä¸­çš„æ¯ä¸ªå®¹å™¨çš„ cpu å’Œå†…å­˜çš„ request å’Œ limit å¿…é¡»ç›¸ç­‰ã€‚</li></ol></li><li>pod çš„ cpu request å’Œ limit å¿…é¡»ä¸ºæ•´æ•°ã€‚</li></ol><h2 id=kubelet-çš„å‚æ•°é…ç½®>kubelet çš„å‚æ•°é…ç½®</h2><p>åœ¨ k8s ä¸­ä»…é€šè¿‡ kubelet æ¥æ”¯æŒ pod çš„ç»‘æ ¸æ“ä½œï¼Œè·Ÿå…¶ä»–ç»„ä»¶æ— å…³ã€‚<br>kubelet é€šè¿‡å‚æ•° <code>--cpu-manager-policy</code> æˆ–è€…åœ¨ kubelet çš„é…ç½®æ–‡ä»¶ä¸­å‚æ•°<code>cpuManagerPolicy</code> æ¥é…ç½®ï¼Œæ”¯æŒå¦‚ä¸‹å€¼ï¼š</p><ol><li>noneï¼šé»˜è®¤ç­–ç•¥ã€‚å³ä¸æ‰§è¡Œç»‘æ ¸æ“ä½œã€‚</li><li>staticï¼šå…è®¸ä¸ºèŠ‚ç‚¹ä¸Šçš„æŸäº›ç‰¹å¾çš„ pod èµ‹äºˆå¢å¼ºçš„ cpu äº²å’Œæ€§å’Œç‹¬å æ€§ã€‚</li></ol><p>kubelet é€šè¿‡å‚æ•° <code>--cpu-manager-reconcile-period</code> æ¥æŒ‡å®šå†…å­˜ä¸­çš„ cpu åˆ†é…è·Ÿ cgroupfs ä¸€è‡´ã€‚<br>kubelet é€šè¿‡å‚æ•° <code>--cpu-manager-policy-options</code>æ¥å¾®è°ƒã€‚è¯¥ç‰¹æ€§é€šè¿‡ç‰¹æ€§é—¨æ§ CPUManagerPolicyOptions æ¥æ§åˆ¶ã€‚</p><h2 id=æ¨¡å¼ä¹‹é—´åˆ‡æ¢>æ¨¡å¼ä¹‹é—´åˆ‡æ¢</h2><p>é»˜è®¤çš„ kubelet <code>cpuManagerPolicy</code> é…ç½®ä¸º noneï¼Œç­–ç•¥é…ç½®ä½äºæ–‡ä»¶ <code>/var/lib/kubelet/cpu_manager_state</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;policyName&#34;</span><span class=p>:</span><span class=s2>&#34;none&#34;</span><span class=p>,</span><span class=nt>&#34;defaultCpuSet&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;checksum&#34;</span><span class=p>:</span><span class=mi>1353318690</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ä¿®æ”¹ kubelet çš„<code>cpuManagerPolicy</code> ä¸º staticï¼Œå°†æ¨¡å¼ä» none åˆ‡æ¢ä¸º staticï¼Œé‡å¯ kubeletã€‚å‘ç° kubelet ä¼šå¯åŠ¨å¤±è´¥ï¼Œkubelet å¹¶ä¸èƒ½æ”¯æŒä»…ä¿®æ”¹å‚æ•°å°±åˆ‡æ¢æ¨¡å¼ï¼ŒæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>Mar</span> <span class=mi>06</span> <span class=mi>15</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span> <span class=n>iZt4nd5yyw9vfuxn3q2g3tZ</span> <span class=n>kubelet</span><span class=p>[</span><span class=mi>102800</span><span class=p>]:</span> <span class=n>E0306</span> <span class=mi>15</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mf>02.463939</span>  <span class=mi>102800</span> <span class=n>cpu_manager</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>223</span><span class=p>]</span> <span class=s2>&#34;Could not initialize checkpoint manager, please drain node and remove policy state file&#34;</span> <span class=n>err</span><span class=o>=</span><span class=s2>&#34;could not restore state from checkpoint: configured policy </span><span class=se>\&#34;</span><span class=s2>static</span><span class=se>\&#34;</span><span class=s2> differs from state checkpoint policy </span><span class=se>\&#34;</span><span class=s2>none</span><span class=se>\&#34;</span><span class=s2>, please drain this node and delete the CPU manager checkpoint file </span><span class=se>\&#34;</span><span class=s2>/var/lib/kubelet/cpu_manager_state</span><span class=se>\&#34;</span><span class=s2> before restarting Kubelet&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Mar</span> <span class=mi>06</span> <span class=mi>15</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>02</span> <span class=n>iZt4nd5yyw9vfuxn3q2g3tZ</span> <span class=n>kubelet</span><span class=p>[</span><span class=mi>102800</span><span class=p>]:</span> <span class=n>E0306</span> <span class=mi>15</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mf>02.463972</span>  <span class=mi>102800</span> <span class=n>kubelet</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>1392</span><span class=p>]</span> <span class=s2>&#34;Failed to start ContainerManager&#34;</span> <span class=n>err</span><span class=o>=</span><span class=s2>&#34;start cpu manager error: could not restore state from checkpoint: configured policy </span><span class=se>\&#34;</span><span class=s2>static</span><span class=se>\&#34;</span><span class=s2> differs from state checkpoint policy </span><span class=se>\&#34;</span><span class=s2>none</span><span class=se>\&#34;</span><span class=s2>, please drain this node and delete the CPU manager checkpoint file </span><span class=se>\&#34;</span><span class=s2>/var/lib/kubelet/cpu_manager_state</span><span class=se>\&#34;</span><span class=s2> before restarting Kubelet&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>å°†æ–‡ä»¶ <code>/var/lib/kubelet/cpu_manager_state</code> åˆ é™¤åï¼Œkubelet å³å¯å¯åŠ¨æˆåŠŸï¼Œæ–°åˆ›å»ºçš„ <code>/var/lib/kubelet/cpu_manager_state</code> æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{&#34;policyName&#34;:&#34;static&#34;,&#34;defaultCpuSet&#34;:&#34;0-3&#34;,&#34;checksum&#34;:611748604}
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹åˆ°å·²ç»å­˜åœ¨äº†ç»‘æ ¸çš„ podã€‚</p><p>å¦‚æœèŠ‚ç‚¹ä¸Šå·²ç»å­˜åœ¨ç¬¦åˆç»‘æ ¸æ¡ä»¶çš„ podï¼Œåœ¨ä¿®æ”¹é…ç½®å¹¶é‡å¯ kubelet åå³å¯ç»‘æ ¸ç”Ÿæ•ˆã€‚</p><h2 id=ç»‘æ ¸å®è·µ>ç»‘æ ¸å®è·µ</h2><p>é…ç½® kubelet çš„<code>cpuManagerPolicy</code>å€¼ä¸º staticï¼Œåˆ›å»º guaranteed podï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;200Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;200Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>åœ¨ pod è°ƒåº¦çš„èŠ‚ç‚¹ä¸Šï¼Œè¿›å…¥åˆ° /sys/fs/cgroup/cpuset/kubepods.slice ç›®å½•ä¸‹ï¼Œè·Ÿç»‘æ ¸ç›¸å…³çš„è®¾ç½®å‡åœ¨è¯¥ç›®å½•ä¸‹ï¼Œè¯¥ç›®å½•çš„ç»“æ„å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>ll</span> <span class=o>/</span><span class=n>sys</span><span class=o>/</span><span class=n>fs</span><span class=o>/</span><span class=n>cgroup</span><span class=o>/</span><span class=n>cpuset</span><span class=o>/</span><span class=n>kubepods</span><span class=o>.</span><span class=n>slice</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>cgroup</span><span class=o>.</span><span class=n>clone_children</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>cgroup</span><span class=o>.</span><span class=n>procs</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>cpu_exclusive</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>cpus</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>effective_cpus</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>effective_mems</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>mem_exclusive</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>mem_hardwall</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>memory_migrate</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>memory_pressure</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>memory_spread_page</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>memory_spread_slab</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>mems</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>sched_load_balance</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>sched_relax_domain_level</span>
</span></span><span class=line><span class=cl><span class=n>drwxr</span><span class=o>-</span><span class=n>xr</span><span class=o>-</span><span class=n>x</span>  <span class=mi>2</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>kubepods</span><span class=o>-</span><span class=n>besteffort</span><span class=o>.</span><span class=n>slice</span>
</span></span><span class=line><span class=cl><span class=n>drwxr</span><span class=o>-</span><span class=n>xr</span><span class=o>-</span><span class=n>x</span> <span class=mi>10</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>kubepods</span><span class=o>-</span><span class=n>burstable</span><span class=o>.</span><span class=n>slice</span>
</span></span><span class=line><span class=cl><span class=n>drwxr</span><span class=o>-</span><span class=n>xr</span><span class=o>-</span><span class=n>x</span>  <span class=mi>4</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>kubepods</span><span class=o>-</span><span class=n>pod4dc3ad18_5bad_4728_9f79_59f2378de46e</span><span class=o>.</span><span class=n>slice</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>notify_on_release</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>pool_size</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span>  <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>10</span><span class=p>:</span><span class=mi>31</span> <span class=n>tasks</span>
</span></span></code></pre></td></tr></table></div></div><p>å…¶ä¸­ kubepods-besteffort.slice å’Œ kubepods-burstable.slice åˆ†åˆ«å¯¹åº”çš„ besteffort å’Œ burstable ç±»å‹çš„ pod é…ç½®ï¼Œå› ä¸ºè¿™ä¸¤ç§ç±»å‹çš„ pod å¹¶ä¸æ‰§è¡Œç»‘æ ¸æ“ä½œï¼Œæ‰€æœ‰çš„å­ç›®å½•ä¸‹çš„ cpuset.cpus æ–‡ä»¶å‡ç»‘å®šçš„ cpu æ ¸ã€‚<br>kubepods-pod4dc3ad18_5bad_4728_9f79_59f2378de46e.slice ç›®å½•ä¸ºè¦ç»‘æ ¸çš„ pod ç›®å½•ï¼Œå…¶ä¸­ 4dc3ad18_5bad_4728_9f79_59f2378de46e æ ¹æ® pod çš„ uid è½¬æ¢è€Œæ¥ï¼Œpod çš„ <code>metadata.uid</code> å­—æ®µçš„å€¼ä¸º 4dc3ad18-5bad-4728-9f79-59f2378de46eï¼Œå³ç›®å½•ç»“æ„ä¸­å°†<code>-</code>è½¬æ¢ä¸º<code>_</code>ã€‚<br>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>ll</span> <span class=o>/</span><span class=n>sys</span><span class=o>/</span><span class=n>fs</span><span class=o>/</span><span class=n>cgroup</span><span class=o>/</span><span class=n>cpuset</span><span class=o>/</span><span class=n>kubepods</span><span class=o>.</span><span class=n>slice</span><span class=o>/</span><span class=n>kubepods</span><span class=o>-</span><span class=n>pod4dc3ad18_5bad_4728_9f79_59f2378de46e</span><span class=o>.</span><span class=n>slice</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cgroup</span><span class=o>.</span><span class=n>clone_children</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cgroup</span><span class=o>.</span><span class=n>procs</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>cpu_exclusive</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>cpus</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>effective_cpus</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>effective_mems</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>mem_exclusive</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>mem_hardwall</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>memory_migrate</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>memory_pressure</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>memory_spread_page</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>memory_spread_slab</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>mems</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>sched_load_balance</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cpuset</span><span class=o>.</span><span class=n>sched_relax_domain_level</span>
</span></span><span class=line><span class=cl><span class=n>drwxr</span><span class=o>-</span><span class=n>xr</span><span class=o>-</span><span class=n>x</span> <span class=mi>2</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cri</span><span class=o>-</span><span class=n>containerd</span><span class=o>-</span><span class=mi>75</span><span class=n>f8e4b4185f673869604d300629ec2de934cf253244bf91c577f9fc0ba0f14a</span><span class=o>.</span><span class=n>scope</span>
</span></span><span class=line><span class=cl><span class=n>drwxr</span><span class=o>-</span><span class=n>xr</span><span class=o>-</span><span class=n>x</span> <span class=mi>2</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>cri</span><span class=o>-</span><span class=n>containerd</span><span class=o>-</span><span class=n>cce0a338829921419407fcdc726d1a4bd5d4489da712b49a4834a020131ce718</span><span class=o>.</span><span class=n>scope</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>notify_on_release</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>pool_size</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>0</span> <span class=n>Mar</span>  <span class=mi>6</span> <span class=mi>15</span><span class=p>:</span><span class=mi>09</span> <span class=n>tasks</span>
</span></span></code></pre></td></tr></table></div></div><p>å…¶ä¸­ cri-containerd-75f8e4b4185f673869604d300629ec2de934cf253244bf91c577f9fc0ba0f14a.scope å’Œ cri-containerd-cce0a338829921419407fcdc726d1a4bd5d4489da712b49a4834a020131ce718.scope ä¸º pod çš„ä¸¤ä¸ªå®¹å™¨ï¼Œå…¶ä¸­ä¸€ä¸ªä¸º pause å®¹å™¨ï¼Œå¦å¤–ä¸€ä¸ªä¸º nginx å®¹å™¨ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ crictl pods | grep nginx-deploy
</span></span><span class=line><span class=cl>cce0a33882992       6 hours ago         Ready               nginx-deployment-67778646bb-mgcpg                          default             0                   (default)
</span></span></code></pre></td></tr></table></div></div><p>å…¶ä¸­ç¬¬ä¸€åˆ—çš„ cce0a33882992 ä¸º pod idï¼Œcri-containerd-cce0a338829921419407fcdc726d1a4bd5d4489da712b49a4834a020131ce718.scope å¯¹åº”çš„ä¸º pause å®¹å™¨ï¼ŒæŸ¥çœ‹è¯¥ç›®å½•ä¸‹çš„ cpuset.cpus æ–‡ä»¶ï¼Œç»‘å®šäº†æ‰€æœ‰çš„æ ¸ï¼Œå¹¶æœªåšç»‘æ ¸æ“ä½œã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ crictl ps | grep nginx-deploy
</span></span><span class=line><span class=cl>75f8e4b4185f6       e4720093a3c13       6 hours ago         Running             nginx                      0                   cce0a33882992       nginx-deployment-67778646bb-mgcpg
</span></span></code></pre></td></tr></table></div></div><p>å…¶ä¸­ç¬¬ä¸€åˆ—çš„ 75f8e4b4185f6 ä¸º container idï¼Œcri-containerd-75f8e4b4185f673869604d300629ec2de934cf253244bf91c577f9fc0ba0f14a.scope å¯¹åº”çš„ä¸º nginx å®¹å™¨ã€‚æŸ¥çœ‹ /sys/fs/cgroup/cpuset/kubepods.slice/kubepods-pod4dc3ad18_5bad_4728_9f79_59f2378de46e.slice/cri-containerd-75f8e4b4185f673869604d300629ec2de934cf253244bf91c577f9fc0ba0f14a.scope/cpuset.cpus å¯¹åº”çš„å€¼ä¸º<code>2-3</code>ï¼Œè¯´æ˜ç»‘æ ¸æˆåŠŸã€‚</p><p><code>/var/lib/kubelet/cpu_manager_state</code> æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼Œè·Ÿ cgroup cpuset å®é™…é…ç½®å¯ä»¥å®Œå…¨å¯¹åº”ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{&#34;policyName&#34;:&#34;static&#34;,&#34;defaultCpuSet&#34;:&#34;0-1&#34;,&#34;entries&#34;:{&#34;4dc3ad18-5bad-4728-9f79-59f2378de46e&#34;:{&#34;nginx&#34;:&#34;2-3&#34;}},&#34;checksum&#34;:3689800814}
</span></span></code></pre></td></tr></table></div></div><h2 id=kubelet-å†…éƒ¨å®ç°>kubelet å†…éƒ¨å®ç°</h2><p>åœ¨ kubelet å†…éƒ¨ï¼Œé‡‡ç”¨ <a class=link href=https://github.com/kubernetes/kubernetes/blob/master/pkg/kubelet/cm/cpumanager/cpu_manager.go target=_blank rel=noopener>cpu manager</a> æ¨¡å¼å®ç°ç»‘æ ¸åŠŸèƒ½ã€‚</p><h2 id=æ€»ç»“>æ€»ç»“</h2><ol><li>åªèƒ½ by èŠ‚ç‚¹é…ç½®ï¼Œä¸èƒ½æŒ‰ç…§ pod æ¥çµæ´»çš„é…ç½®ã€‚</li><li>æ— æ³•é€‚ç”¨äºæ‰€æœ‰ç±»å‹çš„ podï¼Œpod å¿…é¡»ä¸º Guaranteed æ—¶æ‰å…è®¸å¼€å¯ã€‚</li><li>ä¿®å¤é…ç½®è¾ƒä¸ºéº»çƒ¦ï¼Œä¸€æ—¦é…ç½®å˜æ›´åï¼Œéœ€è¦åˆ é™¤æ–‡ä»¶ <code>/var/lib/kubelet/cpu_manager_state</code> åæ‰å¯ç”Ÿæ•ˆï¼Œè€Œä¸”å¯¹ç°æœ‰çš„ pod å‡æœ‰å½±å“ã€‚</li></ol><h1 id=memory-manager>Memory Manager</h1><h2 id=kubelet-ä¸­å‚æ•°é…ç½®>kubelet ä¸­å‚æ•°é…ç½®</h2><p>k8s 1.21 ç‰ˆæœ¬å¼•å…¥ï¼Œéœ€è¦ä½¿ç”¨ featuregate å¼€å¯ï¼Œå‚æ•° <code>--feature-gates=MemoryManager=true</code>ã€‚åœ¨k8s 1.22 ç‰ˆæœ¬ä¸º beta ç‰ˆæœ¬ï¼Œé»˜è®¤å¼€å¯ã€‚</p><p>kubelet é€šè¿‡å‚æ•° <code>--memory-manager-policy</code> æ¥é…ç½®å†…å­˜ç®¡ç†ç­–ç•¥ï¼Œæ”¯æŒå¦‚ä¸‹å€¼ï¼š</p><ol><li>noneï¼šé»˜è®¤ç­–ç•¥ï¼Œä¸æ‰§è¡Œä»»ä½•å†…å­˜åˆ†é…çš„ç­–ç•¥ã€‚</li><li>staticï¼šä»…é’ˆå¯¹ Guaranteed pod ç”Ÿæ•ˆï¼Œå¯¹äº Guaranteed podï¼Œä¼šè¿”å›è·Ÿ NUMA ç›¸å…³çš„ topology hint ä¿¡æ¯ã€‚åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œä¼šä¿®æ”¹ cgroup cpuset.mems çš„é…ç½®ä¸ºå¯¹åº”çš„ cpu coreã€‚</li></ol><p>kubelet å°†å·²ç»åˆ†é…çš„ pod çš„å†…å­˜ç»‘å®šä¿¡æ¯ä½äºæ–‡ä»¶ <code>/var/lib/kubelet/memory_manager_state</code> ä¸­ï¼Œæ–‡ä»¶æ ¼å¼ä¸º jsonã€‚</p><h1 id=topology-manager>Topology Manager</h1><p>Topology Manager ç‰¹æ€§ç†è§£èµ·æ¥æ¯”è¾ƒæŠ½è±¡ã€‚ä¸¾ä¸ªä¾‹å­è¯´æ˜ï¼šä¸Šè¿°çš„ CPU Manager å’Œ Memory Manager çš„ç‰¹æ€§ï¼Œåœ¨ kubelet çš„å®ç°ä¸­æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ cpu å’Œå†…å­˜è¢«åˆ†é…åˆ°äº†ä¸åŒçš„ numa èŠ‚ç‚¹ä¸Šï¼ŒCPU Manager é€šè¿‡ cgroup çš„ cpuset.cpus æ¥æ§åˆ¶å®¹å™¨è¦ç»‘å®šçš„ cpuï¼Œè€Œ Memory Manager åˆ™é€šè¿‡ cgroup çš„ cpuset.mems æ¥æ§åˆ¶å®¹å™¨è¦ä½¿ç”¨çš„ NUMA node å†…å­˜ã€‚å¦‚æœä¸¤è€…çš„ä¿¡æ¯ä¸åŒ¹é…ï¼Œåˆ™ä¼šå¯¼è‡´è·¨ NUMA Node çš„å†…å­˜è®¿é—®ï¼Œä»è€Œä¼šå¯¹äºæ€§èƒ½è¦æ±‚é«˜çš„åº”ç”¨äº§ç”Ÿå½±å“ã€‚<br>Topology Manager æ˜¯ kubelet ä¸­çš„ä¸€éƒ¨åˆ†åŠŸèƒ½ï¼Œé€šè¿‡ Hint Providers æ¥å‘é€å’Œæ¥æ”¶å„ä¸ªæ¨¡å—çš„ NUMA æ‹“æ‰‘ä¿¡æ¯ï¼Œæ¯”å¦‚æ¥æ”¶ CPU Manager å’Œ Memory Manager çš„ NUMA Nodeä»¥åŠ NUMA Node åˆ†é…çš„ä¼˜å…ˆçº§ã€‚</p><h2 id=kubelet-çš„å‚æ•°é…ç½®-1>kubelet çš„å‚æ•°é…ç½®</h2><p>kubelet é€šè¿‡å‚æ•°<code>--topology-manager-scope</code>æ¥æŒ‡å®šä½œç”¨åŸŸï¼š</p><ol><li>containerï¼šé»˜è®¤å€¼ï¼ŒæŒ‰ç…§å®¹å™¨çº§åˆ«åˆ†é…åˆ°å…±åŒçš„ NUMA node é›†åˆä¸Šã€‚</li><li>podï¼šå°† pod å†…çš„æ‰€æœ‰ container åˆ†é…åˆ°å…±åŒçš„ NUMA node é›†åˆä¸Šã€‚</li></ol><p>kubelet é€šè¿‡å‚æ•° <code>--topology-manager-policy</code> æ¥è®¾ç½® NUMA çš„åˆ†é…ç­–ç•¥ï¼š</p><ol><li>noneï¼šé»˜è®¤å€¼ï¼Œä¸æ‰§è¡Œä»»ä½•çš„æ‹“æ‰‘å¯¹é½ã€‚</li></ol><ul><li>best-effortï¼šä¼˜å…ˆé€‰æ‹©é¦–é€‰äº²å’Œæ€§çš„ NUMA nodeï¼Œå¦‚æœäº²å’Œæ€§ä¸æ»¡è¶³ï¼Œpod ä»ç„¶å¯ä»¥è°ƒåº¦æˆåŠŸã€‚</li><li>restrictedï¼šé€‰æ‹©é¦–é€‰äº²å’Œæ€§çš„ NUMA nodeï¼Œå¦‚æœäº²å’Œæ€§ä¸æ»¡è¶³ï¼Œpod è°ƒåº¦å¤±è´¥ã€‚</li><li>single-numa-nodeï¼šé€šè¿‡ Hint Provider è¿”å›çš„ç»“æœï¼Œåˆ¤æ–­å• NUMA èŠ‚ç‚¹çš„äº²å’Œæ€§æ˜¯å¦ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œåˆ™ pod è°ƒåº¦å¤±è´¥ã€‚</li></ul><h2 id=kubelet-ä¸­çš„å®ç°>kubelet ä¸­çš„å®ç°</h2><p>åœ¨ kubelet ä¸­å®šä¹‰äº†æ¥å£ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// TopologyHint is a struct containing the NUMANodeAffinity for a Container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>TopologyHint</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// è®°å½•äº† NUMA Node æ»¡è¶³èµ„æºè¯·æ±‚çš„ä½æ©ç </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>NUMANodeAffinity</span><span class=w> </span><span class=nx>bitmask</span><span class=p>.</span><span class=nx>BitMask</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Preferred is set to true when the NUMANodeAffinity encodes a preferred</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// allocation for the Container. It is set to false otherwise.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// äº²å’Œæ€§çš„ç»“æœæ˜¯å¦ä¸ºé¦–é€‰çš„</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Preferred</span><span class=w> </span><span class=kt>bool</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// HintProvider is an interface for components that want to collaborate to</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// achieve globally optimal concrete resource alignment with respect to</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// NUMA locality.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>HintProvider</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// GetTopologyHints returns a map of resource names to a list of possible</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// concrete resource allocations in terms of NUMA locality hints. Each hint</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// is optionally marked &#34;preferred&#34; and indicates the set of NUMA nodes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// involved in the hypothetical allocation. The topology manager calls</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// this function for each hint provider, and merges the hints to produce</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// a consensus &#34;best&#34; hint. The hint providers may subsequently query the</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// topology manager to influence actual resource assignment.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nf>GetTopologyHints</span><span class=p>(</span><span class=nx>pod</span><span class=w> </span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>,</span><span class=w> </span><span class=nx>container</span><span class=w> </span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Container</span><span class=p>)</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>][]</span><span class=nx>TopologyHint</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// GetPodTopologyHints returns a map of resource names to a list of possible</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// concrete resource allocations per Pod in terms of NUMA locality hints.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nf>GetPodTopologyHints</span><span class=p>(</span><span class=nx>pod</span><span class=w> </span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>)</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>][]</span><span class=nx>TopologyHint</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Allocate triggers resource allocation to occur on the HintProvider after</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// all hints have been gathered and the aggregated Hint is available via a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// call to Store.GetAffinity().</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nf>Allocate</span><span class=p>(</span><span class=nx>pod</span><span class=w> </span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>,</span><span class=w> </span><span class=nx>container</span><span class=w> </span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Container</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>CPU Managerã€Memory Manager å’Œ Device Manager å‡å®ç°äº†è¯¥æ¥å£ã€‚åœ¨ Topology Manager ä¸­æ ¹æ®å„ä¸ª Manager è¿”å›çš„ TopologyHint æ•°æ®ï¼Œä»è€Œå†³å®šæœ€ç»ˆçš„ NUMA Node åˆ†é…ï¼Œå¹¶è°ƒç”¨å„ä¸ª Manager çš„ Allocate æ¥åšæœ€ç»ˆçš„ NUMA Node åˆ†é…ã€‚</p><h1 id=èµ„æ–™>èµ„æ–™</h1><ul><li><a class=link href=https://www.alibabacloud.com/help/zh/ack/ack-managed-and-ack-dedicated/user-guide/topology-aware-cpu-scheduling target=_blank rel=noopener>ACK CPUæ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦</a></li><li><a class=link href=https://v1-25.docs.kubernetes.io/zh-cn/docs/tasks/administer-cluster/cpu-management-policies/ target=_blank rel=noopener>æ§åˆ¶èŠ‚ç‚¹ä¸Šçš„ CPU ç®¡ç†ç­–ç•¥</a></li><li><a class=link href=https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/quality-service-pod/ target=_blank rel=noopener>é…ç½® Pod çš„æœåŠ¡è´¨é‡</a></li><li><a class=link href=https://developer.aliyun.com/article/784148 target=_blank rel=noopener>Kubeletä¹‹Topology Manageråˆ†æ</a></li></ul></section><footer class=article-footer></footer></article><script src=https://giscus.app/client.js data-repo=kuring/kuring.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkyODM4MzQ0NTk=" data-category=Announcements data-category-id=DIC_kwDOEOr4W84CdeTU data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=light data-lang=zh-CN data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark")}})()</script><footer class=site-footer><section class=copyright>&copy;
2013 -
2026 kuring</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.33.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>