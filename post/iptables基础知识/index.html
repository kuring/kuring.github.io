<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="æ¦‚è¦ netfilterä¸iptablesçš„å…³ç³» linuxåœ¨å†…æ ¸ä¸­å¯¹æ•°æ®åŒ…è¿‡æ»¤å’Œä¿®æ”¹çš„æ¨¡å—ä¸ºnetfilterï¼Œnetfilteræ¨¡å—æœ¬èº«å¹¶ä¸å¯¹æ•°æ®åŒ…è¿›è¡Œè¿‡æ»¤ï¼Œåªæ˜¯å…è®¸å°†è¿‡æ»¤æ•°æ®åŒ…æˆ–ä¿®æ”¹æ•°æ®åŒ…çš„å‡½æ•°hookåˆ°å†…æ ¸ç½‘ç»œåè®®æ ˆçš„é€‚å½“ä½ç½®ã€‚\n"><title>iptablesåŸºç¡€çŸ¥è¯†</title><link rel=canonical href=/post/iptables%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/><link rel=stylesheet href=/scss/style.min.833d6eed45de56f48306bf57268d5b8cdfc8a60e8e7bdc99810464fcd033f7c6.css><meta property='og:title' content="iptablesåŸºç¡€çŸ¥è¯†"><meta property='og:description' content="æ¦‚è¦ netfilterä¸iptablesçš„å…³ç³» linuxåœ¨å†…æ ¸ä¸­å¯¹æ•°æ®åŒ…è¿‡æ»¤å’Œä¿®æ”¹çš„æ¨¡å—ä¸ºnetfilterï¼Œnetfilteræ¨¡å—æœ¬èº«å¹¶ä¸å¯¹æ•°æ®åŒ…è¿›è¡Œè¿‡æ»¤ï¼Œåªæ˜¯å…è®¸å°†è¿‡æ»¤æ•°æ®åŒ…æˆ–ä¿®æ”¹æ•°æ®åŒ…çš„å‡½æ•°hookåˆ°å†…æ ¸ç½‘ç»œåè®®æ ˆçš„é€‚å½“ä½ç½®ã€‚\n"><meta property='og:url' content='/post/iptables%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/'><meta property='og:site_name' content='404é¢‘é“'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2018-01-31T23:25:12+00:00'><meta property='article:modified_time' content='2018-01-31T23:25:12+00:00'><meta name=twitter:title content="iptablesåŸºç¡€çŸ¥è¯†"><meta name=twitter:description content="æ¦‚è¦ netfilterä¸iptablesçš„å…³ç³» linuxåœ¨å†…æ ¸ä¸­å¯¹æ•°æ®åŒ…è¿‡æ»¤å’Œä¿®æ”¹çš„æ¨¡å—ä¸ºnetfilterï¼Œnetfilteræ¨¡å—æœ¬èº«å¹¶ä¸å¯¹æ•°æ®åŒ…è¿›è¡Œè¿‡æ»¤ï¼Œåªæ˜¯å…è®¸å°†è¿‡æ»¤æ•°æ®åŒ…æˆ–ä¿®æ”¹æ•°æ®åŒ…çš„å‡½æ•°hookåˆ°å†…æ ¸ç½‘ç»œåè®®æ ˆçš„é€‚å½“ä½ç½®ã€‚\n"><link rel="shortcut icon" href=/images/avatar.jpeg></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_16fb6c03614f4da2.jpeg width=300 height=280 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ“¡</span></figure><div class=site-meta><h1 class=site-name><a href=/>404é¢‘é“</a></h1><h2 class=site-description>å­¦ä¹ ç¬”è®°</h2></div></header><ol class=menu-social><li><a href=https://github.com/kuring target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>å…³äºæˆ‘</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>å½’æ¡£</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>æœç´¢</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#netfilterä¸iptablesçš„å…³ç³»>netfilterä¸iptablesçš„å…³ç³»</a></li></ol><ol><li><a href=#chain>chain</a></li><li><a href=#table>table</a><ol><li><a href=#filter>filter</a></li><li><a href=#nat>nat</a></li><li><a href=#mangle>mangle</a></li><li><a href=#raw>raw</a></li></ol></li><li><a href=#rule>rule</a></li><li><a href=#table-filter-ruleçš„å…³ç³»>table filter ruleçš„å…³ç³»</a><ol><li><a href=#é“¾ä¸­çš„è§„åˆ™å­˜åœ¨çš„è¡¨>é“¾ä¸­çš„è§„åˆ™å­˜åœ¨çš„è¡¨</a></li><li><a href=#è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨>è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨</a></li></ol></li></ol><ol><li><a href=#æŸ¥è¯¢>æŸ¥è¯¢</a></li><li><a href=#ä¿®æ”¹>ä¿®æ”¹</a></li><li><a href=#åˆ é™¤>åˆ é™¤</a></li><li><a href=#trace>trace</a></li></ol><ol><li><a href=#è¯•éªŒ1-åŸºæœ¬è§„åˆ™ç®¡ç†>è¯•éªŒ1 åŸºæœ¬è§„åˆ™ç®¡ç†</a><ol><li><a href=#æ’å…¥è§„åˆ™>æ’å…¥è§„åˆ™</a></li><li><a href=#åˆ é™¤è§„åˆ™>åˆ é™¤è§„åˆ™</a></li><li><a href=#ä¿®æ”¹è§„åˆ™>ä¿®æ”¹è§„åˆ™</a></li><li><a href=#ä¿å­˜è§„åˆ™>ä¿å­˜è§„åˆ™</a></li></ol></li><li><a href=#å®éªŒäºŒ-å„ç±»åŒ¹é…æ¡ä»¶çš„ä½¿ç”¨>å®éªŒäºŒ å„ç±»åŒ¹é…æ¡ä»¶çš„ä½¿ç”¨</a><ol><li><a href=#åŒ¹é…æ¡ä»¶>åŒ¹é…æ¡ä»¶</a></li><li><a href=#åè®®ç±»å‹>åè®®ç±»å‹</a></li><li><a href=#ç½‘å¡æ¥å£>ç½‘å¡æ¥å£</a></li></ol></li><li><a href=#å®éªŒä¸‰-æ‰©å±•æ¨¡å—>å®éªŒä¸‰ æ‰©å±•æ¨¡å—</a><ol><li><a href=#ç«¯å£>ç«¯å£</a></li><li><a href=#iprangeæ‰©å±•æ¨¡å—>iprangeæ‰©å±•æ¨¡å—</a></li><li><a href=#stringæ‰©å±•æ¨¡å—>stringæ‰©å±•æ¨¡å—</a></li><li><a href=#å…¶ä»–æ‰©å±•>å…¶ä»–æ‰©å±•</a></li></ol></li><li><a href=#å®éªŒå››-è‡ªå®šä¹‰é“¾>å®éªŒå›› è‡ªå®šä¹‰é“¾</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/post/iptables%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/>iptablesåŸºç¡€çŸ¥è¯†</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2018-01-31T23:25:12Z>2018-01-31</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 11 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h1 id=æ¦‚è¦>æ¦‚è¦</h1><h2 id=netfilterä¸iptablesçš„å…³ç³»>netfilterä¸iptablesçš„å…³ç³»</h2><p>linuxåœ¨å†…æ ¸ä¸­å¯¹æ•°æ®åŒ…è¿‡æ»¤å’Œä¿®æ”¹çš„æ¨¡å—ä¸ºnetfilterï¼Œnetfilteræ¨¡å—æœ¬èº«å¹¶ä¸å¯¹æ•°æ®åŒ…è¿›è¡Œè¿‡æ»¤ï¼Œåªæ˜¯å…è®¸å°†è¿‡æ»¤æ•°æ®åŒ…æˆ–ä¿®æ”¹æ•°æ®åŒ…çš„å‡½æ•°hookåˆ°å†…æ ¸ç½‘ç»œåè®®æ ˆçš„é€‚å½“ä½ç½®ã€‚</p><img src=https://kuring.oss-cn-beijing.aliyuncs.com/common/Netfilter-packet-flow.svg><p>iptablesæ˜¯ç”¨æˆ·æ€çš„å·¥å…·ï¼Œç”¨äºå‘netfilterä¸­æ·»åŠ è§„åˆ™ä»è€Œå®ç°æŠ¥æ–‡çš„è¿‡æ»¤å’Œä¿®æ”¹ç­‰åŠŸèƒ½ï¼Œå·¥ä½œåœ¨ipå±‚ã€‚ebtableså·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚ï¼Œç”¨äºå¤„ç†ä»¥å¤ªç½‘å¸§ã€‚</p><p>å›¾ä¸­ç»¿è‰²ä»£è¡¨iptablesçš„è¡¨ï¼Œå¯ä»¥çœ‹åˆ°æœ‰éƒ¨åˆ†ä½äºäº†æ•°æ®é“¾è·¯å±‚ï¼Œä¹‹æ‰€ä»¥äº§ç”Ÿè¿™ç§å¥‡æ€ªçš„æ¶æ„ï¼ŒåŸå› æ˜¯bridge_nfæ¨¡å—ï¼Œå› ä¸ºbridgeå·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚ï¼Œä¸ä¸€å®šä¼šç»è¿‡ç½‘ç»œå±‚ï¼Œä½†ä»ç„¶éœ€è¦iptablesçš„åŠŸèƒ½ã€‚è¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨<a class=link href=http://ebtables.netfilter.org/br_fw_ia/br_fw_ia.html target=_blank rel=noopener>ebtables/iptables interaction on a Linux-based bridge</a>ä¸­äº†è§£ã€‚</p><p>æ¦‚å¿µï¼štables -> chains -> rules</p><h1 id=iptabelsä»‹ç»>iptabelsä»‹ç»</h1><h2 id=chain>chain</h2><p>æ¯ä¸ªè¡¨éƒ½ç”±ä¸€ç»„å†…ç½®çš„é“¾ï¼Œè¿˜å¯ä»¥æ·»åŠ ç”¨æˆ·è‡ªå®šä¹‰é“¾ï¼Œåªæ˜¯ç”¨æˆ·è‡ªå®šä¹‰é“¾æ²¡æœ‰é’©å­å¯ä»¥è§¦å‘ï¼Œéœ€è¦ä»å…¶ä»–é“¾é€šè¿‡<code>-j</code>å³JUMPè¿›è¡Œè§¦å‘ã€‚</p><ul><li>INPUT é“¾ï¼šå‘å¾€æœ¬æœºçš„æŠ¥æ–‡</li><li>OUTPUT é“¾ï¼šç”±æœ¬æœºå‘å‡ºçš„æŠ¥æ–‡</li><li>FORWARD é“¾ï¼šç»ç”±æœ¬æœºè½¬å‘çš„æŠ¥æ–‡</li><li>PREROUTING é“¾ï¼šæŠ¥æ–‡åˆ°è¾¾æœ¬æœºï¼Œè¿›è¡Œè·¯ç”±å†³ç­–ä¹‹å‰</li><li>POSTROUTING é“¾ï¼šæŠ¥æ–‡ç”±æœ¬æœºå‘å‡ºï¼Œè¿›è¡Œè·¯ç”±å†³ç­–ä¹‹å</li></ul><p><img src=https://kuring.oss-cn-beijing.aliyuncs.com/images/iptables1.png loading=lazy alt=image></p><p>ä»chainçš„è§’åº¦è€ƒè™‘æ•°æ®åŒ…çš„æµå‘ï¼š</p><ul><li>åˆ°æœ¬æœºæŸè¿›ç¨‹çš„æŠ¥æ–‡ï¼šPREROUTING -> INPUT</li><li>ç”±æœ¬æœºè½¬å‘çš„æŠ¥æ–‡ï¼šPREROUTING -> FORWARD -> POSTROUTING</li><li>ç”±æœ¬æœºæŸè¿›ç¨‹å‘å‡ºçš„æŠ¥æ–‡ï¼šOUTPUT -> POSTROUTING</li></ul><p>å½“ä¸€ä¸ªç½‘ç»œåŒ…è¿›å…¥ä¸€å°æœºå™¨çš„æ—¶å€™ï¼Œé¦–å…ˆæ‹¿ä¸‹ MAC å¤´çœ‹çœ‹ï¼Œæ˜¯ä¸æ˜¯æˆ‘çš„ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æ‹¿ä¸‹ IP å¤´æ¥ã€‚å¾—åˆ°ç›®æ ‡ IP ä¹‹åå‘¢ï¼Œå°±å¼€å§‹è¿›è¡Œè·¯ç”±åˆ¤æ–­ã€‚åœ¨è·¯ç”±åˆ¤æ–­ä¹‹å‰ï¼Œè¿™ä¸ªèŠ‚ç‚¹æˆ‘ä»¬ç§°ä¸º PREROUTINGã€‚å¦‚æœå‘ç° IP æ˜¯æˆ‘çš„ï¼ŒåŒ…å°±åº”è¯¥æ˜¯æˆ‘çš„ï¼Œå°±å‘ç»™ä¸Šé¢çš„ä¼ è¾“å±‚ï¼Œè¿™ä¸ªèŠ‚ç‚¹å«ä½œ INPUTã€‚å¦‚æœå‘ç° IP ä¸æ˜¯æˆ‘çš„ï¼Œå°±éœ€è¦è½¬å‘å‡ºå»ï¼Œè¿™ä¸ªèŠ‚ç‚¹ç§°ä¸º FORWARDã€‚å¦‚æœæ˜¯æˆ‘çš„ï¼Œä¸Šå±‚å¤„ç†å®Œæ¯•å®Œæ¯•åï¼Œä¸€èˆ¬ä¼šè¿”å›ä¸€ä¸ªå¤„ç†ç»“æœï¼Œè¿™ä¸ªå¤„ç†ç»“æœä¼šå‘å‡ºå»ï¼Œè¿™ä¸ªèŠ‚ç‚¹ç§°ä¸º OUTPUTï¼Œæ— è®ºæ˜¯ FORWARD è¿˜æ˜¯ OUTPUTï¼Œéƒ½æ˜¯è·¯ç”±åˆ¤æ–­ä¹‹åå‘ç”Ÿçš„ï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹æ˜¯ POSTROUTINGã€‚</p><h2 id=table>table</h2><p>æœ‰äº†chainçš„æ¦‚å¿µåï¼Œä¸ºäº†ä¾¿äºchainä¸­ruleçš„ç®¡ç†ï¼Œåˆå¼•å…¥äº†tableçš„æ¦‚å¿µï¼Œç”¨äºå­˜æ”¾ç›¸åŒåŠŸèƒ½çš„ruleï¼Œä¸åŒåŠŸèƒ½çš„ruleæ”¾åˆ°ä¸åŒçš„tableä¸­ã€‚</p><p>åŒ…æ‹¬ï¼šfilter nat mangle raw</p><h3 id=filter>filter</h3><p>é»˜è®¤è¡¨ï¼Œç®¡ç†æœ¬æœºæ•°æ®åŒ…çš„è¿›å‡ºï¼Œç”¨äºå®ç°åŒ…çš„è¿‡æ»¤ï¼Œå¯¹åº”å†…æ ¸æ¨¡å—iptables_filter</p><p>inputï¼šæƒ³è¦è¿›å…¥linuxä¸»æœºçš„åŒ…
outputï¼šlinuxä¸»æœºè¦å‘é€çš„åŒ…
forwardï¼šä¼ é€’åŒ…åˆ°åç«¯è®¡ç®—æœºï¼Œä¸nat tableå…³è”è¾ƒå¤š</p><h3 id=nat>nat</h3><p>ç®¡ç†åç«¯ä¸»æœºè¿›å‡ºï¼Œä¸linuxä¸»æœºæ²¡æœ‰å…³ç³»ï¼Œä¸linuxåçš„ä¸»æœºæœ‰å…³</p><p>preroutingï¼šè¿›è¡Œè·¯ç”±åˆ¤æ–­ä¹‹å‰çš„è§„åˆ™(dnat/redirect)
postroutingï¼šè·¯ç”±åˆ¤æ–­ä¹‹åæ‰§è¡Œçš„è§„åˆ™(snat/masquerade)
outputï¼šä¸å‘å‡ºå»çš„åŒ…æœ‰å…³</p><h3 id=mangle>mangle</h3><p>è¾ƒå°‘ä½¿ç”¨ï¼Œç”¨äºæ‹†è§£æŠ¥æ–‡ï¼Œä¿®æ”¹æ•°æ®åŒ…ï¼Œå¹¶é‡æ–°å°è£…ã€‚</p><h3 id=raw>raw</h3><p>rawè¡¨çš„ä¸»è¦ä½œç”¨æ˜¯å…è®¸æˆ‘ä»¬ç»™æŸäº›ç‰¹å®šçš„æ•°æ®åŒ…æ‰“ä¸Šæ ‡è®°ã€‚</p><h2 id=rule>rule</h2><p>åŒ…å«äº†åŒ¹é…æ¡ä»¶å’Œå¤„ç†åŠ¨ä½œã€‚</p><p>åŒ¹é…æ¡ä»¶åŒ…æ‹¬ï¼šsource ipã€destination ipã€source portã€destination port</p><p>å¤„ç†åŠ¨ä½œåŒ…æ‹¬ï¼š</p><ul><li>accept: å°†åŒ…äº¤ç»™åè®®æ ˆ</li><li>dropï¼šç›´æ¥ä¸¢å¼ƒæ•°æ®åŒ…ï¼Œä¸ç»™ä»»ä½•å›åº”</li><li>rejectï¼šæ‹’ç»æ•°æ®åŒ…é€šè¿‡ï¼Œå¹¶ç»™ä¸€ä¸ªå“åº”ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°æ‹’ç»æ¶ˆæ¯</li><li>queue: äº¤ä¸ªæŸä¸ªç”¨æˆ·æ€è¿›ç¨‹å¤„ç†</li><li>dnatï¼šç›®çš„åœ°å€è½¬æ¢</li><li>snatï¼šæºåœ°å€è½¬æ¢ï¼Œå¿…é¡»è¦æŒ‡å®šSNATåœ°å€ï¼Œå³&ndash;to-sourceå‚æ•°ï¼Œå¯ä»¥æ˜¯å•ä¸ªipï¼Œä¹Ÿå¯ä»¥æ˜¯ç½‘æ®µã€‚ç”¨åœ¨POSTROUTINGé“¾ä¸Šã€‚</li><li>masquerade: æºåœ°å€ä¼ªè£…ï¼Œè·Ÿsnatç±»ä¼¼ï¼Œä¸éœ€è¦æŒ‡å®šSNATåœ°å€ï¼Œä¼šè‡ªåŠ¨ä»æœåŠ¡å™¨ä¸Šè·å–SNATçš„ipåœ°å€ã€‚å¦‚æœæœ‰å¤šä¸ªç½‘å¡çš„æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨è·¯ç”±é€‰æ‹©ç®—æ³•ã€‚</li><li>mark: å¯¹æ•°æ®åŒ…è¿›è¡Œæ‰“æ ‡ç­¾æ“ä½œ</li></ul><h2 id=table-filter-ruleçš„å…³ç³»>table filter ruleçš„å…³ç³»</h2><p>è¿™ä¸‰è€…ä¹‹é—´çš„å…³ç³»è¿˜æ˜¯ç›¸å½“çš„ç»•ã€‚</p><h3 id=é“¾ä¸­çš„è§„åˆ™å­˜åœ¨çš„è¡¨>é“¾ä¸­çš„è§„åˆ™å­˜åœ¨çš„è¡¨</h3><p>chainä¸­å­˜æ”¾äº†ruleï¼ŒæŸäº›chainä¸­æ³¨å®šä¸åŒ…å«æŸäº›ruleã€‚ä¾‹å¦‚preroutingé“¾ä¸­çš„ruleä»…å­˜åœ¨äºnat raw mangleä¸‰å¼ è¡¨ä¸­ã€‚</p><p>preroutingé“¾ä¸­çš„è§„åˆ™å­˜åœ¨çš„è¡¨ï¼šraw mangle nat
inputé“¾ä¸­çš„è§„åˆ™å­˜åœ¨çš„è¡¨ï¼šmangle filter nat
forwardé“¾ä¸­çš„è§„åˆ™å­˜åœ¨çš„è¡¨ï¼šmangle filter
outputé“¾ä¸­çš„è§„åˆ™å­˜åœ¨çš„è¡¨ï¼šraw mangle filter nat
postroutingé“¾ä¸­çš„è§„åˆ™å­˜åœ¨çš„è¡¨ï¼šmangle nat</p><h3 id=è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨>è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨</h3><p>rawè¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«é“¾ä½¿ç”¨ï¼šprerouting output</p><p><img src=https://kuring.oss-cn-beijing.aliyuncs.com/images/iptables2.png loading=lazy alt=image></p><p>è¡¨çš„åå­—ä¸ºå°å†™ï¼Œé“¾çš„åå­—ä¸ºå¤§å†™</p><h1 id=å¸¸ç”¨æ“ä½œ>å¸¸ç”¨æ“ä½œ</h1><h2 id=æŸ¥è¯¢>æŸ¥è¯¢</h2><p>iptables æŸ¥è¯¢é»˜è®¤çš„è¡¨ä¸ºfilterï¼Œé»˜è®¤ä¼šåˆ—å‡ºè¡¨ä¸­æ‰€æœ‰é“¾çš„è§„åˆ™</p><ul><li>-t ç”¨äºæŒ‡å®šè¦æ“ä½œçš„è¡¨ï¼Œæ”¯æŒraw mangle filter natï¼Œçœç•¥-té€‰é¡¹ï¼Œé»˜è®¤ä½¿ç”¨filterè¡¨</li><li>-L åˆ—å‡ºrule</li><li>-v å¯æŸ¥çœ‹æ›´è¯¦ç»†çš„ä¿¡æ¯</li><li>-n è§„åˆ™ä¸­ä»¥ipåœ°å€çš„å½¢å¼è¿›è¡Œæ˜¾ç¤º</li><li>&ndash;line-number æ˜¾ç¤ºè§„åˆ™çš„ç¼–å·</li><li>-x åŒ…çš„è®¡æ•°ä»¥ç²¾ç¡®æ•°å­—æ˜¾ç¤º</li></ul><p><code>iptables -t filter -L</code>ï¼šä»è¡¨çš„è§’åº¦æŸ¥è¯¢è§„åˆ™ï¼Œç”¨äºæŸ¥çœ‹filterè¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™</p><p><code>iptables -L INPUT</code>: ä»é“¾çš„è§’åº¦æŸ¥è¯¢è§„åˆ™ï¼Œç”¨äºæŸ¥çœ‹INPUTé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™</p><p><code>iptables -vL INPUT</code>: ä»é“¾çš„è§’åº¦æŸ¥è¯¢è§„åˆ™ï¼Œç”¨äºæŸ¥çœ‹INPUTé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼Œå¯æŸ¥çœ‹æ›´è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…å«äº†è§„åˆ™çš„åŒ¹é…ä¿¡æ¯</p><p><code>iptables -nvL</code>ï¼šä»¥ç²¾ç¡®æ•°å­—æ˜¾ç¤º</p><h2 id=ä¿®æ”¹>ä¿®æ”¹</h2><ul><li>-F: æ¸…ç©ºè§„åˆ™</li><li>-I: è¡¨ç¤ºæ’å…¥è§„åˆ™</li><li>-A: è¡¨ç¤ºä»¥è¿½åŠ çš„æ–¹å¼æ’å…¥è§„åˆ™</li><li><code>--dport</code>: ç›®çš„ç«¯å£</li><li><code>--sport</code>: æºç«¯å£</li><li>-s: æºip</li><li>-d: ç›®çš„ip</li><li><code>--match-set</code>ï¼šåŒ¹é…ipset</li></ul><p><code>iptables -F INPUT</code>ï¼šæ¸…ç©ºfilterè¡¨ä¸­çš„INPUTé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™ã€‚</p><h2 id=åˆ é™¤>åˆ é™¤</h2><ul><li>-D: åˆ é™¤è§„åˆ™ï¼Œ<code>iptables -D é“¾å è§„åˆ™ç¼–å·</code>ï¼Œå…¶ä¸­è§„åˆ™ç¼–å·å¯ä»¥é€šè¿‡<code>--line-number</code>æŸ¥çœ‹åˆ°ã€‚</li><li>-F: æ¸…ç©ºè§„åˆ™ï¼Œ<code>iptables -F é“¾å -t è¡¨å</code></li><li>-X: åˆ é™¤é“¾ <code>iptables -X é“¾å -t è¡¨å</code></li></ul><h2 id=trace>trace</h2><p>å¼€å¯traceåŠŸèƒ½</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># centos7 ç³»ç»Ÿä¸‹æœ‰æ•ˆï¼Œcentos6ä¸‹å†…æ ¸æ¨¡å—ä¸ºipt_LOG
</span></span><span class=line><span class=cl>$ modprobe nf_log_ipv4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># ç”¨æ¥éªŒè¯moduleæ˜¯å¦åŠ è½½æˆåŠŸ
</span></span><span class=line><span class=cl>$ sysctl net.netfilter.nf_log.2
</span></span></code></pre></td></tr></table></div></div><p>è¦å¼€å¯icmpåè®®çš„è¿½è¸ªï¼Œæ‰§è¡Œå¦‚ä¸‹çš„å‘½ä»¤</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>iptables -t raw -A OUTPUT -p icmp -m comment --comment &#34;TRACE&#34; -j TRACE
</span></span><span class=line><span class=cl>iptables -t raw -A PREROUTING -p icmp -m comment --comment &#34;TRACE&#34; -j TRACE
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„å‘½ä»¤çœ‹åˆ°æ’å…¥çš„iptabelsè§„åˆ™ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>iptables -t raw -nvL --line-number
</span></span></code></pre></td></tr></table></div></div><p>è¿½è¸ªæ—¥å¿—æœ€ç»ˆä¼šåœ¨/var/log/messageæˆ–è€…/var/log/kernä¸‹çœ‹åˆ°ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Feb  6 11:22:04 c43k09006.cloud.k09.am17 kernel: TRACE: raw:PREROUTING:policy:3 IN=docker0 OUT= PHYSIN=bond0.9 MAC=02:42:30:fb:43:94:5c:c9:99:de:c4:8b:08:00 SRC=10.45.8.10 DST=10.45.4.99 LEN=84 TOS=0x00 PREC=0x00 TTL=62 ID=25550 DF PROTO=ICMP TYPE=0 CODE=0 ID=24191 SEQ=2
</span></span></code></pre></td></tr></table></div></div><p>æ ¼å¼è¿™å—çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><p>&ldquo;TRACE: tablename:chainname:type:rulenum " where type can be &ldquo;rule&rdquo; for plain rule, &ldquo;return&rdquo; for implicit rule at the end of a user defined chain and &ldquo;policy&rdquo; for the policy of the built in chains.</p><p>ç¯å¢ƒæ¸…ç†ï¼Œåˆ é™¤åˆšåˆšåˆ›å»ºçš„è§„åˆ™å³å¯ï¼Œå…¶ä¸­1ä¸ºè§„åˆ™çš„ç¼–å·ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># å¯ä»¥é€šè¿‡æ­¤æ¥æŸ¥è¯¢ä¹‹å‰åˆ›å»ºçš„è§„åˆ™ç¼–å·
</span></span><span class=line><span class=cl>iptables -t raw --line-number -nvL
</span></span><span class=line><span class=cl># åˆ é™¤è§„åˆ™
</span></span><span class=line><span class=cl>iptables -t raw -D PREROUTING 1
</span></span><span class=line><span class=cl>iptables -t raw -D OUTPUT 1
</span></span></code></pre></td></tr></table></div></div><h1 id=å®æˆ˜>å®æˆ˜</h1><h2 id=è¯•éªŒ1-åŸºæœ¬è§„åˆ™ç®¡ç†>è¯•éªŒ1 åŸºæœ¬è§„åˆ™ç®¡ç†</h2><h3 id=æ’å…¥è§„åˆ™>æ’å…¥è§„åˆ™</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># æ¸…ç©ºfilterè¡¨ä¸­çš„inputé“¾è§„åˆ™
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -F INPUT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># æŸ¥çœ‹filterè¡¨ä¸­çš„è¯¦ç»†è§„åˆ™ï¼Œæ­¤æ—¶ä»å…¶ä»–æœºå™¨ä¸Špingè¯¥ipæ˜¯é€šçš„
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -nvL INPUT
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 7 packets, 388 bytes)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl># å¢åŠ è§„åˆ™ï¼Œæ‹’ç»192.168.33.1ä¸Šçš„è¯·æ±‚
</span></span><span class=line><span class=cl># -Iï¼šè¡¨ç¤ºæ’å…¥
</span></span><span class=line><span class=cl># INPUTä¸ºè¦æ’å…¥çš„é“¾
</span></span><span class=line><span class=cl># -sï¼šè¡¨ç¤ºæºipåœ°å€
</span></span><span class=line><span class=cl># -jï¼šè¡¨ç¤ºè¦æ‰§è¡Œçš„åŠ¨ä½œ
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -I INPUT -s 192.168.33.1 -j DROP
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># å†æ¬¡æŸ¥è¯¢filterè¡¨ä¸­çš„è§„åˆ™ï¼Œæ­¤æ—¶192.168.33.1ä¸Šçš„æŠ¥æ–‡å·²ç»ä¸é€š
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -nvL
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 107 packets, 6170 bytes)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>    0     0 DROP       all  --  *      *       192.168.33.1         0.0.0.0/0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Chain OUTPUT (policy ACCEPT 56 packets, 4355 bytes)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># appentä¸€æ¡æ¥æ”¶192.168.33.1çš„è¯·æ±‚è§„åˆ™
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -A INPUT -s 192.168.33.1 -j ACCEPT
</span></span><span class=line><span class=cl># æ–°å¢åŠ çš„åºå·ä¸º2ï¼Œ192.168.33.1çš„åŒ…åŒ¹é…åˆ°1åå°±åœæ­¢å¾€ä¸‹èµ°ï¼Œå› æ­¤192.168.33.1è¿˜æ˜¯pingä¸é€šå½“å‰ä¸»æœº
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -nvL INPUT --line-number
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 65 packets, 3572 bytes)
</span></span><span class=line><span class=cl>num   pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>1        9   756 DROP       all  --  *      *       192.168.33.1         0.0.0.0/0
</span></span><span class=line><span class=cl>2        0     0 ACCEPT     all  --  *      *       192.168.33.1         0.0.0.0/0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># æ’å…¥ä¸€æ¡ACCEPT ruleï¼Œæ­¤æ—¶192.168.33.1å¯ä»¥pingé€šå½“å‰ä¸»æœºï¼Œæ–°æ’å…¥çš„è§„åˆ™ä¼˜å…ˆ
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -I INPUT -s 192.168.33.1 -j ACCEPT
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -nvL INPUT --line-number
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 7 packets, 388 bytes)
</span></span><span class=line><span class=cl>num   pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>1        0     0 ACCEPT     all  --  *      *       192.168.33.1         0.0.0.0/0
</span></span><span class=line><span class=cl>2       10   840 DROP       all  --  *      *       192.168.33.1         0.0.0.0/0
</span></span><span class=line><span class=cl>3        0     0 ACCEPT     all  --  *      *       192.168.33.1         0.0.0.0/0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># æ–°æ’å…¥ä¸€æ¡accept 192.168.33.2çš„è§„åˆ™ï¼Œæ’å…¥ä½ç½®ä¸º2ï¼Œå¯ä»¥çœ‹åˆ°æ’å…¥åˆ°2çš„ä½ç½®äº†
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -I INPUT 2 -s 192.168.33.2 -j ACCEPT
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -nvL INPUT --line-number
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 7 packets, 388 bytes)
</span></span><span class=line><span class=cl>num   pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>1        1    84 ACCEPT     all  --  *      *       192.168.33.1         0.0.0.0/0
</span></span><span class=line><span class=cl>2        0     0 ACCEPT     all  --  *      *       192.168.33.2         0.0.0.0/0
</span></span><span class=line><span class=cl>3       10   840 DROP       all  --  *      *       192.168.33.1         0.0.0.0/0
</span></span><span class=line><span class=cl>4        0     0 ACCEPT     all  --  *      *       192.168.33.1         0.0.0.0/0
</span></span></code></pre></td></tr></table></div></div><h3 id=åˆ é™¤è§„åˆ™>åˆ é™¤è§„åˆ™</h3><p>æ¥ä¸‹åœ¨ä¸Šé¢å®éªŒçš„åŸºç¡€ä¸Šæµ‹è¯•åˆ é™¤è§„åˆ™</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># åˆ é™¤åˆšåˆšåˆ›å»ºçš„è§„åˆ™2
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -D INPUT 2
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -nvL INPUT --line-number
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 7 packets, 388 bytes)
</span></span><span class=line><span class=cl>num   pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>1        1    84 ACCEPT     all  --  *      *       192.168.33.1         0.0.0.0/0
</span></span><span class=line><span class=cl>2       10   840 DROP       all  --  *      *       192.168.33.1         0.0.0.0/0
</span></span><span class=line><span class=cl>3        0     0 ACCEPT     all  --  *      *       192.168.33.1         0.0.0.0/0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># åˆ é™¤sourceä¸º192.168.33.1ï¼ŒåŠ¨ä½œä¸ºACCEPTçš„è§„åˆ™ï¼Œå®é™…æ­¤æ—¶æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ä»…èƒ½åˆ é™¤ä¸€æ¡
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -D INPUT -s 192.168.33.1 -j ACCEPT
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -nvL INPUT --line
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 13 packets, 736 bytes)
</span></span><span class=line><span class=cl>num   pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>1       11   936 DROP       all  --  *      *       192.168.33.1         0.0.0.0/0
</span></span></code></pre></td></tr></table></div></div><h3 id=ä¿®æ”¹è§„åˆ™>ä¿®æ”¹è§„åˆ™</h3><p>åœ¨ä¸Šé¢å®éªŒçš„åŸºç¡€ä¸Šä¿®æ”¹è§„åˆ™</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># å°†è§„åˆ™åŠ¨ä½œä»REJECTæ›´æ”¹ä¸ºREJECT
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -R INPUT 1 -s 192.168.33.1 -j REJECT
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -nvL INPUT --line
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 7 packets, 388 bytes)
</span></span><span class=line><span class=cl>num   pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>1        0     0 REJECT     all  --  *      *       192.168.33.1         0.0.0.0/0            reject-with icmp-port-unreachable
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># æ¯ä¸ªé“¾éƒ½æœ‰ä¸€ä¸ªé»˜è®¤è§„åˆ™ï¼Œå½“å‰INPUTé“¾ä¸­çš„é»˜è®¤ä¸ºACCEPT
</span></span><span class=line><span class=cl># ä»¥ä¸‹å¯ä»¥ä¿®æ”¹INPUTé“¾çš„é»˜è®¤è§„åˆ™ä¸ºDROPï¼Œè¿œç¨‹è¿æ¥æ…ç”¨ï¼Œä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆ
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -P INPUT DROP
</span></span></code></pre></td></tr></table></div></div><h3 id=ä¿å­˜è§„åˆ™>ä¿å­˜è§„åˆ™</h3><p>é˜²ç«å¢™çš„æ‰€æœ‰ä¿®æ”¹éƒ½æ˜¯ä¸´æ—¶çš„ï¼Œé‡å¯ç³»ç»Ÿåä¼šå¤±æ•ˆã€‚iptablesä¼šè¯»å–/etc/sysconfig/iptablesä¸­çš„è§„åˆ™ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># iptables-saveå‘½ä»¤ä»…ä¼šæ‰“å°å½“å‰çš„è§„åˆ™ï¼Œéœ€è¦ä½¿ç”¨é‡å®šå‘å½“å‰è§„åˆ™åˆ°æ–‡ä»¶ä¸­
</span></span><span class=line><span class=cl>[root@localhost system]# iptables-save &gt; /etc/sysconfig/iptables
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># å¯ä»¥ä»è§„åˆ™æ–‡ä»¶ä¸­è½½å…¥è§„åˆ™
</span></span><span class=line><span class=cl>[root@localhost system]# iptables-restore &lt; /etc/sysconfig/iptables
</span></span></code></pre></td></tr></table></div></div><h2 id=å®éªŒäºŒ-å„ç±»åŒ¹é…æ¡ä»¶çš„ä½¿ç”¨>å®éªŒäºŒ å„ç±»åŒ¹é…æ¡ä»¶çš„ä½¿ç”¨</h2><h3 id=åŒ¹é…æ¡ä»¶>åŒ¹é…æ¡ä»¶</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># å¯ä¸€æ¬¡æ€§æ’å…¥ä¸¤æ¡è§„åˆ™
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -I INPUT -s 192.168.33.1,192.168.33.2 -j DROP
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -nvL INPUT --line
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 31 packets, 1744 bytes)
</span></span><span class=line><span class=cl>num   pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>1        0     0 DROP       all  --  *      *       192.168.33.2         0.0.0.0/0
</span></span><span class=line><span class=cl>2        0     0 DROP       all  --  *      *       192.168.33.1         0.0.0.0/0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># å¯æŒ‡å®šipç½‘æ®µ
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -F INPUT
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -I INPUT -s 192.168.33.0/24 -j DROP
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -nvL INPUT --line
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 7 packets, 388 bytes)
</span></span><span class=line><span class=cl>num   pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>1        0     0 DROP       all  --  *      *       192.168.33.0/24      0.0.0.0/0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -I INPUT ! -s 192.168.33.0/24 -j DROP
</span></span><span class=line><span class=cl>[vagrant@localhost ~]$ sudo iptables -t filter -nvL INPUT --line
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 19 packets, 1048 bytes)
</span></span><span class=line><span class=cl>num   pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>1        0     0 DROP       all  --  *      *      !10.0.2.0/24          0.0.0.0/0
</span></span></code></pre></td></tr></table></div></div><h3 id=åè®®ç±»å‹>åè®®ç±»å‹</h3><p>ä½¿ç”¨-pæ¥æŒ‡å®šåè®®ç±»å‹ï¼Œæ”¯æŒtcp udp icmpç­‰ï¼Œä¸æŒ‡å®šæ—¶é»˜è®¤åŒ¹é…æ‰€æœ‰åè®®</p><h3 id=ç½‘å¡æ¥å£>ç½‘å¡æ¥å£</h3><p><code>-i</code>æ¥æŒ‡å®šä»æŸä¸ªç½‘å¡è¿›å…¥çš„æµé‡ï¼Œä»…ä½¿ç”¨äºPREROUTING INPUT FORWARDä¸‰æ¡é“¾ã€‚</p><p><code>-o</code>æ¥æŒ‡å®šä»æŸä¸ªç½‘ç»œæµå‡ºçš„æµé‡ï¼Œä»…é€‚ç”¨äºFORWARD OUTPUT POSTROUTINGä¸‰æ¡é“¾ã€‚</p><h2 id=å®éªŒä¸‰-æ‰©å±•æ¨¡å—>å®éªŒä¸‰ æ‰©å±•æ¨¡å—</h2><h3 id=ç«¯å£>ç«¯å£</h3><p>ä½¿ç”¨äº†æ‰©å±•æ¨¡å—tcp udpï¼Œé»˜è®¤å¯ä»¥çœç•¥</p><p><code>--dport</code>æ¥åŒ¹é…æŠ¥æ–‡çš„ç›®çš„ç«¯å£ï¼Œä½¿ç”¨æ—¶å¿…é¡»æŒ‡å®šåè®®ï¼Œå³<code>-p</code>é€‰é¡¹ã€‚
<code>--sport</code>æ¥åŒ¹é…æŠ¥æ–‡çš„æºç«¯å£ï¼Œä½¿ç”¨æ—¶å¿…é¡»æŒ‡å®šåè®®ï¼Œå³<code>-p</code>é€‰é¡¹ã€‚</p><p>ç«¯å£å¯ä»¥æŒ‡å®šèŒƒå›´ï¼Œä¾‹å¦‚22:25è¡¨ç¤º22-25ä¹‹é—´çš„æ‰€æœ‰ç«¯å£ï¼Œ22,25è¡¨ç¤º22å’Œ25ç«¯å£ï¼Œè¿˜å¯ä»¥é…åˆèµ·æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚22,80:88è¡¨ç¤º22å’Œ80-88ä¹‹é—´çš„ç«¯å£ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># å¯ä»¥æŒ‡å®šç›®çš„ç«¯å£çš„èŒƒå›´
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -t filter -I INPUT -s 192.168.33.1 -p tcp --dport 22:25 -j REJECT
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -t filter -nvL INPUT --line
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 70 packets, 4024 bytes)
</span></span><span class=line><span class=cl>num   pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>1        0     0 REJECT     tcp  --  *      *       192.168.33.1         0.0.0.0/0            tcp dpts:22:25 reject-with icmp-port-unreachable
</span></span></code></pre></td></tr></table></div></div><h3 id=iprangeæ‰©å±•æ¨¡å—>iprangeæ‰©å±•æ¨¡å—</h3><p>iprangeæ‰©å±•æ¨¡å—å¯ä»¥æŒ‡å®šä¸€æ®µè¿ç»­çš„ipåœ°å€èŒƒå›´ã€‚</p><p><code>--src-range</code>å’Œ<code>--dst-range</code>ç”¨æ¥æŒ‡å®šæºåœ°å€å’Œç›®çš„èŒƒå›´ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@localhost vagrant]# iptables -t filter -I INPUT -m iprange --src-range 192.168.33.1-192.168.33.10 -j DROP
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -t filter -nvL INPUT --line
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 17 packets, 968 bytes)
</span></span><span class=line><span class=cl>num   pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>1        0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0            source IP range 192.168.33.1-192.168.33.10
</span></span></code></pre></td></tr></table></div></div><h3 id=stringæ‰©å±•æ¨¡å—>stringæ‰©å±•æ¨¡å—</h3><p>åŒ¹é…æŠ¥æ–‡ä¸­åŒ…å«çš„å­—ç¬¦ä¸²</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># åŒ¹é…æŠ¥æ–‡ä¸­åŒ…å«XXOOçš„æŠ¥æ–‡
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -t filter -I INPUT -m string --algo bm --string &#34;XXOO&#34; -j REJECT
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -t filter -nvL INPUT --line
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 15 packets, 852 bytes)
</span></span><span class=line><span class=cl>num   pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>1        0     0 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            STRING match  &#34;XXOO&#34; ALGO name bm TO 65535 reject-with icmp-port-unreachable
</span></span></code></pre></td></tr></table></div></div><h3 id=å…¶ä»–æ‰©å±•>å…¶ä»–æ‰©å±•</h3><p>timeæ‰©å±•ç”¨æ¥æ ¹æ®æ—¶é—´æ®µè¿›è¡ŒåŒ¹é…</p><p>connlimitç”¨æ¥å¯¹ipçš„å¹¶å‘è¿æ¥æ•°è¿›è¡Œé™åˆ¶</p><p>limitæ¨¡å—é™åˆ¶å•ä½æ—¶é—´å†…è¿›å‡ºåŒ…çš„æ•°é‡</p><p>tcpæ‰©å±•ä¸­å¯ä»¥ä½¿ç”¨<code>--tcp-flags</code>å¯æ ¹æ®tcp flagè¿›è¡ŒåŒ¹é…</p><p>stateæ‰©å±•å¯æ ¹æ®tcpçš„è¿æ¥çŠ¶æ€è¿›è¡ŒåŒ¹é…</p><h2 id=å®éªŒå››-è‡ªå®šä¹‰é“¾>å®éªŒå›› è‡ªå®šä¹‰é“¾</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># åˆ›å»ºè‡ªå®šä¹‰é“¾ IN_WEB
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -t filter -N IN_WEB
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -nvL
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 31 packets, 1780 bytes)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Chain OUTPUT (policy ACCEPT 16 packets, 1216 bytes)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Chain IN_WEB (0 references)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -t filter -I IN_WEB -s 192.168.33.1 -j REJECT
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -t filter -I IN_WEB -s 192.168.33.2 -j REJECT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -t filter -nvL IN_WEB --line
</span></span><span class=line><span class=cl>Chain IN_WEB (0 references)
</span></span><span class=line><span class=cl>num   pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>1        0     0 REJECT     all  --  *      *       192.168.33.2         0.0.0.0/0            reject-with icmp-port-unreachable
</span></span><span class=line><span class=cl>2        0     0 REJECT     all  --  *      *       192.168.33.1         0.0.0.0/0            reject-with icmp-port-unreachable
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># å°†IN_WEBè‡ªå®šä¹‰é“¾æ·»åŠ åˆ°INPUTé“¾ä¸Š
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -t filter -I INPUT -p tcp --dport 80 -j IN_WEB
</span></span><span class=line><span class=cl># å¯ä»¥çœ‹åˆ°INPUTé“¾ä¸­å¤šå‡ºäº†IN_WEBé“¾
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -nvL
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 35 packets, 2012 bytes)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>    0     0 IN_WEB     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Chain OUTPUT (policy ACCEPT 18 packets, 1408 bytes)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Chain IN_WEB (1 references)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>    0     0 REJECT     all  --  *      *       192.168.33.2         0.0.0.0/0            reject-with icmp-port-unreachable
</span></span><span class=line><span class=cl>    0     0 REJECT     all  --  *      *       192.168.33.1         0.0.0.0/0            reject-with icmp-port-unreachable
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># é‡æ–°å®šä¹‰è‡ªå®šé“¾åå­—    
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -E IN_WEB WEB
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -nvL
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT 39 packets, 2244 bytes)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>    0     0 WEB        tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Chain OUTPUT (policy ACCEPT 20 packets, 1520 bytes)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Chain WEB (1 references)
</span></span><span class=line><span class=cl> pkts bytes target     prot opt in     out     source               destination
</span></span><span class=line><span class=cl>    0     0 REJECT     all  --  *      *       192.168.33.2         0.0.0.0/0            reject-with icmp-port-unreachable
</span></span><span class=line><span class=cl>    0     0 REJECT     all  --  *      *       192.168.33.1         0.0.0.0/0            reject-with icmp-port-unreachable
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl># ç”±äºiptablesæœ‰è‡ªå®šä¹‰é“¾ï¼Œä¸èƒ½åˆ é™¤
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -X WEB
</span></span><span class=line><span class=cl>iptables: Too many links.
</span></span><span class=line><span class=cl># å°†INPUTé“¾å¼•ç”¨çš„WEBé“¾åˆ é™¤
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -D INPUT 1
</span></span><span class=line><span class=cl># æ­¤æ—¶ä»ä¸èƒ½åˆ é™¤è‡ªå®šä¹‰é“¾ï¼Œå› ä¸ºè‡ªå®šä¹‰é“¾åˆ é™¤ï¼Œéœ€è¦ä¸Šé¢æ²¡æœ‰ä»»ä½•è§„åˆ™
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -X WEB
</span></span><span class=line><span class=cl>iptables: Directory not empty.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># å…ˆæ¸…ç©ºè‡ªå®šä¹‰é“¾çš„è§„åˆ™åå¯ä»¥åˆ é™¤
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -F WEB
</span></span><span class=line><span class=cl>[root@localhost vagrant]# iptables -X WEB
</span></span></code></pre></td></tr></table></div></div><h1 id=ref>ref</h1><ul><li><a class=link href=http://www.zsythink.net/archives/tag/iptables/page/2/ target=_blank rel=noopener>iptablesè¯¦è§£ç³»åˆ—</a></li><li><a class=link href=https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html#ACCEPTTARGET target=_blank rel=noopener>Iptables Tutorial 1.2.2</a></li></ul></section><footer class=article-footer></footer></article><script src=https://giscus.app/client.js data-repo=kuring/kuring.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkyODM4MzQ0NTk=" data-category=Announcements data-category-id=DIC_kwDOEOr4W84CdeTU data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=light data-lang=zh-CN data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark")}})()</script><footer class=site-footer><section class=copyright>&copy;
2013 -
2026 kuring</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.33.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>